{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"index.html","title":"L\u1eddi m\u1edf \u0111\u1ea7u","text":"<p>Red Aggregate ra \u0111\u1eddi t\u1eeb nhu c\u1ea7u chu\u1ea9n h\u00f3a c\u00e1ch ch\u00fang ta x\u00e2y d\u1ef1ng c\u00e1c pipeline MongoDB ph\u1ee9c t\u1ea1p, \u0111\u1ed3ng th\u1eddi chia s\u1ebb ki\u1ebfn th\u1ee9c \u0111\u00f3 b\u1eb1ng m\u1ed9t b\u1ed9 t\u00e0i li\u1ec7u nh\u1ea5t qu\u00e1n, d\u1ec5 tra c\u1ee9u. B\u1ed9 t\u00e0i li\u1ec7u b\u1ea1n \u0111ang \u0111\u1ecdc t\u1ed5ng h\u1ee3p kinh nghi\u1ec7m n\u1ed9i b\u1ed9, c\u00e1c m\u1eabu s\u1eed d\u1ee5ng ti\u00eau bi\u1ec3u v\u00e0 h\u1ec7 th\u1ed1ng cheat sheet nh\u1eb1m r\u00fat ng\u1eafn th\u1eddi gian th\u1eed\u2011sai c\u1ee7a \u0111\u1ed9i ng\u0169.</p> <p>T\u00e0i li\u1ec7u \u0111\u01b0\u1ee3c t\u1ed5 ch\u1ee9c th\u00e0nh ba ph\u1ea7n ch\u00ednh:</p> <ol> <li>Cheat sheets: c\u00e1c c\u00f4ng th\u1ee9c nhanh cho t\u1eebng to\u00e1n t\u1eed, giai \u0111o\u1ea1n v\u00e0 ti\u1ec7n \u00edch th\u01b0\u1eddng g\u1eb7p, c\u00f3 k\u00e8m v\u00ed d\u1ee5 m\u00e3 ngu\u1ed3n.</li> <li>H\u01b0\u1edbng d\u1eabn chuy\u00ean \u0111\u1ec1: \u0111\u00e0o s\u00e2u c\u00e1c ch\u1ee7 \u0111\u1ec1 nh\u01b0 t\u1ed1i \u01b0u pipeline, chi\u1ebfn l\u01b0\u1ee3c ph\u00e2n trang, hay c\u00e1ch k\u1ebft h\u1ee3p Red Aggregate v\u1edbi nh\u1eefng d\u1ecbch v\u1ee5 kh\u00e1c.</li> <li>Ph\u1ee5 l\u1ee5c tra c\u1ee9u: m\u1ee5c l\u1ee5c theo b\u1ea3ng ch\u1eef c\u00e1i, thu\u1eadt ng\u1eef v\u00e0 t\u00e0i li\u1ec7u tham kh\u1ea3o \u0111\u1ec3 b\u1ea1n d\u1ec5 d\u00e0ng quay l\u1ea1i c\u00e1c kh\u00e1i ni\u1ec7m c\u1ed1t l\u00f5i.</li> </ol> <p>Ch\u00fang t\u00f4i mong b\u1ea1n xem Red Aggregate nh\u01b0 m\u1ed9t h\u1ed9p c\u00f4ng c\u1ee5 chung. N\u1ebfu ph\u00e1t hi\u1ec7n \u0111i\u1ec3m ch\u01b0a r\u00f5 r\u00e0ng ho\u1eb7c c\u00f3 k\u1ef9 thu\u1eadt m\u1edbi mu\u1ed1n chia s\u1ebb, h\u00e3y m\u1edf m\u1ed9t th\u1ea3o lu\u1eadn hay pull request \u2014 m\u1ed7i \u0111\u00f3ng g\u00f3p \u0111\u1ec1u gi\u00fap c\u1ed9ng \u0111\u1ed3ng l\u00e0m vi\u1ec7c hi\u1ec7u qu\u1ea3 h\u01a1n.</p> <p>Core team:</p> <ul> <li>Tran Hong Quan</li> </ul>"},{"location":"Glossary.html","title":"Index Alphabetical","text":"<p>A S</p>"},{"location":"Glossary.html#a","title":"A","text":"<p>aggregationUpdate</p> <p>aggregation</p>"},{"location":"Glossary.html#s","title":"S","text":"<p>systemVariables</p>"},{"location":"documentation/aggregation.html","title":"Aggregation","text":"<p><code>Aggregation</code> l\u00e0 l\u1edbp trung t\u00e2m gi\u00fap b\u1ea1n l\u1eafp r\u00e1p danh s\u00e1ch stage MongoDB, \u00e1p d\u1ee5ng <code>AggregateOptions</code> v\u00e0 k\u1ebft xu\u1ea5t ra pipeline ho\u1eb7c command ho\u00e0n ch\u1ec9nh. T\u00e0i li\u1ec7u n\u00e0y m\u00f4 ph\u1ecfng c\u00e1ch tr\u00ecnh b\u00e0y c\u1ee7a h\u01b0\u1edbng d\u1eabn Mongoose, bao g\u1ed3m danh m\u1ee5c ph\u01b0\u01a1ng th\u1ee9c theo lo\u1ea1i (static/protected/public), m\u00f4 t\u1ea3 chi ti\u1ebft t\u1eebng API c\u00f9ng v\u00ed d\u1ee5 th\u1ef1c t\u1ebf (t\u1eeb import \u0111\u1ebfn output k\u1ef3 v\u1ecdng).</p>"},{"location":"documentation/aggregation.html#import","title":"Import","text":"<pre><code>import { Aggregation } from '@/aggregation';\nimport { Direction } from '@/domain/order';\n\nconst pipeline = Aggregation.newAggregation(\nAggregation.match({ status: 'PAID' }),\nAggregation.sort(Direction.DESC, ['createdAt'])\n).toPipeline(Aggregation.DEFAULT_CONTEXT);\n\n// pipeline =&gt; [\n//   { $match: { status: 'PAID' } },\n//   { $sort: { createdAt: -1 } }\n// ]\n</code></pre>"},{"location":"documentation/aggregation.html#danh-muc-phuong-thuc","title":"Danh m\u1ee5c ph\u01b0\u01a1ng th\u1ee9c","text":""},{"location":"documentation/aggregation.html#static","title":"Static","text":"API Ki\u1ec3u tr\u1ea3 v\u1ec1 T\u00f3m t\u1eaft <code>newAggregation(...operations)</code> <code>Aggregation</code> Factory ch\u00ednh \u0111\u1ec3 d\u1ef1ng pipeline m\u1edbi. <code>newAggregationOptions()</code> <code>AggregateOptionsBuilder</code> Truy c\u1eadp builder c\u1ea5u h\u00ecnh <code>AggregateOptions</code>. <code>DEFAULT_OPTIONS</code> <code>AggregateOptions</code> T\u1eadp t\u00f9y ch\u1ecdn m\u1eb7c \u0111\u1ecbnh \u0111\u01b0\u1ee3c g\u00e1n khi kh\u00f4ng truy\u1ec1n builder. <code>DEFAULT_CONTEXT</code> <code>AggregationOperationContext</code> Renderer context m\u1eb7c \u0111\u1ecbnh khi xu\u1ea5t pipeline. <code>ROOT</code>, <code>CURRENT</code> <code>string</code> Alias cho <code>$$ROOT</code>/<code>$$CURRENT</code>. <code>addFields()</code> <code>AddFieldsOperationBuilder</code> T\u1ea1o stage <code>$addFields</code>. <code>replaceRoot(...)</code> <code>ReplaceRootOperation</code> | <code>ReplaceRootOperationBuilder</code> Thay th\u1ebf t\u00e0i li\u1ec7u g\u1ed1c b\u1eb1ng field/expression kh\u00e1c. <code>project(...fields)</code> <code>ProjectionOperation</code> L\u1ef1a ch\u1ecdn field \u0111\u1ea7u ra (<code>$project</code>). <code>unwind(...)</code> <code>UnwindOperation</code> T\u00e1ch m\u1ea3ng th\u00e0nh nhi\u1ec1u b\u1ea3n ghi (<code>$unwind</code>). <code>group(fields)</code> <code>GroupOperation</code> D\u1ef1ng stage <code>$group</code> d\u1ef1a tr\u00ean <code>Fields</code>. <code>sort(...)</code> <code>SortOperation</code> S\u1eafp x\u1ebfp k\u1ebft qu\u1ea3 (<code>$sort</code>). <code>skip(count)</code> <code>SkipOperation</code> B\u1ecf qua N documents (<code>$skip</code>). <code>limit(count)</code> <code>LimitOperation</code> Gi\u1edbi h\u1ea1n s\u1ed1 document (<code>$limit</code>). <code>match(expression)</code> <code>MatchOperation</code> L\u1ecdc d\u1eef li\u1ec7u theo \u0111i\u1ec1u ki\u1ec7n (<code>$match</code>). <code>merge()</code> <code>MergeOperationBuilder</code> Ghi k\u1ebft qu\u1ea3 sang collection kh\u00e1c (<code>$merge</code>). <code>facet(...operations)</code> <code>FacetOperation</code> Ch\u1ea1y nhi\u1ec1u pipeline song song (<code>$facet</code>). <code>lookup(...)</code> <code>LookupOperation</code> | <code>LookupOperationBuilder</code> Th\u1ef1c hi\u1ec7n join (<code>$lookup</code>). <code>count()</code> <code>CountOperationBuilder</code> \u0110\u1ebfm s\u1ed1 b\u1ea3n ghi (<code>$count</code>). <code>sortByCount(selector)</code> <code>SortByCountOperation</code> Gom nh\u00f3m v\u00e0 s\u1eafp x\u1ebfp theo s\u1ed1 l\u01b0\u1ee3ng (<code>$sortByCount</code>). <code>field(name)</code> <code>Field</code> Chu\u1ea9n h\u00f3a t\u00ean field tr\u01b0\u1edbc khi d\u1ef1ng stage."},{"location":"documentation/aggregation.html#protected","title":"Protected","text":"API Ki\u1ec3u tr\u1ea3 v\u1ec1 T\u00f3m t\u1eaft <code>protected static asAggregationList(...operations)</code> <code>AggregateOperation[]</code> Chu\u1ea9n h\u00f3a danh s\u00e1ch stage d\u00f9ng n\u1ed9i b\u1ed9 cho factory/ subclass."},{"location":"documentation/aggregation.html#public","title":"Public","text":"Method Tr\u1ea3 v\u1ec1 C\u00f4ng d\u1ee5ng <code>toPipeline(rootContext)</code> <code>Document[]</code> Render pipeline theo <code>AggregationOperationContext</code>. <code>getPipeline()</code> <code>AggregationPipeline</code> Truy c\u1eadp \u0111\u1ed1i t\u01b0\u1ee3ng pipeline b\u1ea5t bi\u1ebfn. <code>toDocument(collection, rootContext)</code> <code>Document</code> D\u1ef1ng command <code>aggregate</code> ho\u00e0n ch\u1ec9nh v\u00e0 \u00e1p d\u1ee5ng <code>AggregateOptions</code>."},{"location":"documentation/aggregation.html#static-api","title":"Static API","text":""},{"location":"documentation/aggregation.html#newaggregationoperations","title":"<code>newAggregation(...operations)</code>","text":"<ul> <li>M\u00f4 t\u1ea3: Nh\u1eadn m\u1ed9t ho\u1eb7c nhi\u1ec1u <code>AggregateOperation</code>. N\u1ebfu tham s\u1ed1 cu\u1ed1i kh\u00f4ng ph\u1ea3i <code>AggregateOptions</code>, <code>DEFAULT_OPTIONS</code> s\u1ebd \u0111\u01b0\u1ee3c d\u00f9ng.</li> <li>V\u00ed d\u1ee5:</li> </ul> <pre><code>const agg = Aggregation.newAggregation(\nAggregation.match({ status: 'PAID' }),\nAggregation.limit(100)\n);\n\nagg.getPipeline().toDocuments(Aggregation.DEFAULT_CONTEXT);\n// =&gt; [{ $match: { status: 'PAID' } }, { $limit: 100 }]\n</code></pre>"},{"location":"documentation/aggregation.html#newaggregationoptions","title":"<code>newAggregationOptions()</code>","text":"<ul> <li>M\u00f4 t\u1ea3: Tr\u1ea3 v\u1ec1 <code>AggregateOptions.builder()</code> gi\u00fap c\u1ea5u h\u00ecnh <code>allowDiskUse</code>, <code>cursor.batchSize</code>, ...</li> <li>V\u00ed d\u1ee5:</li> </ul> <pre><code>const options = Aggregation.newAggregationOptions()\n.allowDiskUse(true)\n.cursorBatchSize(500)\n.build();\n\nconst agg = Aggregation.newAggregation(\n[Aggregation.match({ status: 'PAID' }), Aggregation.count().as('total')],\noptions\n);\n</code></pre>"},{"location":"documentation/aggregation.html#addfields","title":"<code>addFields()</code>","text":"<ul> <li>Tr\u1ea3 v\u1ec1: <code>AddFieldsOperation.builder()</code>.</li> <li>V\u00ed d\u1ee5:</li> </ul> <pre><code>import { SystemVariables } from '@/systemVariables';\n\nconst addFieldsStage = Aggregation.addFields()\n.withField('grandTotal', { $add: ['$subtotal', '$tax'] })\n.withField('issuedAt', SystemVariables.NOW)\n.build();\n// =&gt; { $addFields: { grandTotal: { $add: [...] }, issuedAt: '$$NOW' } }\n</code></pre>"},{"location":"documentation/aggregation.html#replaceroot","title":"<code>replaceRoot(...)</code>","text":"<ul> <li>Ch\u1eef k\u00fd: <code>replaceRoot()</code>, <code>replaceRoot(field: string)</code>, <code>replaceRoot(expression: AggregationExpression | Document)</code>.</li> <li>V\u00ed d\u1ee5:</li> </ul> <pre><code>const builder = Aggregation.replaceRoot(); // builder \u0111\u1ec3 g\u1eafn th\u00eam gi\u00e1 tr\u1ecb\nconst fromField = Aggregation.replaceRoot('payload');\nconst fromExpression = Aggregation.replaceRoot(new SomeExpression());\nconst fromDocument = Aggregation.replaceRoot({ merged: '$$ROOT' });\n</code></pre>"},{"location":"documentation/aggregation.html#projectfields-fields-fields","title":"<code>project(...fields | fields: Fields)</code>","text":"<ul> <li>M\u00f4 t\u1ea3: Nh\u1eadn danh s\u00e1ch string ho\u1eb7c <code>Fields</code> \u0111\u1ec3 t\u1ea1o <code>ProjectionOperation</code>.</li> <li>V\u00ed d\u1ee5:</li> </ul> <pre><code>const projection = Aggregation.project('customer', 'items', 'total');\nconst normalized = Aggregation.project(Fields.fields('orderNumber', 'shipping.address'));\n</code></pre>"},{"location":"documentation/aggregation.html#unwindfield-arrayindex-preservenullandemptyarrays","title":"<code>unwind(field, arrayIndex?, preserveNullAndEmptyArrays?)</code>","text":"<ul> <li>Overload:   1. <code>unwind(field: string)</code>   2. <code>unwind(field: string, preserveNullAndEmptyArrays: boolean)</code>   3. <code>unwind(field: string, arrayIndex: string)</code>   4. <code>unwind(field: string, arrayIndex: string, preserveNullAndEmptyArrays: boolean)</code></li> <li>V\u00ed d\u1ee5:</li> </ul> <pre><code>const basic = Aggregation.unwind('items');\nconst keepNull = Aggregation.unwind('items', true);\nconst withIndex = Aggregation.unwind('items', 'idx');\nconst full = Aggregation.unwind('items', 'idx', true);\n</code></pre>"},{"location":"documentation/aggregation.html#groupfields-fields","title":"<code>group(fields: Fields)</code>","text":"<ul> <li>M\u00f4 t\u1ea3: Nh\u1eadn <code>Fields</code> m\u00f4 t\u1ea3 <code>_id</code> v\u00e0 accumulator.</li> <li>V\u00ed d\u1ee5:</li> </ul> <pre><code>const idFields = Fields.fieldsField(Fields.field('_id', '$customerId'));\nconst grouped = Aggregation.group(idFields)\n.sum('$amount').as('totalAmount')\n.avg('$amount').as('avgAmount');\n\ngrouped.toDocument(Aggregation.DEFAULT_CONTEXT);\n// =&gt; { $group: { _id: '$customerId', totalAmount: { $sum: '$amount' }, ... } }\n</code></pre>"},{"location":"documentation/aggregation.html#sortsort-sort-va-sortdirection-direction-fields-string","title":"<code>sort(sort: Sort)</code> v\u00e0 <code>sort(direction: Direction, fields: string[])</code>","text":"<ul> <li>V\u00ed d\u1ee5:</li> </ul> <pre><code>const byObject = Aggregation.sort(Sort.by(Direction.ASC, 'customer', 'createdAt'));\nconst byArgs = Aggregation.sort(Direction.DESC, ['createdAt', 'orderNumber']);\n</code></pre>"},{"location":"documentation/aggregation.html#skipcount-limitcount","title":"<code>skip(count)</code> / <code>limit(count)</code>","text":"<ul> <li>V\u00ed d\u1ee5:</li> </ul> <pre><code>const skipStage = Aggregation.skip(50);   // { $skip: 50 }\nconst limitStage = Aggregation.limit(20); // { $limit: 20 }\n</code></pre>"},{"location":"documentation/aggregation.html#matchexpression","title":"<code>match(expression)</code>","text":"<ul> <li>\u0110\u1ed1i s\u1ed1 h\u1ee3p l\u1ec7: <code>AggregationExpression</code>, <code>IClauseDefinition</code>, <code>Document</code>.</li> <li>V\u00ed d\u1ee5:</li> </ul> <pre><code>const byDoc = Aggregation.match({ status: 'PAID' });\nconst byClause = Aggregation.match(buildStatusClause());\nconst byExpression = Aggregation.match(new BooleanExpression());\n</code></pre>"},{"location":"documentation/aggregation.html#merge","title":"<code>merge()</code>","text":"<ul> <li>Tr\u1ea3 v\u1ec1: <code>MergeOperation.builder()</code>.</li> <li>V\u00ed d\u1ee5:</li> </ul> <pre><code>const mergeStage = Aggregation.merge()\n.into('orders_archive')\n.whenMatched('replace')\n.whenNotMatched('insert')\n.build();\n</code></pre>"},{"location":"documentation/aggregation.html#facetoperations","title":"<code>facet(...operations)</code>","text":"<ul> <li>M\u00f4 t\u1ea3: Kh\u00f4ng \u0111\u1ed1i s\u1ed1 \u2192 <code>FacetOperation.EMPTY</code>; truy\u1ec1n nhi\u1ec1u <code>AggregateOperation</code> \u0111\u1ec3 \u0111\u0103ng k\u00fd facet.</li> <li>V\u00ed d\u1ee5:</li> </ul> <pre><code>const fromBuilder = Aggregation.facet()\n.and('paidOrders', Aggregation.match({ status: 'PAID' }))\n.and('byCustomer', Aggregation.group(Fields.fields('customer')));\n\nconst fromArgs = Aggregation.facet(\nAggregation.match({ status: 'PAID' }),\nAggregation.project('customer', 'total')\n);\n</code></pre>"},{"location":"documentation/aggregation.html#lookup","title":"<code>lookup(...)</code>","text":"<ul> <li>Ch\u1eef k\u00fd: builder r\u1ed7ng, ch\u1eef k\u00fd v\u1edbi 4 string, ho\u1eb7c ch\u1eef k\u00fd v\u1edbi 4 <code>Field</code>.</li> <li>V\u00ed d\u1ee5:</li> </ul> <pre><code>const builder = Aggregation.lookup()\n.from('customers')\n.localField('customerId')\n.foreignField('_id')\n.as('customer');\n\nconst fromStrings = Aggregation.lookup('customers', 'customerId', '_id', 'customer');\n\nconst fromFields = Aggregation.lookup(\nFields.field('customers'),\nFields.field('customerId'),\nFields.field('_id'),\nFields.field('customer')\n);\n</code></pre>"},{"location":"documentation/aggregation.html#count","title":"<code>count()</code>","text":"<ul> <li>V\u00ed d\u1ee5:</li> </ul> <pre><code>const countStage = Aggregation.count().as('totalOrders'); // { $count: 'totalOrders' }\n</code></pre>"},{"location":"documentation/aggregation.html#sortbycountselector","title":"<code>sortByCount(selector)</code>","text":"<ul> <li>V\u00ed d\u1ee5:</li> </ul> <pre><code>const byField = Aggregation.sortByCount('status');\nconst byExpression = Aggregation.sortByCount({ $substr: ['$customer', 0, 1] });\n</code></pre>"},{"location":"documentation/aggregation.html#fieldname-string","title":"<code>field(name: string)</code>","text":"<ul> <li>V\u00ed d\u1ee5:</li> </ul> <pre><code>const customerField = Aggregation.field('customer.name');\nconst aliased = Fields.field('customerName', '$customer.name');\n</code></pre>"},{"location":"documentation/aggregation.html#protected-api","title":"Protected API","text":""},{"location":"documentation/aggregation.html#protected-constructoroperations-aggregateoperation-aggregateoperation","title":"<code>protected constructor(operations: AggregateOperation | AggregateOperation[])</code>","text":"<ul> <li>\u00dd ngh\u0129a: Ng\u0103n vi\u1ec7c kh\u1edfi t\u1ea1o tr\u1ef1c ti\u1ebfp. M\u1ecdi ng\u01b0\u1eddi d\u00f9ng ph\u1ea3i g\u1ecdi <code>Aggregation.newAggregation(...)</code> ho\u1eb7c subclass.</li> <li>B\u1ea3o v\u1ec7: s\u1eed d\u1ee5ng <code>Assert.notNull</code>/<code>Assert.notEmpty</code> \u0111\u1ec3 ch\u1eafc ch\u1eafn pipeline kh\u00f4ng r\u1ed7ng.</li> </ul>"},{"location":"documentation/aggregation.html#protected-static-asaggregationlistoperations","title":"<code>protected static asAggregationList(...operations)</code>","text":"<ul> <li>\u00dd ngh\u0129a: N\u1ed9i b\u1ed9 chuy\u1ec3n c\u00e1c overload sang m\u1ea3ng chu\u1ea9n v\u00e0 x\u00e1c th\u1ef1c danh s\u00e1ch.</li> <li>Khi n\u00e0o h\u1eefu \u00edch: N\u1ebfu b\u1ea1n vi\u1ebft subclass <code>CustomAggregation</code> v\u00e0 c\u1ea7n k\u1ebf th\u1eeba logic h\u1ee3p nh\u1ea5t stage.</li> </ul>"},{"location":"documentation/aggregation.html#public-api","title":"Public API","text":""},{"location":"documentation/aggregation.html#topipelinerootcontext-aggregationoperationcontext","title":"<code>toPipeline(rootContext: AggregationOperationContext)</code>","text":"<ul> <li>Tr\u1ea3 v\u1ec1: <code>Document[]</code>.</li> <li>V\u00ed d\u1ee5:</li> </ul> <pre><code>const docs = Aggregation.newAggregation(\nAggregation.match({ status: 'PAID' })\n).toPipeline(Aggregation.DEFAULT_CONTEXT);\n\n// docs =&gt; [{ $match: { status: 'PAID' } }]\n</code></pre>"},{"location":"documentation/aggregation.html#getpipeline","title":"<code>getPipeline()</code>","text":"<ul> <li>Tr\u1ea3 v\u1ec1: <code>AggregationPipeline</code> (read-only).</li> <li>V\u00ed d\u1ee5:</li> </ul> <pre><code>const pipeline = Aggregation.newAggregation(\nAggregation.skip(10)\n).getPipeline();\n\npipeline.toDocuments(Aggregation.DEFAULT_CONTEXT); // [{ $skip: 10 }]\n</code></pre>"},{"location":"documentation/aggregation.html#todocumentcollectionname-string-rootcontext-aggregationoperationcontext","title":"<code>toDocument(collectionName: string, rootContext: AggregationOperationContext)</code>","text":"<ul> <li>Tr\u1ea3 v\u1ec1: Command <code>Document</code> d\u1ea1ng <code>{ aggregate, pipeline, cursor?, ... }</code>.</li> <li>V\u00ed d\u1ee5:</li> </ul> <pre><code>const command = Aggregation.newAggregation(\nAggregation.match({ status: 'PAID' }),\nAggregation.limit(5)\n).toDocument('orders', Aggregation.DEFAULT_CONTEXT);\n\n// command =&gt; {\n//   aggregate: 'orders',\n//   pipeline: [{ $match: {...} }, { $limit: 5 }],\n//   cursor: {}\n// }\n</code></pre>"},{"location":"documentation/aggregation.html#luu-y-su-dung","title":"L\u01b0u \u00fd s\u1eed d\u1ee5ng","text":"<ul> <li>\u01afu ti\u00ean helper <code>Aggregation.field</code> ho\u1eb7c <code>Fields.field</code> \u0111\u1ec3 tr\u00e1nh l\u1ed7i c\u00fa ph\u00e1p <code>$</code>.</li> <li><code>Aggregation.replaceRoot</code>, <code>Aggregation.lookup</code>, <code>Aggregation.group</code> cho ph\u00e9p truy\u1ec1n <code>AggregationExpression</code> ho\u1eb7c <code>Document</code>. Khi d\u00f9ng literal, h\u00e3y \u0111\u1ea3m b\u1ea3o schema h\u1ee3p l\u1ec7 v\u00ec th\u01b0 vi\u1ec7n kh\u00f4ng ki\u1ec3m tra chi ti\u1ebft.</li> <li><code>AggregationOperationContext</code> \u1ea3nh h\u01b0\u1edfng tr\u1ef1c ti\u1ebfp t\u1edbi c\u00e1ch render field v\u00e0 system variables. D\u00f9ng <code>DEFAULT_CONTEXT</code> cho case ph\u1ed5 bi\u1ebfn; t\u1ea1o context ri\u00eang khi c\u1ea7n map ho\u1eb7c prefix kh\u00e1c.</li> <li>C\u00e1c h\u1eb1ng <code>Aggregation.ROOT</code> v\u00e0 <code>Aggregation.CURRENT</code> t\u01b0\u01a1ng \u0111\u01b0\u01a1ng <code>$$ROOT</code>/<code>$$CURRENT</code>. K\u1ebft h\u1ee3p ch\u00fang v\u1edbi module <code>systemVariables</code> \u0111\u1ec3 tr\u00e1nh hard-code literal.</li> </ul>"},{"location":"documentation/aggregationUpdate.html","title":"AggregationUpdate","text":"<p><code>AggregationUpdate</code> m\u1edf r\u1ed9ng <code>Aggregation</code> v\u00e0 tri\u1ec3n khai <code>UpdateDefinition</code> \u0111\u1ec3 \u0111\u1ecbnh ngh\u0129a c\u00e1c update pipeline d\u1ef1a tr\u00ean stage aggregation. L\u1edbp n\u00e0y theo d\u00f5i c\u00e1c field b\u1ecb t\u00e1c \u0111\u1ed9ng (<code>keysTouched</code>), h\u1ed7 tr\u1ee3 g\u1eafn <code>$set</code>, <code>$unset</code>, <code>$replaceWith</code> v\u00e0 cung c\u1ea5p <code>UpdateDefinition</code> t\u01b0\u01a1ng th\u00edch v\u1edbi driver MongoDB.</p>"},{"location":"documentation/aggregationUpdate.html#import","title":"Import","text":"<pre><code>import { AggregationUpdate } from '@/aggregationUpdate';\nimport { SetOperation } from '@/operations/setOperation';\n\nconst update = AggregationUpdate.update()\n.set(SetOperation.createSetOperation('status', 'PAID'))\n.unset('temporaryNote')\n.replaceWith({ $mergeObjects: ['$$ROOT', { reviewed: true }] });\n\nconst command = update.getUpdateObject();\n// command =&gt; { '': [ { $set: { status: 'PAID' } },\n//                    { $unset: 'temporaryNote' },\n//                    { $replaceWith: { $mergeObjects: [...] } } ] }\n</code></pre>"},{"location":"documentation/aggregationUpdate.html#danh-muc-phuong-thuc","title":"Danh m\u1ee5c ph\u01b0\u01a1ng th\u1ee9c","text":""},{"location":"documentation/aggregationUpdate.html#static","title":"Static","text":"API Ki\u1ec3u tr\u1ea3 v\u1ec1 T\u00f3m t\u1eaft <code>AggregationUpdate.update()</code> <code>AggregationUpdate</code> T\u1ea1o update tr\u1ed1ng \u0111\u1ec3 b\u1eaft \u0111\u1ea7u g\u1eafn stage. <code>AggregationUpdate.from(pipeline)</code> <code>AggregationUpdate</code> B\u1ecdc m\u1ed9t m\u1ea3ng <code>AggregateOperation</code> s\u1eb5n c\u00f3 th\u00e0nh update. <p><code>AggregationUpdate</code> v\u1eabn th\u1eeba h\u01b0\u1edfng to\u00e0n b\u1ed9 static helper c\u1ee7a <code>Aggregation</code> (stage builder, options, context...). Tham kh\u1ea3o <code>aggregation.md</code> khi c\u1ea7n chi ti\u1ebft v\u1ec1 nh\u1eefng API \u0111\u00f3.</p>"},{"location":"documentation/aggregationUpdate.html#protected","title":"Protected","text":"API Ki\u1ec3u tr\u1ea3 v\u1ec1 T\u00f3m t\u1eaft <code>protected constructor(pipeline?: AggregateOperation[])</code> <code>AggregationUpdate</code> Ch\u1ec9 d\u00e0nh cho factory n\u1ed9i b\u1ed9; \u0111\u1ea3m b\u1ea3o m\u1ecdi instance \u0111\u1ec1u c\u00f3 pipeline h\u1ee3p l\u1ec7 v\u00e0 c\u1eadp nh\u1eadt <code>keysTouched</code>."},{"location":"documentation/aggregationUpdate.html#public","title":"Public","text":"Method Tr\u1ea3 v\u1ec1 C\u00f4ng d\u1ee5ng <code>set(setOperation)</code> <code>AggregationUpdate</code> Th\u00eam stage <code>$set</code> v\u00e0 \u0111\u00e1nh d\u1ea5u c\u00e1c field \u0111\u01b0\u1ee3c c\u1eadp nh\u1eadt. <code>unset(...keys)</code> / <code>unset(unsetOperation)</code> <code>AggregationUpdate</code> G\u1eafn stage <code>$unset</code> t\u1eeb danh s\u00e1ch string ho\u1eb7c <code>UnsetOperation</code>. <code>replaceWith(value \\| ReplaceWithOperation)</code> <code>AggregationUpdate</code> Thay to\u00e0n b\u1ed9 document b\u1eb1ng gi\u00e1 tr\u1ecb/operation m\u1edbi (<code>$replaceWith</code>). <code>isIsolated()</code> <code>boolean</code> Cho bi\u1ebft update c\u00f3 g\u1eafn c\u1edd <code>isolated</code> hay kh\u00f4ng (m\u1eb7c \u0111\u1ecbnh <code>false</code>). <code>getUpdateObject()</code> <code>Document</code> Bi\u1ebfn pipeline th\u00e0nh update object cho MongoDB. <code>modifies(key)</code> <code>boolean</code> Ki\u1ec3m tra field c\u00f3 n\u1eb1m trong <code>keysTouched</code>. <code>inc(key)</code> <code>UpdateDefinition</code> Placeholder, hi\u1ec7n n\u00e9m l\u1ed7i v\u00ec ch\u01b0a \u0111\u01b0\u1ee3c h\u1ed7 tr\u1ee3. <code>getArrayFilters()</code> <code>ArrayFilter[]</code> Tr\u1ea3 v\u1ec1 danh s\u00e1ch filter (m\u1eb7c \u0111\u1ecbnh r\u1ed7ng). <code>hasArrayFilters()</code> <code>boolean</code> <code>true</code> n\u1ebfu c\u00f3 \u00edt nh\u1ea5t m\u1ed9t filter (d\u1ef1a tr\u00ean <code>getArrayFilters()</code>). <code>toPipeline(rootContext)</code> <code>Document[]</code> Th\u1eeba h\u01b0\u1edfng t\u1eeb <code>Aggregation</code>: render pipeline. <code>toDocument(collection, rootContext)</code> <code>Document</code> Render command <code>aggregate</code>. <code>getPipeline()</code> <code>AggregationPipeline</code> Truy c\u1eadp pipeline b\u1ea5t bi\u1ebfn."},{"location":"documentation/aggregationUpdate.html#static-api","title":"Static API","text":""},{"location":"documentation/aggregationUpdate.html#aggregationupdateupdate","title":"<code>AggregationUpdate.update()</code>","text":"<ul> <li>M\u00f4 t\u1ea3: Factory ti\u1ec7n l\u1ee3i t\u1ea1o m\u1ed9t update tr\u1ed1ng s\u1eed d\u1ee5ng constructor \u0111\u01b0\u1ee3c b\u1ea3o v\u1ec7.</li> <li>V\u00ed d\u1ee5:</li> </ul> <pre><code>const update = AggregationUpdate.update()\n.set(SetOperation.createSetOperation('status', 'PAID'))\n.unset('deprecatedField');\n</code></pre>"},{"location":"documentation/aggregationUpdate.html#aggregationupdatefrompipeline-aggregateoperation","title":"<code>AggregationUpdate.from(pipeline: AggregateOperation[])</code>","text":"<ul> <li>M\u00f4 t\u1ea3: Khi \u0111\u00e3 c\u00f3 danh s\u00e1ch <code>AggregateOperation</code> (v\u00ed d\u1ee5 x\u00e2y d\u1ef1ng b\u1eb1ng c\u00e1c helper c\u1ee7a <code>Aggregation</code>), b\u1ea1n c\u00f3 th\u1ec3 b\u1ecdc ch\u00fang v\u00e0o <code>AggregationUpdate</code> \u0111\u1ec3 t\u1eadn d\u1ee5ng API <code>UpdateDefinition</code>.</li> <li>V\u00ed d\u1ee5:</li> </ul> <pre><code>const stages = [\nAggregation.match({ status: 'PAID' }),\nAggregation.addFields().withField('flagged', true).build(),\n];\n\nconst update = AggregationUpdate.from(stages);\n</code></pre>"},{"location":"documentation/aggregationUpdate.html#protected-api","title":"Protected API","text":""},{"location":"documentation/aggregationUpdate.html#protected-constructorpipeline-aggregateoperation","title":"<code>protected constructor(pipeline?: AggregateOperation[])</code>","text":"<ul> <li>\u00dd ngh\u0129a: Ch\u1ec9 factory n\u1ed9i b\u1ed9 (<code>update()</code>, <code>from()</code>) \u0111\u01b0\u1ee3c ph\u00e9p g\u1ecdi. Constructor kh\u1edfi t\u1ea1o <code>keysTouched</code> d\u1ef1a tr\u00ean m\u1ecdi <code>FieldsExposingAggregationOperation</code> trong pipeline \u0111\u1ec3 ph\u1ee5c v\u1ee5 <code>modifies(key)</code>.</li> <li>Ghi ch\u00fa: N\u1ebfu kh\u00f4ng truy\u1ec1n pipeline, constructor t\u1ef1 t\u1ea1o instance tr\u1ed1ng (g\u1ecdi l\u1ea1i ch\u00ednh m\u00ecnh v\u1edbi <code>[]</code>), gi\u00fap b\u1ea1n lu\u00f4n b\u1eaft \u0111\u1ea7u v\u1edbi c\u1ea5u tr\u00fac h\u1ee3p l\u1ec7.</li> </ul>"},{"location":"documentation/aggregationUpdate.html#public-api","title":"Public API","text":""},{"location":"documentation/aggregationUpdate.html#setsetoperation-setoperation","title":"<code>set(setOperation: SetOperation)</code>","text":"<ul> <li>M\u00f4 t\u1ea3: Th\u00eam stage <code>$set</code> do <code>SetOperation</code> \u0111\u1ecbnh ngh\u0129a, \u0111\u1ed3ng th\u1eddi \u0111\u00e1nh d\u1ea5u m\u1ecdi field xu\u1ea5t hi\u1ec7n trong operation v\u00e0o <code>keysTouched</code>.</li> <li>V\u00ed d\u1ee5:</li> </ul> <pre><code>const update = AggregationUpdate.update();\n\nupdate.set(\nSetOperation.createSetOperation('profile.completed', true)\n);\n\nupdate.set(\nSetOperation.createSetOperation('lastModified', '$$NOW')\n);\n</code></pre>"},{"location":"documentation/aggregationUpdate.html#unsetkeys-string-unsetunsetoperation-unsetoperation","title":"<code>unset(...keys: string[])</code> / <code>unset(unsetOperation: UnsetOperation)</code>","text":"<ul> <li>M\u00f4 t\u1ea3: Support hai overload:   1. Truy\u1ec1n danh s\u00e1ch string (<code>unset('foo', 'bar')</code>) \u2192 \u0111\u01b0\u1ee3c chuy\u1ec3n th\u00e0nh <code>UnsetOperation</code>.   2. Truy\u1ec1n tr\u1ef1c ti\u1ebfp <code>UnsetOperation</code> n\u1ebfu \u0111\u00e3 d\u1ef1ng s\u1eb5n.</li> <li>V\u00ed d\u1ee5:</li> </ul> <pre><code>AggregationUpdate.update()\n.unset('temporaryField', 'debugInfo')\n.unset(new UnsetOperation([Fields.field('legacy.status')]));\n</code></pre>"},{"location":"documentation/aggregationUpdate.html#replacewithvalue-replacewithoperation","title":"<code>replaceWith(value | ReplaceWithOperation)</code>","text":"<ul> <li>M\u00f4 t\u1ea3: D\u00f9ng <code>$replaceWith</code> \u0111\u1ec3 thay to\u00e0n b\u1ed9 document. N\u1ebfu truy\u1ec1n literal, method s\u1ebd t\u1ef1 t\u1ea1o <code>ReplaceWithOperation.replaceWithValue(value)</code>.</li> <li>V\u00ed d\u1ee5:</li> </ul> <pre><code>AggregationUpdate.update()\n.replaceWith({ $mergeObjects: ['$$ROOT', { normalized: true }] })\n.replaceWith(ReplaceWithOperation.replaceWithValue({ clean: '$$ROOT' }));\n</code></pre>"},{"location":"documentation/aggregationUpdate.html#isisolated","title":"<code>isIsolated()</code>","text":"<ul> <li>M\u00f4 t\u1ea3: Tr\u1ea3 v\u1ec1 gi\u00e1 tr\u1ecb c\u1ee7a c\u1edd <code>isolated</code>. Th\u01b0 vi\u1ec7n hi\u1ec7n ch\u01b0a cung c\u1ea5p setter, v\u00ec v\u1eady h\u00e0m ch\u1ee7 y\u1ebfu ph\u1ee5c v\u1ee5 ki\u1ec3m tra giao di\u1ec7n <code>UpdateDefinition</code>.</li> </ul>"},{"location":"documentation/aggregationUpdate.html#getupdateobject","title":"<code>getUpdateObject()</code>","text":"<ul> <li>M\u00f4 t\u1ea3: K\u1ebft h\u1ee3p pipeline th\u00e0nh object driver-friendly. <code>AggregationUpdate</code> l\u01b0u pipeline d\u01b0\u1edbi key r\u1ed7ng (<code>''</code>) \u0111\u1ec3 t\u01b0\u01a1ng th\u00edch v\u1edbi c\u00e1c adapter hi\u1ec7n c\u00f3.</li> <li>V\u00ed d\u1ee5:</li> </ul> <pre><code>const updateObject = AggregationUpdate.update()\n.set(SetOperation.createSetOperation('status', 'PAID'))\n.getUpdateObject();\n\n// =&gt; { '': [{ $set: { status: 'PAID' } }] }\n</code></pre>"},{"location":"documentation/aggregationUpdate.html#modifieskey-string","title":"<code>modifies(key: string)</code>","text":"<ul> <li>M\u00f4 t\u1ea3: Ki\u1ec3m tra xem key \u0111\u00e3 t\u1eebng \u0111\u01b0\u1ee3c ch\u1ea1m b\u1edfi <code>set</code>/<code>unset</code> ho\u1eb7c m\u1ed9t stage <code>FieldsExposingAggregationOperation</code> trong pipeline ban \u0111\u1ea7u hay ch\u01b0a.</li> <li>V\u00ed d\u1ee5:</li> </ul> <pre><code>const update = AggregationUpdate.update()\n.set(SetOperation.createSetOperation('status', 'PAID'));\n\nupdate.modifies('status'); // true\nupdate.modifies('notes');  // false\n</code></pre>"},{"location":"documentation/aggregationUpdate.html#inckey-string","title":"<code>inc(key: string)</code>","text":"<ul> <li>M\u00f4 t\u1ea3: Method t\u1ed3n t\u1ea1i \u0111\u1ec3 th\u1ecfa interface <code>UpdateDefinition</code> nh\u01b0ng hi\u1ec7n ch\u01b0a \u0111\u01b0\u1ee3c tri\u1ec3n khai v\u00e0 s\u1ebd n\u00e9m l\u1ed7i. Tr\u00e1nh s\u1eed d\u1ee5ng cho \u0111\u1ebfn khi th\u01b0 vi\u1ec7n b\u1ed5 sung logic <code>$inc</code>.</li> </ul>"},{"location":"documentation/aggregationUpdate.html#getarrayfilters-va-hasarrayfilters","title":"<code>getArrayFilters()</code> v\u00e0 <code>hasArrayFilters()</code>","text":"<ul> <li>M\u00f4 t\u1ea3: M\u1eb7c \u0111\u1ecbnh tr\u1ea3 v\u1ec1 m\u1ea3ng r\u1ed7ng v\u00e0 <code>false</code>. B\u1ea1n c\u00f3 th\u1ec3 override trong subclass n\u1ebfu c\u1ea7n inject array filters cho update pipeline.</li> <li>V\u00ed d\u1ee5:</li> </ul> <pre><code>const update = AggregationUpdate.update();\nupdate.getArrayFilters(); // []\nupdate.hasArrayFilters(); // false\n</code></pre>"},{"location":"documentation/aggregationUpdate.html#thua-huong-tu-aggregation","title":"Th\u1eeba h\u01b0\u1edfng t\u1eeb <code>Aggregation</code>","text":"<ul> <li><code>toPipeline(rootContext)</code>, <code>toDocument(collection, rootContext)</code>, <code>getPipeline()</code> ho\u1ea1t \u0111\u1ed9ng gi\u1ed1ng h\u1ec7t m\u00f4 t\u1ea3 trong <code>docs/documentation/aggregation.md</code>. S\u1eed d\u1ee5ng ch\u00fang khi c\u1ea7n render pipeline/command ho\u1eb7c ki\u1ec3m tra stage \u0111\u00e3 g\u1eafn.</li> </ul>"},{"location":"documentation/aggregationUpdate.html#luu-y-khi-su-dung","title":"L\u01b0u \u00fd khi s\u1eed d\u1ee5ng","text":"<ul> <li><code>AggregationUpdate</code> \u0111\u01b0\u1ee3c thi\u1ebft k\u1ebf cho update pipeline (\u0111\u00e3 h\u1ed7 tr\u1ee3 t\u1eeb MongoDB 4.2). \u0110\u1ea3m b\u1ea3o cluster/driver c\u1ee7a b\u1ea1n h\u1ed7 tr\u1ee3 update stage tr\u01b0\u1edbc khi \u00e1p d\u1ee5ng.</li> <li>V\u00ec <code>getUpdateObject()</code> tr\u1ea3 v\u1ec1 object v\u1edbi key r\u1ed7ng, b\u1ea1n th\u01b0\u1eddng c\u1ea7n adapter ho\u1eb7c mapper \u0111\u1ec3 chuy\u1ec3n \u0111\u1ed5i sang \u0111\u1ecbnh d\u1ea1ng m\u00e0 driver/ORM mong \u0111\u1ee3i (v\u00ed d\u1ee5 <code>$set</code>/<code>$unset</code> truy\u1ec1n th\u1ed1ng). \u0110\u00e2y l\u00e0 h\u00e0nh vi t\u01b0\u01a1ng th\u00edch v\u1edbi ph\u1ea7n c\u00f2n l\u1ea1i c\u1ee7a th\u01b0 vi\u1ec7n.</li> <li><code>keysTouched</code> ch\u1ec9 ph\u00e1t hi\u1ec7n field t\u1eeb <code>SetOperation</code>, <code>UnsetOperation</code> ho\u1eb7c b\u1ea5t k\u1ef3 stage n\u00e0o tri\u1ec3n khai <code>FieldsExposingAggregationOperation</code>. N\u1ebfu b\u1ea1n g\u1eafn c\u00e1c stage t\u00f9y bi\u1ebfn kh\u00f4ng expose field, <code>modifies(key)</code> c\u00f3 th\u1ec3 kh\u00f4ng ph\u1ea3n \u00e1nh \u0111\u1ea7y \u0111\u1ee7.</li> </ul>"},{"location":"documentation/systemVariables.html","title":"System Variables","text":"<p>Module <code>systemVariables</code> gom t\u1ea5t c\u1ea3 bi\u1ebfn h\u1ec7 th\u1ed1ng m\u00e0 MongoDB Aggregation Framework h\u1ed7 tr\u1ee3 \u0111\u1ec3 b\u1ea1n thao t\u00e1c an to\u00e0n trong TypeScript.</p>"},{"location":"documentation/systemVariables.html#enum-systemvariables","title":"Enum <code>SystemVariables</code>","text":"Enum Literal MongoDB C\u00f4ng d\u1ee5ng <code>NOW</code> <code>$$NOW</code> Th\u1eddi \u0111i\u1ec3m hi\u1ec7n t\u1ea1i d\u01b0\u1edbi d\u1ea1ng <code>Date</code>, c\u1ed1 \u0111\u1ecbnh trong m\u1ed7i pipeline run. <code>ROOT</code> <code>$$ROOT</code> T\u00e0i li\u1ec7u g\u1ed1c tr\u01b0\u1edbc khi bi\u1ebfn \u0111\u1ed5i b\u1edfi c\u00e1c stage. <code>CURRENT</code> <code>$$CURRENT</code> T\u00e0i li\u1ec7u \u1edf tr\u1ea1ng th\u00e1i hi\u1ec7n t\u1ea1i t\u1ea1i stage \u0111ang th\u1ef1c thi. <code>REMOVE</code> <code>$$REMOVE</code> Gi\u00e1 tr\u1ecb \u0111\u1eb7c bi\u1ec7t d\u00f9ng \u0111\u1ec3 x\u00f3a field trong <code>$addFields</code>, <code>$set</code>, \u2026"},{"location":"documentation/systemVariables.html#lop-systemvariablesimpl","title":"L\u1edbp <code>SystemVariablesImpl</code>","text":"<ul> <li>K\u1ebf th\u1eeba <code>AggregationVariable</code>, l\u01b0u tr\u1eef t\u00ean bi\u1ebfn v\u00e0 tr\u1ea3 v\u1ec1 chu\u1ed7i v\u1edbi ti\u1ec1n t\u1ed1 <code>$$</code>.</li> <li><code>getRaw()</code> tr\u1ea3 v\u1ec1 t\u00ean enum (kh\u00f4ng c\u00f3 <code>$$</code>), <code>getTarget()</code> ho\u1eb7c <code>toString()</code> tr\u1ea3 v\u1ec1 literal ho\u00e0n ch\u1ec9nh (<code>$$ROOT</code>).</li> <li>Thu\u1ed9c t\u00ednh <code>PREFIX</code> c\u1ed1 \u0111\u1ecbnh l\u00e0 <code>$$</code>, gi\u00fap b\u1ea3o \u0111\u1ea3m chu\u1ed7i h\u1ee3p l\u1ec7.</li> </ul> <pre><code>const rootVar = new SystemVariablesImpl(SystemVariables.ROOT);\nrootVar.toString(); // \"$$ROOT\"\n</code></pre>"},{"location":"documentation/systemVariables.html#ham-tien-ich","title":"H\u00e0m ti\u1ec7n \u00edch","text":"<ul> <li><code>SystemVariablesImpl.variableNameFrom(field: string | null)</code>: R\u00fat tr\u00edch t\u00ean bi\u1ebfn t\u1eeb chu\u1ed7i nh\u01b0 <code>$$NOW.createdAt</code>. N\u1ebfu kh\u00f4ng h\u1ee3p l\u1ec7 tr\u1ea3 v\u1ec1 <code>null</code>.</li> <li><code>SystemVariablesImpl.isReferingToSystemVariable(field: string)</code>: Ki\u1ec3m tra chu\u1ed7i c\u00f3 tham chi\u1ebfu t\u1edbi enum \u0111\u00e3 khai b\u00e1o hay kh\u00f4ng.</li> </ul> <pre><code>SystemVariablesImpl.isReferingToSystemVariable(\"$$CURRENT\") // true\nSystemVariablesImpl.variableNameFrom(\"$$NOW.createdAt\")     // \"NOW\"\n</code></pre>"},{"location":"documentation/systemVariables.html#su-dung-trong-pipeline","title":"S\u1eed d\u1ee5ng trong pipeline","text":"<pre><code>import { SystemVariables, SystemVariablesImpl } from \"@/systemVariables\";\n\npipeline.addFields({\ngeneratedAt: new SystemVariablesImpl(SystemVariables.NOW).getTarget(),\nrawDocument: new SystemVariablesImpl(SystemVariables.ROOT).toString(),\n});\n</code></pre> <p>Trong \u0111a s\u1ed1 builder, b\u1ea1n c\u00f3 th\u1ec3 truy\u1ec1n tr\u1ef1c ti\u1ebfp instance <code>SystemVariablesImpl</code> v\u00ec ch\u00fang t\u1ef1 chuy\u1ec3n th\u00e0nh chu\u1ed7i khi c\u1ea7n. \u01afu ti\u00ean enum thay v\u00ec t\u1ef1 g\u00f5 literal \u0111\u1ec3 tr\u00e1nh sai ch\u00ednh t\u1ea3 v\u00e0 \u0111\u1ed3ng b\u1ed9 v\u1edbi phi\u00ean b\u1ea3n MongoDB \u0111\u01b0\u1ee3c h\u1ed7 tr\u1ee3.</p>"},{"location":"documentation/operations/addFieldsOperation.html","title":"AddFields Operation","text":"<p><code>AddFieldsOperation</code> \u0111\u1ea1i di\u1ec7n cho to\u00e1n t\u1eed <code>$addFields</code> c\u1ee7a mongoDB. N\u00f3 c\u00f3 c\u00e1c method gi\u00fap b\u1ea1n kh\u1edfi t\u1ea1o stage <code>$addFields</code> thay v\u00ec ph\u1ea3i vi\u1ebft BSON th\u1ee7 c\u00f4ng.</p> <pre><code>import { AddFieldsOperation } from 'red-aggregation/operations';\n</code></pre>"},{"location":"documentation/operations/addFieldsOperation.html#phuong-thuc","title":"Ph\u01b0\u01a1ng th\u1ee9c","text":"<ul> <li>AddFieldsOperation.addField()</li> <li>AddFieldsOperation.builder()</li> </ul>"},{"location":"documentation/operations/addFieldsOperation.html#addfieldsoperationaddfield","title":"AddFieldsOperation.addField()","text":"<pre><code>const operation = AddFieldsOperation.addField('name', 'John');\nconst doc = operation.toDocument(context);\n\n// =&gt; { $addFields: { name: \"John\" } }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>const operation = AddFieldsOperation.addField('fullName', Fields.field('firstName'));\nconst doc = operation.toDocument(context);\n\n// =&gt; { $addFields: { fullName: \"$firstName\" } }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>const operation = AddFieldsOperation.addField('total', ArithmeticOperators.add('$price').add('$tax'));\nconst doc = operation.toDocument(context);\n\n// =&gt; { $addFields: { total: { $add: [\"$price\", \"$tax\"] } } }\n</code></pre>"},{"location":"documentation/operations/addFieldsOperation.html#addfieldsoperationbuilder","title":"AddFieldsOperation.builder()","text":"<pre><code>const operation = AddFieldsOperation.builder()\n.addField(\"name\").withValue(\"John\")\n.addField(\"age\").withValue(25)\n.build();\n\nconst doc = operation.toDocument(context);\n\n// =&gt; { $addFields: { name: \"$John\", age: 25 } }\n</code></pre> <pre><code>const operation = AddFieldsOperation.builder()\n.addFieldWithValueOf('name', 'John')\n.addFieldWithValueOf('age', 25)\n.build();\nconst doc = operation.toDocument(context);\n\n// =&gt; { $addFields: { name: \"$John\", age: 25 } }\n</code></pre> <pre><code>const operation = AddFieldsOperation.builder()\n.addField('fullName')\n.withValueOf(ArithmeticOperators.add('$firstName').add('$lastName'))\n.addField('discount')\n.withValueOf(ArithmeticOperators.multiply('$price').multiplyBy(0.1))\n.build();\n\nconst doc = operation.toDocument(context);\n\n// =&gt; {\n//      $addFields: {\n//          fullName: { $add: [\"$firstName\", \"$lastName\"] },\n//          discount: { $multiply: [\"$price\", 0.1] }\n//      }\n//    }\n</code></pre>"},{"location":"documentation/operations/countOperation.html","title":"Count Operation","text":"<p><code>CountOperation</code> \u0111\u1ea1i di\u1ec7n cho stage <code>$count</code> c\u1ee7a MongoDB. N\u00f3 gi\u00fap b\u1ea1n kh\u1edfi t\u1ea1o stage \u0111\u1ebfm s\u1ed1 l\u01b0\u1ee3ng document kh\u1edbp pipeline m\u00e0 kh\u00f4ng c\u1ea7n vi\u1ebft BSON th\u1ee7 c\u00f4ng.</p> <pre><code>import { CountOperation, CountOperationBuilder } from 'red-aggregation/operations';\n</code></pre>"},{"location":"documentation/operations/countOperation.html#phuong-thuc","title":"Ph\u01b0\u01a1ng th\u1ee9c","text":"<ul> <li>new CountOperation()</li> <li>CountOperationBuilder.as()</li> </ul>"},{"location":"documentation/operations/countOperation.html#new-countoperation","title":"new CountOperation()","text":"<p>T\u1ea1o tr\u1ef1c ti\u1ebfp m\u1ed9t stage <code>$count</code> v\u1edbi t\u00ean field \u0111\u1ea7u ra.</p> <pre><code>const operation = new CountOperation('total');\nconst doc = operation.toDocument(context);\n\n// =&gt; { $count: 'total' }\n</code></pre> <p>Ho\u1eb7c v\u1edbi t\u00ean field kh\u00e1c:</p> <pre><code>const operation = new CountOperation('productCount');\nconst doc = operation.toDocument(context);\n\n// =&gt; { $count: 'productCount' }\n</code></pre>"},{"location":"documentation/operations/countOperation.html#countoperationbuilderas","title":"CountOperationBuilder.as()","text":"<p>S\u1eed d\u1ee5ng builder \u0111\u1ec3 \u0111\u1eb7t t\u00ean field k\u1ebft qu\u1ea3.</p> <pre><code>const operation = new CountOperationBuilder().as('total');\nconst doc = operation.toDocument(context);\n\n// =&gt; { $count: 'total' }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>const operation = new CountOperationBuilder().as('productCount');\nconst doc = operation.toDocument(context);\n\n// =&gt; { $count: 'productCount' }\n</code></pre>"},{"location":"documentation/operations/countOperation.html#luu-y-su-dung","title":"L\u01b0u \u00fd s\u1eed d\u1ee5ng","text":"<ul> <li>T\u00ean field b\u1eaft bu\u1ed9c, kh\u00f4ng \u0111\u01b0\u1ee3c null/undefined/chu\u1ed7i r\u1ed7ng; vi ph\u1ea1m s\u1ebd n\u00e9m l\u1ed7i \"Field name must not be null\".</li> <li><code>CountOperation</code> kh\u00f4ng k\u1ebf th\u1eeba field t\u1eeb c\u00e1c stage tr\u01b0\u1edbc \u0111\u00f3; \u0111\u1ea7u ra l\u00e0 m\u1ed9t document duy nh\u1ea5t c\u00f3 field b\u1eb1ng t\u00ean \u0111\u00e3 ch\u1ec9 \u0111\u1ecbnh.</li> </ul>"},{"location":"documentation/operations/facetOperation.html","title":"Facet Operation","text":"<p><code>FacetOperation</code> \u0111\u1ea1i di\u1ec7n cho stage <code>$facet</code> c\u1ee7a MongoDB. N\u00f3 cho ph\u00e9p ch\u1ea1y nhi\u1ec1u pipeline song song v\u00e0 gom k\u1ebft qu\u1ea3 v\u00e0o m\u1ed9t document theo c\u00e1c key \u0111\u1ecbnh danh, gi\u00fap b\u1ea1n t\u1ea1o b\u00e1o c\u00e1o/t\u1ed5ng h\u1ee3p \u0111a chi\u1ec1u trong m\u1ed9t l\u1ea7n qu\u00e9t d\u1eef li\u1ec7u.</p> <pre><code>import { FacetOperation } from 'red-aggregation/operations';\n</code></pre>"},{"location":"documentation/operations/facetOperation.html#phuong-thuc","title":"Ph\u01b0\u01a1ng th\u1ee9c","text":"<ul> <li>FacetOperation.EMPTY</li> <li>FacetOperation.newFacet()</li> <li>FacetOperation.and().as()</li> </ul>"},{"location":"documentation/operations/facetOperation.html#facetoperationempty","title":"FacetOperation.EMPTY","text":"<p>Kh\u1edfi t\u1ea1o <code>$facet</code> r\u1ed7ng.</p> <pre><code>const doc = FacetOperation.EMPTY.toDocument(context);\n\n// =&gt; { $facet: {} }\n</code></pre>"},{"location":"documentation/operations/facetOperation.html#facetoperationandas","title":"FacetOperation.and().as()","text":"<p>Th\u00eam m\u1ed9t pipeline v\u00e0 \u0111\u1eb7t t\u00ean facet b\u1eb1ng <code>.as(name)</code>.</p> <pre><code>// V\u00ed d\u1ee5 v\u1edbi stage gi\u1ea3 l\u1eadp\nconst stage = new RecordingOperation({ $match: { status: 'ACTIVE' } });\nconst operation = FacetOperation.EMPTY.and(stage).as('activeOrders');\nconst document = operation.toDocument(context);\n\n// =&gt; {\n//   $facet: {\n//     activeOrders: [[{ $match: { status: 'ACTIVE' } }]]\n//   }\n// }\n</code></pre> <p>Th\u00eam nhi\u1ec1u facet li\u00ean ti\u1ebfp:</p> <pre><code>const matchStage = new RecordingOperation({ $match: { status: 'ACTIVE' } });\nconst sortStage = new RecordingOperation({ $sort: { createdAt: -1 } });\n\nconst operation = FacetOperation.EMPTY\n.and(matchStage).as('active')\n.and(sortStage).as('recent');\nconst document = operation.toDocument(context);\n\n// =&gt; {\n//   $facet: {\n//     active: [[{ $match: { status: 'ACTIVE' } }]],\n//     recent: [[{ $sort: { createdAt: -1 } }]]\n//   }\n// }\n</code></pre>"},{"location":"documentation/operations/facetOperation.html#facetoperationnewfacet","title":"FacetOperation.newFacet()","text":"<p>Kh\u1edfi t\u1ea1o t\u1eeb <code>Facets</code> c\u00f3 s\u1eb5n.</p> <pre><code>const stage = new RecordingOperation({ $count: 'total' });\nconst facets = Facets.EMPTY.and('counts', [stage]);\n\nconst operation = FacetOperation.newFacet(facets);\nconst document = operation.toDocument(context);\n\n// =&gt; {\n//   $facet: {\n//     counts: [[{ $count: 'total' }]]\n//   }\n// }\n</code></pre>"},{"location":"documentation/operations/facetOperation.html#luu-y-su-dung","title":"L\u01b0u \u00fd s\u1eed d\u1ee5ng","text":"<ul> <li><code>.and(...operations)</code> y\u00eau c\u1ea7u truy\u1ec1n \u00edt nh\u1ea5t m\u1ed9t stage; name trong <code>.as(name)</code> ph\u1ea3i kh\u00f4ng r\u1ed7ng (\u0111\u01b0\u1ee3c ki\u1ec3m tra b\u1edfi <code>Assert</code>).</li> <li><code>getFields()</code> tr\u1ea3 v\u1ec1 c\u00e1c field \u0111\u01b0\u1ee3c expose t\u01b0\u01a1ng \u1ee9ng v\u1edbi m\u1ed7i facet, h\u1eefu \u00edch cho h\u1ec7 th\u1ed1ng g\u1ee3i \u00fd \u1edf c\u00e1c b\u01b0\u1edbc sau c\u1ee7a pipeline.</li> <li>K\u1ebft qu\u1ea3 <code>$facet</code> l\u00e0 m\u1ed9t document ch\u1ee9a m\u1ed7i key l\u00e0 t\u00ean facet, gi\u00e1 tr\u1ecb l\u00e0 m\u1ed9t m\u1ea3ng c\u00e1c pipeline (theo \u0111\u00fang format MongoDB).</li> </ul>"},{"location":"documentation/operations/groupOperation.html","title":"Group Operation","text":"<p><code>GroupOperation</code> \u0111\u1ea1i di\u1ec7n cho stage <code>$group</code> c\u1ee7a MongoDB. N\u00f3 cho ph\u00e9p nh\u00f3m d\u1eef li\u1ec7u theo m\u1ed9t ho\u1eb7c nhi\u1ec1u field v\u00e0 t\u00ednh to\u00e1n c\u00e1c s\u1ed1 li\u1ec7u t\u1ed5ng h\u1ee3p nh\u01b0 <code>$sum</code>, <code>$avg</code>, <code>$min</code>, <code>$max</code>, <code>$first</code>, <code>$last</code>, <code>$push</code>, <code>$addToSet</code>, <code>$stdDevPop</code>, <code>$stdDevSamp</code>\u2026 b\u1eb1ng c\u00fa ph\u00e1p builder m\u1ea1ch l\u1ea1c.</p> <pre><code>import { GroupOperation } from 'red-aggregation/operations';\nimport { Fields } from 'red-aggregation/aggregate/field';\n</code></pre>"},{"location":"documentation/operations/groupOperation.html#phuong-thuc","title":"Ph\u01b0\u01a1ng th\u1ee9c","text":"<ul> <li>new GroupOperation(Fields.fields(...))</li> <li>sum()/avg()/min()/max()/first()/last()/push()/addToSet()/stdDevPop()/stdDevSamp()/count()</li> <li>builder.as(alias)</li> <li>and(fieldName, expression)</li> </ul>"},{"location":"documentation/operations/groupOperation.html#new-groupoperation","title":"new GroupOperation()","text":"<p>Kh\u1edfi t\u1ea1o <code>$group</code> v\u1edbi key <code>_id</code> l\u00e0 danh s\u00e1ch field.</p> <pre><code>// Kh\u00f4ng c\u00f3 field -&gt; _id: null\nnew GroupOperation(Fields.fields())\n.toDocument(context);\n// =&gt; { $group: { _id: null } }\n\n// M\u1ed9t field -&gt; _id l\u00e0 chu\u1ed7i tham chi\u1ebfu\nnew GroupOperation(Fields.fields('category'))\n.toDocument(context);\n// =&gt; { $group: { _id: '$category' } }\n\n// Nhi\u1ec1u field -&gt; _id l\u00e0 object\nnew GroupOperation(Fields.fields('category', 'status'))\n.toDocument(context);\n// =&gt; { $group: { _id: { category: '$category', status: '$status' } } }\n</code></pre>"},{"location":"documentation/operations/groupOperation.html#group-aggregators","title":"Group aggregators","text":"<p>C\u00e1c aggregator tr\u1ea3 v\u1ec1 builder; g\u1ecdi <code>.as(alias)</code> \u0111\u1ec3 \u0111\u1eb7t t\u00ean field k\u1ebft qu\u1ea3.</p> <pre><code>// T\u1ed5ng h\u1ee3p nhi\u1ec1u ph\u00e9p trong m\u1ed9t group\nconst op = new GroupOperation(Fields.fields('category'))\n.sum('price').as('total')\n.avg('price').as('avgPrice');\n\nop.toDocument(context);\n// =&gt; { $group: { _id: '$category', total: { $sum: '$price' }, avgPrice: { $avg: '$price' } } }\n</code></pre> <p>\u0110\u1ebfm s\u1ed1 ph\u1ea7n t\u1eed b\u1eb1ng <code>.count()</code> (mapping v\u1ec1 <code>{ $sum: 1 }</code>):</p> <pre><code>new GroupOperation(Fields.fields('category'))\n.count().as('count')\n.toDocument(context);\n// =&gt; { $group: { _id: '$category', count: { $sum: 1 } } }\n</code></pre> <p>V\u00ed d\u1ee5 t\u1ed5ng h\u1ee3p:</p> <pre><code>new GroupOperation(Fields.fields('department'))\n.sum('salary').as('totalSalary')\n.avg('salary').as('avgSalary')\n.min('salary').as('minSalary')\n.max('salary').as('maxSalary')\n.count().as('employeeCount')\n.push('name').as('employeeNames')\n.addToSet('skill').as('uniqueSkills')\n.toDocument(context);\n// =&gt; {\n//   $group: {\n//     _id: '$department',\n//     totalSalary: { $sum: '$salary' },\n//     avgSalary: { $avg: '$salary' },\n//     minSalary: { $min: '$salary' },\n//     maxSalary: { $max: '$salary' },\n//     employeeCount: { $sum: 1 },\n//     employeeNames: { $push: '$name' },\n//     uniqueSkills: { $addToSet: '$skill' },\n//   }\n// }\n</code></pre>"},{"location":"documentation/operations/groupOperation.html#builderasalias","title":"builder.as(alias)","text":"<p>M\u1ecdi aggregator/builder y\u00eau c\u1ea7u <code>.as(alias)</code> \u0111\u1ec3 \u0111\u1eb7t t\u00ean field \u0111\u1ea7u ra.</p> <pre><code>new GroupOperation(Fields.fields('category'))\n.sum('price').as('total');\n</code></pre>"},{"location":"documentation/operations/groupOperation.html#andfieldname-expression","title":"and(fieldName, expression)","text":"<p>Th\u00eam m\u1ed9t ph\u00e9p nh\u00f3m tr\u1ef1c ti\u1ebfp t\u1eeb t\u00ean field + bi\u1ec3u th\u1ee9c (b\u1ecf qua helper aggregator).</p> <pre><code>new GroupOperation(Fields.fields('category'))\n.and('totalPrice', { $multiply: ['$price', 1.1] });\n</code></pre>"},{"location":"documentation/operations/groupOperation.html#luu-y-su-dung","title":"L\u01b0u \u00fd s\u1eed d\u1ee5ng","text":"<ul> <li><code>_id</code> \u0111\u01b0\u1ee3c thi\u1ebft l\u1eadp d\u1ef1a tr\u00ean danh s\u00e1ch field: r\u1ed7ng -&gt; <code>null</code>, m\u1ed9t field -&gt; <code>'$field'</code>, nhi\u1ec1u field -&gt; object.</li> <li><code>.count()</code> t\u01b0\u01a1ng \u0111\u01b0\u01a1ng th\u00eam <code>{ $sum: 1 }</code> v\u1edbi alias b\u1ea1n ch\u1ec9 \u0111\u1ecbnh.</li> <li><code>.as(alias)</code> l\u00e0 b\u1eaft bu\u1ed9c cho m\u1ed7i ph\u00e9p t\u1ed5ng h\u1ee3p, n\u1ebfu kh\u00f4ng s\u1ebd n\u00e9m l\u1ed7i khi render.</li> <li>H\u1ed7 tr\u1ee3 truy\u1ec1n reference d\u1ea1ng string, <code>AggregationExpression</code> ho\u1eb7c BSON object cho t\u1eebng aggregator.</li> </ul>"},{"location":"documentation/operations/limitOperation.html","title":"Limit Operation","text":"<p><code>LimitOperation</code> \u0111\u1ea1i di\u1ec7n cho stage <code>$limit</code> c\u1ee7a MongoDB. D\u00f9ng \u0111\u1ec3 gi\u1edbi h\u1ea1n s\u1ed1 l\u01b0\u1ee3ng t\u00e0i li\u1ec7u tr\u1ea3 v\u1ec1 trong pipeline.</p> <pre><code>import { Limit } from 'red-aggregation/operations'; // alias/export c\u1ee7a LimitOperation (n\u1ebfu d\u00f9ng tr\u1ef1c ti\u1ebfp class th\u00ec: import { LimitOperation } ...)\n</code></pre>"},{"location":"documentation/operations/limitOperation.html#phuong-thuc","title":"Ph\u01b0\u01a1ng th\u1ee9c","text":"<ul> <li>new Limit(number)</li> </ul>"},{"location":"documentation/operations/limitOperation.html#new-limitcount","title":"new Limit(count)","text":"<p>Kh\u1edfi t\u1ea1o stage <code>$limit</code> v\u1edbi s\u1ed1 l\u01b0\u1ee3ng ph\u1ea7n t\u1eed t\u1ed1i \u0111a c\u1ea7n l\u1ea5y. Gi\u00e1 tr\u1ecb ph\u1ea3i l\u00e0 s\u1ed1 kh\u00f4ng \u00e2m.</p> <pre><code>new Limit(0).to\u7136; // ho\u1eb7c: new LimitOperation(0).toDocument(context)\n// =&gt; { $limit: 0 }\n\nnew Limit(1).toDocument(context);\n// =&gt; { $limit: 1 }\n\nnew Limit(25).toDocument(context);\n// =&gt; { $limit: 25 }\n</code></pre>"},{"location":"documentation/operations/limitOperation.html#luu-y-su-dung","title":"L\u01b0u \u00fd s\u1eed d\u1ee5ng","text":"<ul> <li><code>count</code> ph\u1ea3i l\u00e0 s\u1ed1 nguy\u00ean kh\u00f4ng \u00e2m; n\u1ebfu nh\u1ecf h\u01a1n 0 s\u1ebd n\u00e9m l\u1ed7i: \"Maximum number of elements must be greater or equal to 0\".</li> <li><code>Limit</code> kh\u00f4ng thay \u0111\u1ed5i c\u1ea5u tr\u00fac t\u00e0i li\u1ec7u, ch\u1ec9 c\u1eaft s\u1ed1 l\u01b0\u1ee3ng b\u1ea3n ghi \u0111i qua stage.</li> </ul>"},{"location":"documentation/operations/lookupOperation.html","title":"Lookup Operation","text":"<p><code>LookupOperation</code> \u0111\u1ea1i di\u1ec7n cho stage <code>$lookup</code> c\u1ee7a MongoDB. N\u00f3 cho ph\u00e9p join d\u1eef li\u1ec7u gi\u1eefa c\u00e1c collection b\u1eb1ng <code>localField/foreignField</code> (lookup \u0111\u01a1n gi\u1ea3n) ho\u1eb7c d\u00f9ng <code>let</code> + <code>pipeline</code> (correlated subquery). H\u00e3y s\u1eed d\u1ee5ng builder thay v\u00ec kh\u1edfi t\u1ea1o tr\u1ef1c ti\u1ebfp <code>new LookupOperation(...)</code>.</p> <pre><code>import { LookupOperationBuilder } from 'red-aggregation/operations/lookupOperation';\nimport { AggregationPipeline } from 'red-aggregation/aggregationPipeline';\nimport { ExpressionVariable } from 'red-aggregation/operator/variableOperators/let';\n</code></pre>"},{"location":"documentation/operations/lookupOperation.html#phuong-thuc-builder","title":"Ph\u01b0\u01a1ng th\u1ee9c (Builder)","text":"<ul> <li>LookupOperationBuilder.from().localField().foreignField().as()</li> <li>LookupOperationBuilder.from().let().pipeline().as()</li> </ul>"},{"location":"documentation/operations/lookupOperation.html#builder-lookup-on-gian-localfieldforeignfield","title":"Builder: lookup \u0111\u01a1n gi\u1ea3n (localField/foreignField)","text":"<pre><code>new LookupOperation(\n// KH\u00d4NG khuy\u1ebfn ngh\u1ecb d\u00f9ng tr\u1ef1c ti\u1ebfp constructor\n); // \u274c\n\n// N\u00ean d\u00f9ng builder:\nnew LookupOperation(\n// \u2705 S\u1eed d\u1ee5ng builder thay cho constructor\n);\n\n// V\u00ed d\u1ee5:\nnew LookupOperationBuilder()\n.from('orders')\n.localField('customerId')\n.foreignField('id')\n.as('customer')\n.toDocument(context);\n// =&gt; {\n//   $lookup: {\n//     from: 'orders',\n//     as: 'customer',\n//     localField: 'customerId',\n//     foreignField: 'id'\n//   }\n// }\n</code></pre>"},{"location":"documentation/operations/lookupOperation.html#builder-lookup-co-let-pipeline-correlated","title":"Builder: lookup c\u00f3 <code>let</code> + <code>pipeline</code> (correlated)","text":"<pre><code>// Chu\u1ea9n b\u1ecb bi\u1ebfn \u0111\u1ea7u v\u00e0o cho pipeline con\nconst varOrderId = ExpressionVariable\n.newVariable('orderId')\n.forField('orderId');\n\n// V\u00ed d\u1ee5 1: m\u1ed9t stage trong pipeline\nnew LookupOperation(\n// KH\u00d4NG khuy\u1ebfn ngh\u1ecb d\u00f9ng tr\u1ef1c ti\u1ebfp constructor\n); // \u274c\n\n// N\u00ean d\u00f9ng builder:\nnew LookupOperationBuilder()\n.from('orders')\n.let(varOrderId)\n// C\u00f3 th\u1ec3 truy\u1ec1n m\u1ed9t ho\u1eb7c nhi\u1ec1u stage.\n.pipeline(\n/* m\u1ed9t AggregateOperation t\u01b0\u01a1ng \u0111\u01b0\u01a1ng { $match: { $expr: { $eq: ['$id', '$$orderId'] } } } */\n)\n.as('matchedOrders')\n.toDocument(context);\n// =&gt; {\n//   $lookup: {\n//     from: 'orders',\n//     as: 'matchedOrders',\n//     let: { orderId: '$orderId' },\n//     pipeline: [[ { $match: { $expr: { $eq: ['$id', '$$orderId'] } } } ]]\n//   }\n// }\n\n// V\u00ed d\u1ee5 2: nhi\u1ec1u stage trong pipeline\nnew LookupOperationBuilder()\n.from('orders')\n.let( ExpressionVariable.newVariable('customerId').forField('customerId') )\n.pipeline(\n/* stage 1: { $match: { status: 'ACTIVE' } } */,\n/* stage 2: { $project: { status: 1 } } */\n)\n.toDocument(context)\n.as('activeOrders');\n// =&gt; {\n//   $lookup: {\n//     from: 'orders',\n//     as: 'activeOrders',\n//     let: { customerId: '$customerId' },\n//     pipeline: [ [{ $match: { status: 'ACTIVE' }}], [{ $project: { status: 1 }}] ]\n//   }\n// }\n</code></pre>"},{"location":"documentation/operations/lookupOperation.html#luu-y-su-dung","title":"L\u01b0u \u00fd s\u1eed d\u1ee5ng","text":"<ul> <li>Ch\u1ec9 s\u1eed d\u1ee5ng <code>LookupOperationBuilder</code> (kh\u00f4ng kh\u1edfi t\u1ea1o <code>new LookupOperation(...)</code> tr\u1ef1c ti\u1ebfp).</li> <li>Lookup \u0111\u01a1n gi\u1ea3n y\u00eau c\u1ea7u <code>from</code>, <code>localField</code>, <code>foreignField</code>, <code>as</code>.</li> <li>Lookup correlated (pipeline) y\u00eau c\u1ea7u <code>from</code>, <code>let</code> (m\u1ed9t ho\u1eb7c nhi\u1ec1u <code>ExpressionVariable</code>) v\u00e0 <code>pipeline</code>; <code>as</code> l\u00e0 b\u1eaft bu\u1ed9c \u0111\u1ec3 t\u00ean tr\u01b0\u1eddng k\u1ebft qu\u1ea3.</li> <li>Tr\u01b0\u1eddng <code>let</code> \u0111\u01b0\u1ee3c \u00e1nh x\u1ea1 th\u00e0nh <code>vars</code> b\u00ean trong <code>$lookup.pipeline</code>. Pipeline nh\u1eadn m\u1ed9t <code>AggregationPipeline</code> ho\u1eb7c danh s\u00e1ch c\u00e1c <code>AggregateOperation</code> (m\u1ed7i stage \u0111\u01b0\u1ee3c bao trong m\u1ed9t m\u1ea3ng con trong \u0111\u1ea7u ra).</li> </ul>"},{"location":"documentation/operations/matchOperation.html","title":"Match Operation","text":"<p><code>MatchOperation</code> \u0111\u1ea1i di\u1ec7n cho stage <code>$match</code> c\u1ee7a MongoDB. D\u00f9ng \u0111\u1ec3 l\u1ecdc t\u00e0i li\u1ec7u theo \u0111i\u1ec1u ki\u1ec7n (criteria) ho\u1eb7c theo m\u1ed9t <code>AggregationExpression</code> (v\u00ed d\u1ee5 <code>$expr</code>).</p> <pre><code>import { MatchOperation } from 'red-aggregation/operations/matchOperation';\n</code></pre>"},{"location":"documentation/operations/matchOperation.html#phuong-thuc","title":"Ph\u01b0\u01a1ng th\u1ee9c","text":"<ul> <li>new MatchOperation(criteria: Document)</li> <li>new MatchOperation(expression: AggregationExpression)</li> <li>new MatchOperation(ClauseDefinition)</li> </ul>"},{"location":"documentation/operations/matchOperation.html#new-matchoperation-voi-raw-bson","title":"new MatchOperation (v\u1edbi raw BSON)","text":"<p>T\u1ea1o <code>$match</code> tr\u1ef1c ti\u1ebfp t\u1eeb m\u1ed9t raw BSON \u0111i\u1ec1u ki\u1ec7n.</p> <pre><code>const criteria = { status: 'ACTIVE' };\nnew MatchOperation(criteria).toDocument(context);\n// =&gt; { $match: { status: 'ACTIVE' } }\n</code></pre>"},{"location":"documentation/operations/matchOperation.html#new-matchoperation-voi-aggregationexpression","title":"new MatchOperation (v\u1edbi AggregationExpression)","text":"<p>Truy\u1ec1n v\u00e0o m\u1ed9t <code>AggregationExpression</code> (v\u00ed d\u1ee5 bi\u1ec3u th\u1ee9c <code>$expr</code> \u0111\u01b0\u1ee3c d\u1ef1ng s\u1eb5n) \u0111\u1ec3 t\u1ea1o n\u1ed9i dung c\u1ee7a <code>$match</code>.</p> <pre><code>const expr = new StubAggregationExpression({ score: { $gt: 10 } });\nnew MatchOperation(expr).toDocument(context);\n// =&gt; { $match: { score: { $gt: 10 } } }\n</code></pre>"},{"location":"documentation/operations/matchOperation.html#new-matchoperation-voi-criteriadefinition","title":"new MatchOperation (v\u1edbi CriteriaDefinition)","text":"<p>C\u00f3 th\u1ec3 d\u00f9ng <code>ClauseDefinition</code> (Criteria DSL) \u0111\u1ec3 t\u1ea1o <code>$match</code>.</p> <pre><code>const def = new ClauseDefinition(/* ... */); // v\u00ed d\u1ee5: tr\u1ea3 v\u1ec1 { role: { $eq: 'admin' } }\nnew MatchOperation(def).toDocument(context);\n// =&gt; { $match: { role: { $eq: 'admin' } } }\n</code></pre>"},{"location":"documentation/operations/matchOperation.html#luu-y-su-dung","title":"L\u01b0u \u00fd s\u1eed d\u1ee5ng","text":"<ul> <li>Tham s\u1ed1 truy\u1ec1n v\u00e0o constructor b\u1eaft bu\u1ed9c kh\u00f4ng \u0111\u01b0\u1ee3c <code>null</code>/<code>undefined</code>, vi ph\u1ea1m s\u1ebd n\u00e9m l\u1ed7i: \\\"Expression must not be null\\\".</li> <li>Khi truy\u1ec1n <code>AggregationExpression</code>, <code>toDocument(context)</code> c\u1ee7a bi\u1ec3u th\u1ee9c s\u1ebd \u0111\u01b0\u1ee3c g\u1ecdi \u0111\u1ec3 l\u1ea5y n\u1ed9i dung <code>$match</code>.</li> <li>Khi truy\u1ec1n <code>Document</code> (criteria th\u00f4), \u0111\u1ed1i t\u01b0\u1ee3ng s\u1ebd \u0111\u01b0\u1ee3c map qua <code>context.getMappedObject(...)</code> tr\u01b0\u1edbc khi \u0111\u01b0a v\u00e0o <code>$match</code>.</li> </ul>"},{"location":"documentation/operations/mergeOperation.html","title":"Merge Operation","text":"<p><code>MergeOperation</code> \u0111\u1ea1i di\u1ec7n cho stage <code>$merge</code> c\u1ee7a MongoDB. D\u00f9ng \u0111\u1ec3 ghi k\u1ebft qu\u1ea3 c\u1ee7a pipeline v\u00e0o m\u1ed9t collection (c\u00f3 th\u1ec3 c\u00f9ng DB ho\u1eb7c kh\u00e1c DB), v\u1edbi c\u00e1c t\u00f9y ch\u1ecdn kh\u00f3a <code>on</code>, bi\u1ebfn <code>let</code>, v\u00e0 h\u00e0nh vi khi tr\u00f9ng/kh\u00f4ng tr\u00f9ng t\u00e0i li\u1ec7u. S\u1eed d\u1ee5ng builder <code>MergeOperation.builder()</code> (kh\u00f4ng kh\u1edfi t\u1ea1o tr\u1ef1c ti\u1ebfp).</p> <pre><code>import { MergeOperation } from 'red-aggregation/operations/mergeOperation';\nimport { ExpressionVariable, Let } from 'red-aggregation/operator/variableOperators/let';\nimport { WhenDocumentMatch } from 'red-aggregation/operations/mergeOperation/whenDocumentsMatch';\nimport { WhenDocumentsDontMatch } from 'red-aggregation/operations/mergeOperation/whenDocumentsdontMatch';\n</code></pre>"},{"location":"documentation/operations/mergeOperation.html#phuong-thuc-builder","title":"Ph\u01b0\u01a1ng th\u1ee9c (Builder)","text":"<ul> <li>MergeOperation.builder().intoCollection().build()</li> <li>inDatabase()</li> <li>on(...idFields)</li> <li>let()/exposeVariablesOf()</li> <li>whenMatched()/whenDocumentsMatchApply()</li> <li>whenNotMatched()</li> </ul>"},{"location":"documentation/operations/mergeOperation.html#ghi-vao-collection","title":"Ghi v\u00e0o collection","text":"<pre><code>MergeOperation.builder()\n.intoCollection('users')\n.build()\n.toDocument(context);\n// =&gt; { $merge: 'users' }\n</code></pre>"},{"location":"documentation/operations/mergeOperation.html#ghi-vao-collection-o-db-khac","title":"Ghi v\u00e0o collection \u1edf DB kh\u00e1c","text":"<pre><code>MergeOperation.builder()\n.intoCollection('users')\n.inDatabase('analytics')\n.build()\n.toDocument(context);\n// =&gt; { $merge: { into: { db: 'analytics', coll: 'users' } } }\n</code></pre>"},{"location":"documentation/operations/mergeOperation.html#at-truong-khoa-on","title":"\u0110\u1eb7t tr\u01b0\u1eddng kh\u00f3a <code>on</code>","text":"<pre><code>MergeOperation.builder()\n.intoCollection('users')\n.on('email', 'tenantId')\n.build()\n.toDocument(context);\n// =&gt; { $merge: { into: 'users', on: ['email', 'tenantId'] } }\n</code></pre>"},{"location":"documentation/operations/mergeOperation.html#truyen-bien-vao-sub-pipeline-let","title":"Truy\u1ec1n bi\u1ebfn v\u00e0o sub-pipeline (<code>let</code>)","text":"<pre><code>const lets = Let.just(\nExpressionVariable.newVariable('temp').forField('price'),\nExpressionVariable.newVariable('discount').forField('discountRate')\n);\n\nMergeOperation.builder()\n.intoCollection('users')\n.let(lets) // ho\u1eb7c .exposeVariablesOf(lets)\n.build()\n.toDocument(context);\n// =&gt; {\n//   $merge: {\n//     into: 'users',\n//     let: { temp: '$price', discount: '$discountRate' }\n//   }\n// }\n</code></pre>"},{"location":"documentation/operations/mergeOperation.html#hanh-vi-khi-trungkhong-trung","title":"H\u00e0nh vi khi tr\u00f9ng/kh\u00f4ng tr\u00f9ng","text":"<ul> <li>Khi tr\u00f9ng (<code>whenMatched</code>): ch\u1ecdn m\u1ed9t trong c\u00e1c h\u00e0nh vi ho\u1eb7c c\u1eadp nh\u1eadt theo pipeline</li> </ul> <pre><code>// Gi\u1eef t\u00e0i li\u1ec7u hi\u1ec7n c\u00f3\nMergeOperation.builder()\n.intoCollection('users')\n.whenMatched(WhenDocumentMatch.keepExistingDocument())\n.build()\n.toDocument(context);\n// =&gt; { $merge: { into: 'users', whenMatched: 'keepExisting' } }\n\n// C\u1eadp nh\u1eadt b\u1eb1ng pipeline\nconst pipelineStages = [ { $set: { updatedAt: '$$NOW' } } ];\nMergeOperation.builder()\n.intoCollection('users')\n.whenMatched(WhenDocumentMatch.updateWith(pipelineStages as any))\n.build()\n.toDocument(context);\n// =&gt; { $merge: { into: 'users', whenMatched: [ { $set: { updatedAt: '$$NOW' } } ] } }\n</code></pre> <ul> <li>Khi kh\u00f4ng tr\u00f9ng (<code>whenNotMatched</code>): <code>insert</code>, <code>discard</code>, ho\u1eb7c <code>fail</code></li> </ul> <pre><code>MergeOperation.builder()\n.intoCollection('users')\n.whenNotMatched(WhenDocumentsDontMatch.insertNewDocument())\n.build()\n.toDocument(context);\n// =&gt; { $merge: { into: 'users', whenNotMatched: 'insert' } }\n</code></pre>"},{"location":"documentation/operations/mergeOperation.html#luu-y-su-dung","title":"L\u01b0u \u00fd s\u1eed d\u1ee5ng","text":"<ul> <li>Lu\u00f4n d\u00f9ng <code>MergeOperation.builder()</code>; constructor n\u1ed9i b\u1ed9 y\u00eau c\u1ea7u nhi\u1ec1u tham s\u1ed1 v\u00e0 \u0111\u00e3 \u0111\u01b0\u1ee3c builder bao g\u00f3i.</li> <li><code>intoCollection(name)</code> l\u00e0 b\u1eaft bu\u1ed9c v\u00e0 kh\u00f4ng \u0111\u01b0\u1ee3c r\u1ed7ng.</li> <li><code>on(...fields)</code> \u0111\u1eb7t kh\u00f3a duy nh\u1ea5t \u0111\u1ec3 d\u00f2 tr\u00f9ng (m\u1eb7c \u0111\u1ecbnh l\u00e0 <code>_id</code>).</li> <li><code>let(...)</code> \u0111\u01b0a bi\u1ebfn v\u00e0o tr\u01b0\u1eddng <code>let</code> c\u1ee7a <code>$merge</code>; c\u00e1c bi\u1ebfn s\u1ebd \u0111\u01b0\u1ee3c map sang <code>'$field'</code> qua <code>context</code>.</li> <li><code>whenMatched</code> ch\u1ea5p nh\u1eadn: <code>replace</code>/<code>keepExisting</code>/<code>merge</code>/<code>fail</code> ho\u1eb7c <code>updateWith(pipeline)</code>. <code>whenNotMatched</code> ch\u1ea5p nh\u1eadn: <code>insert</code>/<code>discard</code>/<code>fail</code>.</li> <li><code>MergeOperation</code> k\u1ebf th\u1eeba c\u00e1c field upstream; n\u1ebfu truy\u1ec1n <code>let</code>, c\u00e1c bi\u1ebfn s\u1ebd \u0111\u01b0\u1ee3c expose nh\u01b0 tr\u01b0\u1eddng synthetic.</li> </ul>"},{"location":"documentation/operations/projectionOperation.html","title":"Projection Operation","text":"<p><code>ProjectionOperation</code> \u0111\u1ea1i di\u1ec7n cho stage <code>$project</code> c\u1ee7a MongoDB. N\u00f3 cho ph\u00e9p ch\u1ecdn/b\u1ecf c\u1ed9t, \u0111\u1eb7t b\u00ed danh, v\u00e0 x\u00e2y d\u1ef1ng c\u00e1c bi\u1ec3u th\u1ee9c s\u1ed1 h\u1ecdc, chu\u1ed7i, m\u1ea3ng, so s\u00e1nh, \u0111i\u1ec1u ki\u1ec7n, c\u0169ng nh\u01b0 l\u1ed3ng bi\u1ebfn <code>let</code> trong ph\u1ea7n chi\u1ebfu.</p> <pre><code>import { ProjectionOperation } from 'red-aggregation/operations/projectionOperation';\nimport { Fields } from 'red-aggregation/aggregate/field';\nimport { ArithmeticOperators } from 'red-aggregation/operator/arithmeticOperators/arithmeticOperators';\nimport { Cond, IfNull } from 'red-aggregation/operator/conditionalOperators';\nimport { ExpressionVariable } from 'red-aggregation/operator/variableOperators/let';\nimport { ArrayOperator } from 'red-aggregation/operator/arrayOperators/arrayOperator';\nimport { ToUpper } from 'red-aggregation/operator/stringOperators/toUppercase';\n</code></pre>"},{"location":"documentation/operations/projectionOperation.html#phuong-thuc","title":"Ph\u01b0\u01a1ng th\u1ee9c","text":"<ul> <li>new ProjectionOperation()</li> <li>andInclude(...fields)</li> <li>andExclude(...fields)</li> <li>and(name|expression|document).as(alias)</li> <li>and(name).plus/minus/multiply/divide/mod/eq/gt/gte/lt/lte/ne</li> <li>Array helpers: arrayElementAt/slice/concatArrays/isArray/asArray/andArrayOf</li> <li>\u0110i\u1ec1u ki\u1ec7n: applyCondition(Cond|IfNull)</li> <li>nested(fields)</li> <li>previousOperation()</li> <li>lets(...) v\u1edbi $let</li> </ul>"},{"location":"documentation/operations/projectionOperation.html#new-projectionoperation","title":"new ProjectionOperation","text":"<pre><code>new ProjectionOperation().toDocument(context);\n// =&gt; { $project: {} }\n</code></pre>"},{"location":"documentation/operations/projectionOperation.html#andincludefields","title":"andInclude(...fields)","text":"<pre><code>new ProjectionOperation()\n.andInclude('firstName')\n.andInclude('lastName')\n.toDocument(context);\n// =&gt; { $project: { firstName: 1, lastName: 1 } }\n</code></pre>"},{"location":"documentation/operations/projectionOperation.html#andexcludefields","title":"andExclude(...fields)","text":"<pre><code>new ProjectionOperation()\n.andExclude('password', 'secret')\n.toDocument(context);\n// =&gt; { $project: { password: 0, secret: 0 } }\n</code></pre>"},{"location":"documentation/operations/projectionOperation.html#andasalias","title":"and(...).as(alias)","text":"<p>Alias field ho\u1eb7c g\u00e1n bi\u1ec3u th\u1ee9c/literal cho tr\u01b0\u1eddng m\u1edbi.</p> <pre><code>// Alias tr\u01b0\u1eddng\nnew ProjectionOperation().and('fullName').as('displayName').toDocument(context);\n// =&gt; { $project: { displayName: '$fullName' } }\n\n// G\u00e1n bi\u1ec3u th\u1ee9c s\u1ed1 h\u1ecdc\nnew ProjectionOperation()\n.and(ArithmeticOperators.add('$foo').add(41))\n.as('bar')\n.toDocument(context);\n// =&gt; { $project: { bar: { $add: ['$foo', 41] } } }\n\n// G\u00e1n bi\u1ec3u th\u1ee9c chu\u1ed7i (AggregationExpression)\nnew ProjectionOperation()\n.and(ToUpper.valueOf('item'))\n.as('upperItem')\n.toDocument(context);\n// =&gt; { $project: { upperItem: { $toUpper: '$item' } } }\n\n// K\u1ebft h\u1ee3p include + bi\u1ec3u th\u1ee9c\nnew ProjectionOperation()\n.andInclude('firstName')\n.and('firstName').toUpper().as('firstNameUpper')\n.toDocument(context);\n// =&gt; { $project: { firstName: 1, firstNameUpper: { $toUpper: '$firstName' } } }\n</code></pre>"},{"location":"documentation/operations/projectionOperation.html#helpers-so-hocso-sanh-qua-andfieldasalias","title":"Helpers s\u1ed1 h\u1ecdc/so s\u00e1nh (qua and('field').\u2026\u200b).as('alias')","text":"<pre><code>new ProjectionOperation()\n.and('price').minus(5).as('discounted')   // { $subtract: ['$price', 5] }\n.and('price').multiply(2).as('double')    // { $multiply: ['$price', 2] }\n.and('price').divide(2).as('half')        // { $divide: ['$price', 2] }\n.and('price').mod(3).as('modulus')        // { $mod: ['$price', 3] }\n.and('price').plus(10).as('total')        // { $add: ['$price', 10] }\n.and('score').eq(10).as('eq')             // { $eq:  ['$score', 10] }\n.and('score').gt(10).as('gt')             // { $gt:  ['$score', 10] }\n.and('score').gte(10).as('gte')           // { $gte: ['$score', 10] }\n.and('score').lt(10).as('lt')             // { $lt:  ['$score', 10] }\n.and('score').lte(10).as('lte')           // { $lte: ['$score', 10] }\n.and('score').ne(10).as('ne')             // { $ne:  ['$score', 10] }\n.toDocument(context);\n</code></pre>"},{"location":"documentation/operations/projectionOperation.html#helpers-mang","title":"Helpers m\u1ea3ng","text":"<pre><code>new ProjectionOperation()\n.and('favorites').arrayElementAt(0).as('first')      // { $arrayElemAt: ['$favorites', 0] }\n.and('favorites').slice(3).as('firstThree')          // { $slice: ['$favorites', 3] }\n.and('favorites').slice(3, 1).as('offsetSlice')      // { $slice: ['$favorites', 1, 3] }\n.and('favorites').concatArrays('others').as('all')   // { $concatArrays: ['$favorites', '$others'] }\n.and('favorites').isArray().as('isArray')            // { $isArray: '$favorites' }\n.toDocument(context);\n\n// Bi\u1ebfn c\u00e1c projection hi\u1ec7n t\u1ea1i th\u00e0nh m\u1ed9t m\u1ea3ng\nnew ProjectionOperation()\n.andInclude('firstName').andInclude('lastName')\n.asArray('fullNameParts')\n.toDocument(context);\n// =&gt; { $project: { fullNameParts: ['$firstName', '$lastName'] } }\n\n// T\u1ea1o m\u1ea3ng t\u1eeb danh s\u00e1ch ph\u1ea7n t\u1eed (field/expression/literal)\nnew ProjectionOperation()\n.andArrayOf([Fields.field('city'), { $literal: 'VN' }, 42])\n.as('details')\n.toDocument(context);\n// =&gt; { $project: { details: ['$city', { $literal: 'VN' }, 42] } }\n</code></pre>"},{"location":"documentation/operations/projectionOperation.html#ieu-kien","title":"\u0110i\u1ec1u ki\u1ec7n","text":"<pre><code>const condExpr = Cond.newBuilder().when({ $gt: ['$score', 90] }).then('honors').otherwise('standard');\nconst ifNullExpr = IfNull.ifNull('nickname').orIfNull('alias').then('unknown');\n\nnew ProjectionOperation()\n.and('grade').applyCondition(condExpr)\n.and('displayName').applyCondition(ifNullExpr)\n.toDocument(context);\n// =&gt; {\n//   $project: {\n//     grade: { $cond: { if: { $gt: ['$score', 90] }, then: 'honors', else: 'standard' } },\n//     displayName: { $ifNull: ['$nickname', '$alias', 'unknown'] }\n//   }\n// }\n</code></pre>"},{"location":"documentation/operations/projectionOperation.html#nestedfields","title":"nested(fields)","text":"<pre><code>new ProjectionOperation()\n.and('profile').nested(Fields.fields('name', 'email'))\n.toDocument(context);\n// =&gt; { $project: { profile: { name: '$name', email: '$email' } } }\n</code></pre>"},{"location":"documentation/operations/projectionOperation.html#previousoperation","title":"previousOperation()","text":"<p>Tham chi\u1ebfu k\u1ebft qu\u1ea3 c\u1ee7a stage tr\u01b0\u1edbc \u0111\u00f3 qua <code>$_id</code> v\u00e0 \u1ea9n <code>_id</code> hi\u1ec7n t\u1ea1i.</p> <pre><code>new ProjectionOperation().and('prop').previousOperation().toDocument(context);\n// =&gt; { $project: { prop: '$_id', _id: 0 } }\n</code></pre>"},{"location":"documentation/operations/projectionOperation.html#lets-nhung-let-trong-projection","title":"lets(...) (nh\u00fang <code>$let</code> trong projection)","text":"<pre><code>// D\u1ea1ng (valueExpression, variableName, inExpression)\nconst total = ArithmeticOperators.add('price').add('tax');\nconst inExpr = ArithmeticOperators.multiply('$$total').multiplyBy(2);\nnew ProjectionOperation()\n.and('finalPrice').lets(total, 'total', inExpr).as('finalPrice')\n.toDocument(context);\n// =&gt; {\n//   $project: {\n//     finalPrice: {\n//       $let: { vars: { total: { $add: ['$price', '$tax'] } }, in: { $multiply: ['$$total', 2] } }\n//     }\n//   }\n// }\n\n// D\u1ea1ng (variables[], inExpression)\nconst vars = [\nExpressionVariable\n.newVariable('discount')\n.forExpression(ArithmeticOperators.multiply('price').multiplyBy(0.1))\n];\nconst apply = ArithmeticOperators.subtract('price').subtract('discount');\nnew ProjectionOperation()\n.and('finalPrice').lets(vars, apply).as('finalPrice')\n.toDocument(context);\n// =&gt; {\n//   $project: {\n//     finalPrice: {\n//       $let: { vars: { discount: { $multiply: ['$price', 0.1] } }, in: { $subtract: ['$price', '$$discount'] } }\n//     }\n//   }\n// }\n</code></pre>"},{"location":"documentation/operations/projectionOperation.html#luu-y-su-dung","title":"L\u01b0u \u00fd s\u1eed d\u1ee5ng","text":"<ul> <li>Kh\u00f4ng tr\u1ed9n include v\u00e0 exclude trong c\u00f9ng m\u1ed9t <code>$project</code> (\"Mixing inclusion and exclusion in projection is not allowed.\").</li> <li><code>and(name)</code> tr\u1ea3 v\u1ec1 builder; c\u1ea7n <code>.as(alias)</code> \u0111\u1ec3 ch\u1ed1t projection khi d\u00f9ng c\u00e1c helper.</li> <li>C\u00f3 th\u1ec3 kh\u1edfi t\u1ea1o t\u1eeb <code>Fields.fields(...)</code> \u0111\u1ec3 include/alias nhi\u1ec1u field m\u1ed9t l\u01b0\u1ee3t.</li> <li>M\u1ed9t s\u1ed1 helper nh\u1eadn <code>field</code>/<code>expression</code>/document/literal theo \u0111\u00fang overload (xem v\u00ed d\u1ee5).</li> </ul>"},{"location":"documentation/operations/replaceRootOperation.html","title":"ReplaceRoot Operation","text":"<p><code>ReplaceRootOperation</code> \u0111\u1ea1i di\u1ec7n cho stage <code>$replaceRoot</code> c\u1ee7a MongoDB. N\u00f3 thay th\u1ebf to\u00e0n b\u1ed9 document hi\u1ec7n t\u1ea1i b\u1eb1ng m\u1ed9t document m\u1edbi (newRoot), c\u00f3 th\u1ec3 l\u00e0: - Tham chi\u1ebfu t\u1edbi m\u1ed9t field trong document g\u1ed1c - M\u1ed9t <code>AggregationExpression</code> (v\u00ed d\u1ee5 t\u1ed5 h\u1ee3p <code>$add</code>, <code>$concat</code>, \u2026) - M\u1ed9t raw BSON document - Ho\u1eb7c m\u1ed9t document \u0111\u01b0\u1ee3c x\u00e2y d\u1ef1ng d\u1ea7n (composable) b\u1eb1ng builder</p> <p>Khuy\u1ebfn ngh\u1ecb d\u00f9ng builder <code>ReplaceRootOperation.builder()</code> \u0111\u1ec3 t\u1ea1o <code>newRoot</code> linh ho\u1ea1t.</p> <pre><code>import { ReplaceRootOperation } from 'red-aggregation/operations/replaceRootOperation';\nimport { ReplaceRootOperationBuilder } from 'red-aggregation/operations/replaceRootOperation/replaceRootOperationBuilder';\nimport { ArithmeticOperators } from 'red-aggregation/operator/arithmeticOperators/arithmeticOperators';\n</code></pre>"},{"location":"documentation/operations/replaceRootOperation.html#phuong-thuc","title":"Ph\u01b0\u01a1ng th\u1ee9c","text":"<ul> <li>ReplaceRootOperation.builder().withValueOf(field|expression|document)</li> <li>ReplaceRootOperation.builder().withDocument().and(...).as(...)</li> <li>new ReplaceRootOperation(field|expression|document)</li> </ul>"},{"location":"documentation/operations/replaceRootOperation.html#withvalueof-builder-thay-newroot-bang-mot-gia-tri-duy-nhat","title":"withValueOf (builder) \u2014 thay newRoot b\u1eb1ng m\u1ed9t gi\u00e1 tr\u1ecb duy nh\u1ea5t","text":"<pre><code>// newRoot l\u00e0 m\u1ed9t field reference\nReplaceRootOperation\n.builder()\n.withValueOf('profile')\n.toDocument(context);\n// =&gt; { $replaceRoot: { newRoot: '$profile' } }\n\n// newRoot l\u00e0 m\u1ed9t AggregationExpression\nconst expr = ArithmeticOperators.add('price').add('tax');\nReplaceRootOperation\n.builder()\n.withValueOf(expr)\n.toDocument(context);\n// =&gt; { $replaceRoot: { newRoot: { $add: ['$price', '$tax'] } } }\n\n// newRoot l\u00e0 raw BSON document\nReplaceRootOperation\n.builder()\n.withValueOf({ firstName: '$name', location: '$city' })\n.toDocument(context);\n// =&gt; { $replaceRoot: { newRoot: { firstName: '$name', location: '$city' } } }\n</code></pre>"},{"location":"documentation/operations/replaceRootOperation.html#withdocument-builder-xay-dung-newroot-kieu-composable","title":"withDocument (builder) \u2014 x\u00e2y d\u1ef1ng <code>newRoot</code> ki\u1ec3u composable","text":"<pre><code>// B\u1eaft \u0111\u1ea7u v\u1edbi document tr\u1ed1ng r\u1ed3i th\u00eam t\u1eebng c\u1eb7p kh\u00f3a/gi\u00e1 tr\u1ecb\nconst expr = ArithmeticOperators.add('$price').add('$tax');\nReplaceRootOperation\n.builder()\n.withDocument()\n.and(expr).as('total')    // total: { $add: ['$price', '$tax'] }\n.andValue('$name').as('name')\n.toDocument(context);\n// =&gt; {\n//   $replaceRoot: { newRoot: { total: { $add: ['$price', '$tax'] }, name: '$name' } }\n// }\n\n// B\u1eaft \u0111\u1ea7u t\u1eeb m\u1ed9t document c\u00f3 s\u1eb5n, r\u1ed3i m\u1edf r\u1ed9ng th\u00eam kh\u00f3a/gi\u00e1 tr\u1ecb\nReplaceRootOperation\n.builder()\n.withDocument()\n.andValue('$userProfile').as('profile')\n.andValuesOf({ profile: '$userProfile' })\n.andValue('$settings').as('settings')\n.toDocument(context);\n// =&gt; { $replaceRoot: { newRoot: { profile: '$userProfile', settings: '$settings' } } }\n</code></pre>"},{"location":"documentation/operations/replaceRootOperation.html#constructor-co-the-dung-truc-tiep-khi-can-on-gian","title":"Constructor (c\u00f3 th\u1ec3 d\u00f9ng tr\u1ef1c ti\u1ebfp khi c\u1ea7n \u0111\u01a1n gi\u1ea3n)","text":"<pre><code>// Field reference\nnew ReplaceRootOperation(Fields.field('item')).toDocument(context);\n// =&gt; { $replaceRoot: { newRoot: '$item' } }\n\n// AggregationExpression\nconst expr = ArithmeticOperators.add('price').add('tax');\nnew ReplaceRootOperation(expr).toDocument(context);\n// =&gt; { $replaceRoot: { newRoot: { $add: ['$price', '$tax'] } } }\n\n// Raw document\nnew ReplaceRootOperation({ firstName: '$name', location: '$city' }).toDocument(context);\n// =&gt; { $replaceRoot: { newRoot: { firstName: '$name', location: '$city' } } }\n</code></pre>"},{"location":"documentation/operations/replaceRootOperation.html#luu-y-su-dung","title":"L\u01b0u \u00fd s\u1eed d\u1ee5ng","text":"<ul> <li><code>newRoot</code> ph\u1ea3i l\u00e0 m\u1ed9t document h\u1ee3p l\u1ec7; khi d\u00f9ng field reference s\u1ebd \u0111\u01b0\u1ee3c \u00e1nh x\u1ea1 th\u00e0nh <code>'$field'</code> qua <code>Fields.field</code>/<code>context</code>.</li> <li>Builder <code>withDocument()</code> tr\u1ea3 v\u1ec1 <code>ReplaceRootDocumentOperation</code> cho ph\u00e9p <code>and()/andValue()/andValuesOf()</code> v\u00e0 cu\u1ed1i c\u00f9ng <code>.as(name)</code> \u0111\u1ec3 g\u1eafn key v\u00e0o document m\u1edbi.</li> <li><code>ReplaceRootOperation</code> kh\u00f4ng expose th\u00eam field m\u1edbi (<code>getFields()</code> r\u1ed7ng), v\u00ec root \u0111\u01b0\u1ee3c thay th\u1ebf to\u00e0n b\u1ed9.</li> <li>\u01afu ti\u00ean d\u00f9ng builder <code>ReplaceRootOperation.builder()</code> \u0111\u1ec3 tr\u00e1nh t\u1ef1 thao t\u00e1c BSON v\u00e0 d\u1ec5 m\u1edf r\u1ed9ng <code>newRoot</code> theo t\u1eebng ph\u1ea7n.</li> </ul>"},{"location":"documentation/operations/replaceWithOperation.html","title":"ReplaceWith Operation","text":"<p><code>ReplaceWithOperation</code> \u0111\u1ea1i di\u1ec7n cho stage <code>$replaceWith</code> c\u1ee7a MongoDB. N\u00f3 thay th\u1ebf to\u00e0n b\u1ed9 document hi\u1ec7n t\u1ea1i b\u1eb1ng m\u1ed9t gi\u00e1 tr\u1ecb m\u1edbi (c\u00f3 th\u1ec3 l\u00e0 literal, tham chi\u1ebfu field, <code>AggregationExpression</code>, ho\u1eb7c c\u1ea5u tr\u00fac m\u1ea3ng/l\u1ed3ng nhau). API cung c\u1ea5p c\u00e1c ph\u01b0\u01a1ng th\u1ee9c t\u0129nh \u0111\u1ec3 t\u1ea1o nhanh <code>newRoot</code>.</p> <pre><code>import { ReplaceWithOperation } from 'red-aggregation/operations/replaceWithOperation';\nimport { Fields } from 'red-aggregation/aggregate/field';\nimport { ArithmeticOperators } from 'red-aggregation/operator/arithmeticOperators/arithmeticOperators';\n</code></pre>"},{"location":"documentation/operations/replaceWithOperation.html#phuong-thuc","title":"Ph\u01b0\u01a1ng th\u1ee9c","text":"<ul> <li>ReplaceWithOperation.replaceWithValue(value)</li> <li>ReplaceWithOperation.replaceWithValueOf(field|Field|AggregationExpression|any)</li> </ul>"},{"location":"documentation/operations/replaceWithOperation.html#replacewithvaluevalue","title":"replaceWithValue(value)","text":"<p>Thay to\u00e0n b\u1ed9 document b\u1eb1ng m\u1ed9t literal/raw value.</p> <pre><code>ReplaceWithOperation.replaceWithValue({ status: 'archived' }).\ntoDocument(context);\n// =&gt; { $replaceWith: { status: 'archived' } }\n</code></pre>"},{"location":"documentation/operations/replaceWithOperation.html#replacewithvalueofinput","title":"replaceWithValueOf(input)","text":"<p><code>input</code> c\u00f3 th\u1ec3 l\u00e0: - T\u00ean field (string) \u2192 \u0111\u01b0\u1ee3c map th\u00e0nh <code>'$field'</code> - <code>Field</code> instance - <code>AggregationExpression</code> - B\u1ea5t k\u1ef3 c\u1ea5u tr\u00fac d\u1eef li\u1ec7u (bao g\u1ed3m m\u1ea3ng l\u1ed3ng nhau), s\u1ebd \u0111\u01b0\u1ee3c resolve \u0111\u1ec7 quy</p> <p>V\u00ed d\u1ee5:</p> <pre><code>// Thay b\u1eb1ng field reference (string)\nReplaceWithOperation.replaceWithValueOf('profile').toDocument(context);\n// =&gt; { $replaceWith: '$profile' }\n\n// Thay b\u1eb1ng Field instance\nReplaceWithOperation.replaceWithValueOf(Fields.field('profile')).\ntoDocument(context);\n// =&gt; { $replaceWith: '$profile' }\n\n// Thay b\u1eb1ng AggregationExpression\nconst expr = ArithmeticOperators.add('$price').add('$tax');\nReplaceWithOperation.replaceWithValueOf(expr).toDocument(context);\n// =&gt; { $replaceWith: { $add: ['$price', '$tax'] } }\n\n// Thay b\u1eb1ng m\u1ea3ng (h\u1ed7 tr\u1ee3 l\u1ed3ng nhau)\nReplaceWithOperation.replaceWithValueOf(['$first', ['$second', '$third']]).\ntoDocument(context);\n// =&gt; { $replaceWith: ['$first', ['$second', '$third']] }\n</code></pre>"},{"location":"documentation/operations/replaceWithOperation.html#luu-y-su-dung","title":"L\u01b0u \u00fd s\u1eed d\u1ee5ng","text":"<ul> <li><code>replaceWithValueOf(null)</code> s\u1ebd n\u00e9m l\u1ed7i: \"Value must not be null\".</li> <li><code>replaceWithValueOf</code> t\u1ef1 \u0111\u1ed9ng chuy\u1ec3n:</li> <li><code>string</code> \u2192 <code>Fields.field(string)</code> \u2192 <code>'$field'</code> qua <code>context</code></li> <li><code>AggregationExpression</code> \u2192 <code>expression.toDocument(context)</code></li> <li><code>Array</code> \u2192 duy\u1ec7t \u0111\u1ec7 quy v\u00e0 map t\u1eebng ph\u1ea7n t\u1eed</li> <li><code>ReplaceWithOperation</code> k\u1ebf th\u1eeba logic t\u1eeb <code>ReplaceRootOperation</code> nh\u01b0ng xu\u1ea5t <code>$replaceWith</code> v\u00e0 tr\u1ea3 v\u1ec1 document m\u1edbi t\u1ea1i <code>newRoot</code> d\u01b0\u1edbi key <code>$replaceWith</code>.\\n</li> </ul>"},{"location":"documentation/operations/setOperation.html","title":"Set Operation","text":"<p><code>SetOperation</code> \u0111\u1ea1i di\u1ec7n cho stage <code>$set</code> c\u1ee7a MongoDB. D\u00f9ng \u0111\u1ec3 th\u00eam/c\u1eadp nh\u1eadt m\u1ed9t ho\u1eb7c nhi\u1ec1u tr\u01b0\u1eddng trong document hi\u1ec7n t\u1ea1i b\u1eb1ng literal, tham chi\u1ebfu field, ho\u1eb7c <code>AggregationExpression</code>.</p> <pre><code>import { SetOperation } from 'red-aggregation/operations/setOperation';\nimport { Fields } from 'red-aggregation/aggregate/field';\nimport { ArithmeticOperators } from 'red-aggregation/operator/arithmeticOperators/arithmeticOperators';\n</code></pre>"},{"location":"documentation/operations/setOperation.html#phuong-thuc","title":"Ph\u01b0\u01a1ng th\u1ee9c","text":"<ul> <li>SetOperation.createSetOperation(field, value)</li> <li>set(field).toValue(value) / set(field).toValueOf(exprOrField)</li> <li>set(field, value)</li> <li>and().set(...)</li> </ul>"},{"location":"documentation/operations/setOperation.html#tao-nhanh-voi-createsetoperation","title":"T\u1ea1o nhanh v\u1edbi createSetOperation","text":"<pre><code>SetOperation.createSetOperation('name', 'John').toDocument(context);\n// =&gt; { $set: { name: 'John' } }\n\n// Chaining ti\u1ebfp t\u1ee5c b\u1ed5 sung tr\u01b0\u1eddng\nSetOperation.createSetOperation('age', 30)\n.set('status', 'active')\n.toDocument(context);\n// =&gt; { $set: { age: 30, status: 'active' } }\n</code></pre>"},{"location":"documentation/operations/setOperation.html#builder-setfieldtovalue-tovalueof","title":"Builder: set(field).toValue(...) / toValueOf(...)","text":"<pre><code>// G\u00e1n literal\nnew SetOperation(new Map())\n.set('score').toValue(10)\n.toDocument(context);\n// =&gt; { $set: { score: 10 } }\n\n// G\u00e1n theo field kh\u00e1c\nnew SetOperation(new Map())\n.set('total').toValueOf('amount')\n.toDocument(context);\n// =&gt; { $set: { total: '$amount' } }\n\n// G\u00e1n theo AggregationExpression\nconst expr =  ArithmeticOperators.add('$price').add('$tax');\nnew SetOperation(new Map())\n.set('total').toValueOf(expr)\n.toDocument(context);\n// =&gt; { $set: { total: { $add: ['$price', '$tax'] } } }\n</code></pre>"},{"location":"documentation/operations/setOperation.html#gan-truc-tiep-setfield-value","title":"G\u00e1n tr\u1ef1c ti\u1ebfp: set(field, value)","text":"<pre><code>SetOperation.createSetOperation('name', 'Alice')\n.set('age', 28)\n.set('city', 'Hanoi')\n.toDocument(context);\n// =&gt; { $set: { name: 'Alice', age: 28, city: 'Hanoi' } }\n</code></pre>"},{"location":"documentation/operations/setOperation.html#gan-nhieu-truong-voi-and","title":"G\u00e1n nhi\u1ec1u tr\u01b0\u1eddng v\u1edbi and()","text":"<pre><code>new SetOperation(new Map())\n.set('firstName').toValue('John')\n.and()\n.set('lastName').toValue('Doe')\n.toDocument(context);\n// =&gt; { $set: { firstName: 'John', lastName: 'Doe' } }\n</code></pre>"},{"location":"documentation/operations/setOperation.html#luu-y-su-dung","title":"L\u01b0u \u00fd s\u1eed d\u1ee5ng","text":"<ul> <li><code>set(field).toValueOf('otherField')</code> s\u1ebd t\u1ef1 map string th\u00e0nh <code>'$otherField'</code> qua <code>Fields.field</code>/<code>context</code>.</li> <li><code>toValueOf</code> ch\u1ea5p nh\u1eadn <code>Field</code> ho\u1eb7c <code>AggregationExpression</code> v\u00e0 s\u1ebd g\u1ecdi <code>toDocument(context)</code> khi c\u1ea7n.</li> <li><code>and()</code> d\u00f9ng \u0111\u1ec3 ti\u1ebfp t\u1ee5c th\u00eam c\u00e1c tr\u01b0\u1eddng m\u1edbi v\u00e0o c\u00f9ng m\u1ed9t <code>$set</code> m\u00e0 kh\u00f4ng l\u00e0m m\u1ea5t c\u00e1c tr\u01b0\u1eddng \u0111\u00e3 c\u00f3.</li> <li><code>SetOperation.builder()</code> tr\u1ea3 v\u1ec1 <code>FieldAppender</code> gi\u00fap g\u1ecdi <code>.set(...).toValue()/toValueOf()</code> theo chu\u1ed7i.</li> </ul>"},{"location":"documentation/operations/skipOperation.html","title":"Skip Operation","text":"<p><code>SkipOperation</code> \u0111\u1ea1i di\u1ec7n cho stage <code>$skip</code> c\u1ee7a MongoDB. D\u00f9ng \u0111\u1ec3 b\u1ecf qua (kh\u00f4ng l\u1ea5y) m\u1ed9t s\u1ed1 l\u01b0\u1ee3ng b\u1ea3n ghi \u0111\u1ea7u ti\u00ean trong pipeline.</p> <pre><code>import { Skip } from 'red-aggregation/operations'; // alias/export c\u1ee7a SkipOperation (ho\u1eb7c import { SkipOperation } ...)\n</code></pre>"},{"location":"documentation/operations/skipOperation.html#phuong-thuc","title":"Ph\u01b0\u01a1ng th\u1ee9c","text":"<ul> <li>new Skip(count)</li> </ul>"},{"location":"documentation/operations/skipOperation.html#new-skipcount","title":"new Skip(count)","text":"<p>Kh\u1edfi t\u1ea1o stage <code>$skip</code> v\u1edbi s\u1ed1 l\u01b0\u1ee3ng b\u1ea3n ghi c\u1ea7n b\u1ecf qua. Gi\u00e1 tr\u1ecb ph\u1ea3i l\u00e0 s\u1ed1 d\u01b0\u01a1ng (&gt; 0).</p> <pre><code>new Skip(5).toDocument(context);      // ho\u1eb7c: new SkipOperation(5).toDocument(context)\n// =&gt; { $skip: 5 }\n\nnew Skip(1).toDocument(context);\n// =&gt; { $skip: 1 }\n</code></pre>"},{"location":"documentation/operations/skipOperation.html#luu-y-su-dung","title":"L\u01b0u \u00fd s\u1eed d\u1ee5ng","text":"<ul> <li><code>count</code> ph\u1ea3i l\u1edbn h\u01a1n 0; n\u1ebfu <code>count &lt;= 0</code> s\u1ebd n\u00e9m l\u1ed7i: \"Skip count must not be negative\".</li> <li><code>$skip</code> th\u01b0\u1eddng \u0111\u01b0\u1ee3c d\u00f9ng k\u1ebft h\u1ee3p v\u1edbi <code>$limit</code> \u0111\u1ec3 ph\u00e2n trang.</li> </ul>"},{"location":"documentation/operations/sortByCountOperation.html","title":"SortByCount Operation","text":"<p><code>SortByCountOperation</code> \u0111\u1ea1i di\u1ec7n cho stage <code>$sortByCount</code> c\u1ee7a MongoDB. Stage n\u00e0y nh\u00f3m c\u00e1c document theo m\u1ed9t bi\u1ec3u th\u1ee9c/field v\u00e0 tr\u1ea3 v\u1ec1 s\u1ed1 l\u01b0\u1ee3ng m\u1ed7i nh\u00f3m, \u0111\u1ed3ng th\u1eddi t\u1ef1 \u0111\u1ed9ng s\u1eafp x\u1ebfp gi\u1ea3m d\u1ea7n theo <code>count</code>.</p> <pre><code>import { SortByCountOperation } from 'red-aggregation/operations/sortByCountOperation';\nimport { Fields } from 'red-aggregation/aggregate/field';\n</code></pre>"},{"location":"documentation/operations/sortByCountOperation.html#phuong-thuc","title":"Ph\u01b0\u01a1ng th\u1ee9c","text":"<ul> <li>new SortByCountOperation(fieldRef: Field)</li> <li>new SortByCountOperation(expression: AggregationExpression)</li> <li>new SortByCountOperation(document: BSON)</li> </ul>"},{"location":"documentation/operations/sortByCountOperation.html#group-theo-field","title":"Group theo field","text":"<pre><code>new SortByCountOperation(Fields.field('category')).toDocument(context);\n// =&gt; { $sortByCount: '$category' }\n</code></pre>"},{"location":"documentation/operations/sortByCountOperation.html#group-theo-aggregationexpression","title":"Group theo AggregationExpression","text":"<pre><code>const expr = { $concat: ['$brand', '-', '$category'] };\nnew SortByCountOperation(expr).toDocument(context);\n// =&gt; { $sortByCount: { $concat: ['$brand', '-', '$category'] } }\n</code></pre>"},{"location":"documentation/operations/sortByCountOperation.html#group-theo-raw-bson","title":"Group theo raw BSON","text":"<pre><code>new SortByCountOperation({ $substr: ['$name', 0, 3] }).toDocument(context);\n// =&gt; { $sortByCount: { $substr: ['$name', 0, 3] } }\n</code></pre>"},{"location":"documentation/operations/sortByCountOperation.html#luu-y-su-dung","title":"L\u01b0u \u00fd s\u1eed d\u1ee5ng","text":"<ul> <li>Tham s\u1ed1 truy\u1ec1n cho constructor ph\u1ea3i h\u1ee3p l\u1ec7 (kh\u00f4ng <code>null</code>/<code>undefined</code>).</li> <li>Khi truy\u1ec1n <code>Field</code>, gi\u00e1 tr\u1ecb s\u1ebd \u0111\u01b0\u1ee3c \u00e1nh x\u1ea1 th\u00e0nh <code>'$field'</code> th\u00f4ng qua <code>context</code>.</li> <li>Khi truy\u1ec1n <code>AggregationExpression</code>, n\u1ed9i dung s\u1ebd \u0111\u01b0\u1ee3c l\u1ea5y qua <code>expression.toDocument(context)</code>.</li> <li><code>$sortByCount</code> t\u01b0\u01a1ng \u0111\u01b0\u01a1ng v\u1edbi <code>{$group: { _id: &lt;expr&gt;, count: {$sum: 1} } }</code> r\u1ed3i <code>{$sort: { count: -1 } }</code>, nh\u01b0ng g\u1ecdn h\u01a1n trong m\u1ed9t stage.</li> </ul>"},{"location":"documentation/operations/sortOperation.html","title":"Sort Operation","text":"<p><code>SortOperation</code> \u0111\u1ea1i di\u1ec7n cho stage <code>$sort</code> c\u1ee7a MongoDB. N\u00f3 s\u1eafp x\u1ebfp t\u1eadp k\u1ebft qu\u1ea3 theo m\u1ed9t ho\u1eb7c nhi\u1ec1u tr\u01b0\u1eddng v\u1edbi th\u1ee9 t\u1ef1 t\u0103ng (<code>ASC</code>) ho\u1eb7c gi\u1ea3m (<code>DESC</code>). <code>SortOperation</code> nh\u1eadn v\u00e0o m\u1ed9t <code>Sort</code> m\u00f4 t\u1ea3 danh s\u00e1ch c\u00e1c <code>Order</code>.</p> <pre><code>import { SortOperation } from 'red-aggregation/operations/sortOperation';\nimport { Sort } from 'red-aggregation/domain/sort';\nimport { Direction, Order } from 'red-aggregation/domain/order';\n</code></pre>"},{"location":"documentation/operations/sortOperation.html#phuong-thuc","title":"Ph\u01b0\u01a1ng th\u1ee9c","text":"<ul> <li>new SortOperation(sort: Sort)</li> <li>Sort.by(property) / Sort.by(Direction, ...properties) / Sort.by(Order, ...)</li> <li>Sort.thenBy(prop) / thenByDescending(prop)</li> <li>Sort.unsorted() / Sort.fromOrder(...)</li> <li>SortOperation.and(sort) / and(Direction, ...fields)</li> </ul>"},{"location":"documentation/operations/sortOperation.html#new-sortoperationsort","title":"new SortOperation(sort)","text":"<pre><code>// S\u1eafp x\u1ebfp t\u0103ng theo name\nnew SortOperation(Sort.by('name')).toDocument(context);\n// =&gt; { $sort: { name: 1 } }\n\n// S\u1eafp x\u1ebfp gi\u1ea3m theo price\nnew SortOperation(Sort.by(Direction.DESC, 'price')).toDocument(context);\n// =&gt; { $sort: { price: -1 } }\n</code></pre>"},{"location":"documentation/operations/sortOperation.html#sortby","title":"Sort.by(...)","text":"<pre><code>// M\u1ed9t tr\u01b0\u1eddng, m\u1eb7c \u0111\u1ecbnh ASC\nconst s1 = Sort.by('name');                     // ORDER: name ASC\n\n// Nhi\u1ec1u tr\u01b0\u1eddng v\u1edbi c\u00f9ng direction\nconst s2 = Sort.by(Direction.ASC, 'category', 'name');\n// yields $sort: { category: 1, name: 1 }\n\n// K\u1ebft h\u1ee3p nhi\u1ec1u Order\nconst s3 = Sort.by(\nOrder.asc('category'),\nOrder.desc('price')\n);\n// yields $sort: { category: 1, price: -1 }\n</code></pre>"},{"location":"documentation/operations/sortOperation.html#ket-hop-nhieu-tieu-chi-sort","title":"K\u1ebft h\u1ee3p nhi\u1ec1u ti\u00eau ch\u00ed sort","text":"<pre><code>// K\u1ebft h\u1ee3p nhi\u1ec1u Sort\nconst base = Sort.by('name');\nconst combined = base.and(Sort.by(Direction.DESC, 'price'));\nnew SortOperation(combined).toDocument(context);\n// =&gt; { $sort: { name: 1, price: -1 } }\n\n// Ho\u1eb7c d\u00f9ng SortOperation.and(...)\nnew SortOperation(Sort.by('name'))\n.and(Direction.DESC, 'price', 'amount')\n.toDocument(context);\n// =&gt; { $sort: { name: 1, price: -1, amount: -1 } }\n</code></pre>"},{"location":"documentation/operations/sortOperation.html#helpers-khac-tren-sort","title":"Helpers kh\u00e1c tr\u00ean Sort","text":"<pre><code>// Kh\u00f4ng s\u1eafp x\u1ebfp\nnew SortOperation(Sort.unsorted()).toDocument(context);\n// =&gt; { $sort: {} }\n\n// thenBy / thenByDescending\nconst s = Sort.by('status').thenByDescending('createdAt').thenBy('name');\nnew SortOperation(s).toDocument(context);\n// =&gt; { $sort: { status: 1, createdAt: -1, name: 1 } }\n\n// \u00c9p t\u1ea5t c\u1ea3 v\u1ec1 t\u0103ng/gi\u1ea3m\nSort.by(Direction.DESC, 'price').ascending(); // -&gt; t\u1ea5t c\u1ea3 ASC\nSort.by('price').descending();                 // -&gt; t\u1ea5t c\u1ea3 DESC\n\n// T\u1ea1o t\u1eeb c\u00e1c Order\nconst s4 = Sort.fromOrder(\nOrder.asc('name'),\nOrder.desc('age')\n);\nnew SortOperation(s4).toDocument(context);\n// =&gt; { $sort: { name: 1, age: -1 } }\n</code></pre>"},{"location":"documentation/operations/sortOperation.html#luu-y-su-dung","title":"L\u01b0u \u00fd s\u1eed d\u1ee5ng","text":"<ul> <li><code>SortOperation</code> ch\u1ec9 nh\u1eadn m\u1ed9t <code>Sort</code>; lu\u00f4n kh\u1edfi t\u1ea1o <code>Sort</code> b\u1eb1ng c\u00e1c helper <code>Sort.by(...)</code>, <code>Order.asc/desc(...)</code>.</li> <li><code>Direction.ASC</code> \u2194 1, <code>Direction.DESC</code> \u2194 -1 trong <code>$sort</code>.</li> <li>T\u00ean field \u0111\u01b0\u1ee3c map qua <code>context.getReference(property).getRaw()</code>; truy\u1ec1n \u0111\u00fang t\u00ean field theo schema.</li> </ul>"},{"location":"documentation/operations/unionWithOperation.html","title":"UnionWith Operation","text":"<p><code>UnionWithOperation</code> \u0111\u1ea1i di\u1ec7n cho stage <code>$unionWith</code> c\u1ee7a MongoDB (t\u1eeb 4.4). Stage n\u00e0y h\u1ee3p nh\u1ea5t d\u1eef li\u1ec7u t\u1eeb collection kh\u00e1c (v\u00e0 tu\u1ef3 ch\u1ecdn \u00e1p d\u1ee5ng pipeline) v\u00e0o lu\u1ed3ng hi\u1ec7n t\u1ea1i.</p> <pre><code>import { UnionWithOperation } from 'red-aggregation/operations/unionWithOperation';\nimport { AggregationPipeline } from 'red-aggregation/aggregationPipeline';\nimport { AggregateOperation } from 'red-aggregation/aggregateOperation';\n</code></pre>"},{"location":"documentation/operations/unionWithOperation.html#phuong-thuc","title":"Ph\u01b0\u01a1ng th\u1ee9c","text":"<ul> <li>UnionWithOperation.unionWith(collection)</li> <li>union.pipeline(AggregationPipeline|...AggregateOperation)</li> </ul>"},{"location":"documentation/operations/unionWithOperation.html#unionwithcollection","title":"unionWith(collection)","text":"<p>T\u1ea1o <code>$unionWith</code> t\u1ed1i gi\u1ea3n, ch\u1ec9 ch\u1ec9 \u0111\u1ecbnh collection \u0111\u00edch.</p> <pre><code>UnionWithOperation\n.unionWith('archivedOrders')\n.toDocument(context);\n// =&gt; { $unionWith: { coll: 'archivedOrders' } }\n</code></pre>"},{"location":"documentation/operations/unionWithOperation.html#unionwith-pipeline","title":"unionWith + pipeline","text":"<p>C\u00f3 th\u1ec3 b\u1ed5 sung pipeline \u0111\u1ec3 bi\u1ebfn \u0111\u1ed5i d\u1eef li\u1ec7u c\u1ee7a collection gh\u00e9p v\u00e0o.</p> <pre><code>// Truy\u1ec1n s\u1eb5n m\u1ed9t AggregationPipeline\nconst pipeline = AggregationPipeline.of(new MatchOp({ $match: { status: 'ACTIVE' } }));\nnew UnionWithOperation('archivedOrders', pipeline).toDocument(context);\n// =&gt; {\n//   $unionWith: {\n//     coll: 'archivedOrders',\n//     pipeline: [[ { $match: { status: 'ACTIVE' } } ]]\n//   }\n// }\n\n// Ho\u1eb7c d\u00f9ng overload variadic \u0111\u1ec3 truy\u1ec1n tr\u1ef1c ti\u1ebfp c\u00e1c stage\nUnionWithOperation\n.unionWith('archivedOrders')\n.pipeline(\nnew MatchOp({ $match: { type: 'A' } }),\nnew ProjectOp({ $project: { type: 1 } })\n)\n.toDocument(context);\n// =&gt; {\n//   $unionWith: {\n//     coll: 'archivedOrders',\n//     pipeline: [ [{ $match: { type: 'A' }}], [{ $project: { type: 1 }}] ]\n//   }\n// }\n</code></pre>"},{"location":"documentation/operations/unionWithOperation.html#luu-y-su-dung","title":"L\u01b0u \u00fd s\u1eed d\u1ee5ng","text":"<ul> <li><code>collection</code> l\u00e0 b\u1eaft bu\u1ed9c v\u00e0 kh\u00f4ng \u0111\u01b0\u1ee3c <code>null</code>.</li> <li>N\u1ebfu kh\u00f4ng truy\u1ec1n pipeline ho\u1eb7c pipeline r\u1ed7ng, ch\u1ec9 c\u00f3 <code>{ coll: &lt;collection&gt; }</code> trong <code>$unionWith</code>.</li> <li>Khi truy\u1ec1n pipeline, c\u00e1c stage s\u1ebd \u0111\u01b0\u1ee3c render b\u1eb1ng <code>toDocument(context)</code> theo <code>AggregationPipeline</code>; m\u1ed7i stage \u0111\u01b0\u1ee3c b\u1ecdc trong m\u1ed9t m\u1ea3ng con.</li> <li>N\u1ebfu context hi\u1ec7n t\u1ea1i l\u00e0 <code>ExposedFieldsAggregationOperationContext</code>, <code>UnionWithOperation</code> s\u1ebd s\u1eed d\u1ee5ng root-context n\u1ed9i b\u1ed9 khi render pipeline \u0111\u1ec3 tr\u00e1nh t\u00e1c \u0111\u1ed9ng c\u1ee7a \u00e1nh x\u1ea1 field t\u1ea1m th\u1eddi.</li> </ul>"},{"location":"documentation/operations/unsetOperation.html","title":"Unset Operation","text":"<p><code>UnsetOperation</code> \u0111\u1ea1i di\u1ec7n cho stage <code>$unset</code> c\u1ee7a MongoDB. D\u00f9ng \u0111\u1ec3 xo\u00e1 m\u1ed9t ho\u1eb7c nhi\u1ec1u tr\u01b0\u1eddng kh\u1ecfi document hi\u1ec7n t\u1ea1i. C\u00f3 th\u1ec3 truy\u1ec1n t\u00ean tr\u01b0\u1eddng d\u1ea1ng string, <code>Field</code> (\u0111\u1ec3 map theo t\u00ean th\u1eadt trong DB) ho\u1eb7c <code>AggregationExpression</code> tr\u1ea3 v\u1ec1 t\u00ean tr\u01b0\u1eddng c\u1ea7n xo\u00e1.</p> <pre><code>import { UnsetOperation } from 'red-aggregation/operations/unsetOperation';\nimport { Fields } from 'red-aggregation/aggregate/field';\n</code></pre>"},{"location":"documentation/operations/unsetOperation.html#phuong-thuc","title":"Ph\u01b0\u01a1ng th\u1ee9c","text":"<ul> <li>UnsetOperation.unset(...fields)</li> <li>and(...fields)</li> <li>removedFieldNames()</li> </ul>"},{"location":"documentation/operations/unsetOperation.html#xoa-mot-hoac-nhieu-truong","title":"Xo\u00e1 m\u1ed9t ho\u1eb7c nhi\u1ec1u tr\u01b0\u1eddng","text":"<pre><code>// Xo\u00e1 1 tr\u01b0\u1eddng\nUnsetOperation.unset('deprecatedField').toDocument(context);\n// =&gt; { $unset: 'deprecatedField' }\n\n// Xo\u00e1 nhi\u1ec1u tr\u01b0\u1eddng (m\u1ea3ng t\u00ean)\nUnsetOperation.unset('fieldA', 'fieldB').toDocument(context);\n// =&gt; { $unset: ['fieldA', 'fieldB'] }\n</code></pre>"},{"location":"documentation/operations/unsetOperation.html#ho-tro-field-va-aggregationexpression","title":"H\u1ed7 tr\u1ee3 Field v\u00e0 AggregationExpression","text":"<pre><code>// Truy\u1ec1n Field \u0111\u1ec3 map v\u1ec1 t\u00ean th\u1eadt trong DB\nconst field = Fields.field('aliasField', 'actualField');\nnew UnsetOperation([field]).toDocument(context);\n// =&gt; { $unset: 'actualField' }\n\n// Truy\u1ec1n AggregationExpression tr\u1ea3 v\u1ec1 t\u00ean tr\u01b0\u1eddng c\u1ea7n xo\u00e1\nconst expr = { $concat: ['$first', '-', '$second'] }; // v\u00ed d\u1ee5 expression\nnew UnsetOperation([expr as any]).toDocument(context);\n// =&gt; { $unset: { $concat: ['$first', '-', '$second'] } }\n</code></pre>"},{"location":"documentation/operations/unsetOperation.html#chain-them-truong-voi-and","title":"Chain th\u00eam tr\u01b0\u1eddng v\u1edbi and(...)","text":"<pre><code>UnsetOperation.unset('first')\n.and('second')\n.toDocument(context);\n// =&gt; { $unset: ['first', 'second'] }\n</code></pre>"},{"location":"documentation/operations/unsetOperation.html#lay-danh-sach-ten-truong-a-cau-hinh-xoa","title":"L\u1ea5y danh s\u00e1ch t\u00ean tr\u01b0\u1eddng \u0111\u00e3 c\u1ea5u h\u00ecnh xo\u00e1","text":"<pre><code>const op = UnsetOperation.unset('first').and(Fields.field('alias', 'real'));\nop.removedFieldNames();\n// =&gt; ['first', 'real']\n</code></pre>"},{"location":"documentation/operations/unsetOperation.html#luu-y-su-dung","title":"L\u01b0u \u00fd s\u1eed d\u1ee5ng","text":"<ul> <li>M\u1ea3ng <code>fields</code> kh\u00f4ng \u0111\u01b0\u1ee3c <code>null</code> v\u00e0 kh\u00f4ng ch\u1ee9a ph\u1ea7n t\u1eed <code>null</code>.</li> <li>Khi ch\u1ec9 c\u00f3 1 ph\u1ea7n t\u1eed, <code>$unset</code> nh\u1eadn string ho\u1eb7c expression; khi nhi\u1ec1u ph\u1ea7n t\u1eed, <code>$unset</code> nh\u1eadn m\u1ea3ng.</li> <li>V\u1edbi <code>Field</code> ho\u1eb7c string, t\u00ean field s\u1ebd \u0111\u01b0\u1ee3c map sang <code>raw</code> (v\u00ed d\u1ee5 <code>'user.name'</code> \u2192 <code>'user.name'</code>) b\u1edfi <code>context</code>.</li> </ul>"},{"location":"documentation/operations/unwindOperation.html","title":"Unwind Operation","text":"<p><code>UnwindOperation</code> \u0111\u1ea1i di\u1ec7n cho stage <code>$unwind</code> c\u1ee7a MongoDB. Stage n\u00e0y \u201cbung\u201d (deconstruct) m\u1ed9t m\u1ea3ng th\u00e0nh nhi\u1ec1u document, m\u1ed7i ph\u1ea7n t\u1eed m\u1ea3ng t\u1ea1o ra m\u1ed9t document m\u1edbi. C\u00f3 tu\u1ef3 ch\u1ecdn \u0111\u1ec3 gi\u1eef l\u1ea1i b\u1ea3n ghi khi m\u1ea3ng r\u1ed7ng/null v\u00e0 \u0111\u1ec3 ghi ch\u1ec9 s\u1ed1 ph\u1ea7n t\u1eed \u0111\u00e3 bung ra v\u00e0o m\u1ed9t field.</p> <pre><code>import { UnwindOperation } from 'red-aggregation/operations/unwindOperation';\nimport { UnwindOperationBuilder } from 'red-aggregation/operations/unwindOperation/unwindOperationBuilder';\nimport { Fields } from 'red-aggregation/aggregate/field';\n</code></pre>"},{"location":"documentation/operations/unwindOperation.html#phuong-thuc","title":"Ph\u01b0\u01a1ng th\u1ee9c","text":"<ul> <li>new UnwindOperation(field)</li> <li>new UnwindOperation(field, preserveNullAndEmpty)</li> <li>new UnwindOperation(field, arrayIndexField, preserveNullAndEmpty)</li> <li>UnwindOperation.newUnwind().path().noArrayIndex().preserve/skip</li> </ul>"},{"location":"documentation/operations/unwindOperation.html#constructor-co-ban","title":"Constructor: c\u01a1 b\u1ea3n","text":"<pre><code>// Ch\u1ec9 \u0111\u1ecbnh path (field m\u1ea3ng) \u2014 case m\u1eb7c \u0111\u1ecbnh: kh\u00f4ng gi\u1eef ph\u1ea7n t\u1eed null/[]\nnew UnwindOperation(Fields.field('items')).toDocument(context);\n// =&gt; { $unwind: '$items' }\n</code></pre>"},{"location":"documentation/operations/unwindOperation.html#giu-lai-phan-tu-nullmang-rong","title":"Gi\u1eef l\u1ea1i ph\u1ea7n t\u1eed null/m\u1ea3ng r\u1ed7ng","text":"<pre><code>new UnwindOperation(Fields.field('items'), true).toDocument(context);\n// =&gt; { $unwind: { path: '$items', preserveNullAndEmptyArrays: true } }\n</code></pre>"},{"location":"documentation/operations/unwindOperation.html#ghi-chi-so-phan-tu-includearrayindex","title":"Ghi ch\u1ec9 s\u1ed1 ph\u1ea7n t\u1eed (includeArrayIndex)","text":"<pre><code>new UnwindOperation(Fields.field('items'), Fields.field('idx'), false)\n.toDocument(context);\n// =&gt; { $unwind: { path: '$items', preserveNullAndEmptyArrays: false, includeArrayIndex: 'idx' } }\n</code></pre>"},{"location":"documentation/operations/unwindOperation.html#builder-api","title":"Builder API","text":"<pre><code>// Kh\u00f4ng ghi ch\u1ec9 s\u1ed1, nh\u01b0ng gi\u1eef null/[]\nUnwindOperation.newUnwind()\n.path('items')\n.noArrayIndex()\n.preserveNullAndEmptyArrays()\n.toDocument(context);\n// =&gt; { $unwind: { path: '$items', preserveNullAndEmptyArrays: true } }\n\n// Ghi ch\u1ec9 s\u1ed1 v\u00e0 b\u1ecf qua null/[]\nUnwindOperation.newUnwind()\n.path('items')\n.arrayIndex('idx')\n.skipNullAndEmptyArrays()\n.toDocument(context);\n// =&gt; { $unwind: { path: '$items', preserveNullAndEmptyArrays: false, includeArrayIndex: 'idx' } }\n</code></pre>"},{"location":"documentation/operations/unwindOperation.html#luu-y-su-dung","title":"L\u01b0u \u00fd s\u1eed d\u1ee5ng","text":"<ul> <li><code>path</code> l\u00e0 b\u1eaft bu\u1ed9c, kh\u00f4ng \u0111\u01b0\u1ee3c r\u1ed7ng.</li> <li><code>arrayIndex(field)</code> s\u1ebd t\u1ea1o m\u1ed9t field m\u1edbi ch\u1ee9a ch\u1ec9 s\u1ed1 ph\u1ea7n t\u1eed m\u1ea3ng \u1edf m\u1ed7i document sau khi bung.</li> <li><code>preserveNullAndEmptyArrays()</code> cho ph\u00e9p gi\u1eef l\u1ea1i document khi field l\u00e0 <code>null</code> ho\u1eb7c m\u1ea3ng r\u1ed7ng; <code>skipNullAndEmptyArrays()</code> th\u00ec lo\u1ea1i b\u1ecf.</li> <li>Khi kh\u00f4ng c\u1ea7n c\u1ea5u h\u00ecnh n\u00e2ng cao, c\u00f3 th\u1ec3 d\u00f9ng constructor \u0111\u01a1n gi\u1ea3n v\u1edbi <code>new UnwindOperation(Fields.field('arr'))</code>.</li> </ul>"},{"location":"documentation/operators/accumulatorOperators.html","title":"Accumulator Operators","text":"<p><code>AccumulatorOperators</code> \u0111\u1ea1i di\u1ec7n cho nh\u00f3m to\u00e1n t\u1eed t\u00edch l\u0169y c\u1ee7a MongoDB: <code>$sum</code>, <code>$avg</code>, <code>$min</code>, <code>$max</code> v\u00e0 bi\u1ebfn th\u1ec3 <code>$minN</code>/<code>$maxN</code>. T\u1eeb <code>field</code>, <code>AggregationExpression</code> ho\u1eb7c literal (v\u1edbi <code>$sum</code>), c\u00e1c builder gi\u00fap b\u1ea1n t\u1ea1o bi\u1ec3u th\u1ee9c m\u00e0 kh\u00f4ng ph\u1ea3i vi\u1ebft BSON th\u1ee7 c\u00f4ng.</p> <pre><code>import { AccumulatorOperators } from 'red-aggregation/operator/accumulatorOperators/accumulatorOperators';\n</code></pre>"},{"location":"documentation/operators/accumulatorOperators.html#phuong-thuc","title":"Ph\u01b0\u01a1ng th\u1ee9c","text":"<ul> <li>AccumulatorOperators.valueOf()</li> <li>Sum.sumOf()</li> <li>Avg.avgOf()</li> <li>Min.minOf()</li> <li>Max.maxOf()</li> </ul>"},{"location":"documentation/operators/accumulatorOperators.html#accumulatoroperatorsvalueof","title":"AccumulatorOperators.valueOf()","text":"<p>Kh\u1edfi t\u1ea1o factory t\u1eeb field ho\u1eb7c <code>AggregationExpression</code>, sau \u0111\u00f3 chain t\u1edbi to\u00e1n t\u1eed mong mu\u1ed1n.</p> <pre><code>AccumulatorOperators.valueOf('price').sum().and('$tax').toDocument(context);\n// =&gt; { $sum: ['$price', '$tax'] }\n\nAccumulatorOperators.valueOf({ $subtract: ['$x', '$y'] }).avg().and('$z').toDocument(context);\n// =&gt; { $avg: [{ $subtract: ['$x', '$y'] }, '$z'] }\n</code></pre>"},{"location":"documentation/operators/accumulatorOperators.html#sumsumof","title":"Sum.sumOf()","text":"<pre><code>Sum.sumOf('price').and('$tax').toDocument(context);\n// =&gt; { $sum: ['$price', '$tax'] }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>Sum.sumOf('subtotal')\n.and('$discount')\n.and({ $multiply: ['$fee', 2] })\n.and(5)\n.toDocument(context);\n// =&gt; { $sum: ['$subtotal', '$discount', { $multiply: ['$fee', 2] }, 5] }\n</code></pre>"},{"location":"documentation/operators/accumulatorOperators.html#avgavgof","title":"Avg.avgOf()","text":"<pre><code>Avg.avgOf('score').and('$bonus').toDocument(context);\n// =&gt; { $avg: ['$score', '$bonus'] }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>Avg.avgOf('total')\n.and({ $multiply: ['$price', '$quantity'] })\n.toDocument(context);\n// =&gt; { $avg: ['$total', { $multiply: ['$price', '$quantity'] }] }\n</code></pre>"},{"location":"documentation/operators/accumulatorOperators.html#minminof","title":"Min.minOf()","text":"<pre><code>Min.minOf('price').toDocument(context);\n// =&gt; { $min: '$price' }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>Min.minOf('price').and('discount').toDocument(context);\n// =&gt; { $min: ['$price', '$discount'] }\n</code></pre> <p>Gi\u1edbi h\u1ea1n N ph\u1ea7n t\u1eed nh\u1ecf nh\u1ea5t:</p> <pre><code>Min.minOf('score').limit(3).toDocument(context);\n// =&gt; { $minN: { input: '$score', n: 3 } }\n\nMin.minOf('score').and('bonus').limit(5).toDocument(context);\n// =&gt; { $minN: { input: ['$score', '$bonus'], n: 5 } }\n</code></pre>"},{"location":"documentation/operators/accumulatorOperators.html#maxmaxof","title":"Max.maxOf()","text":"<pre><code>Max.maxOf('price').toDocument(context);\n// =&gt; { $max: '$price' }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>Max.maxOf('price').and('discount').toDocument(context);\n// =&gt; { $max: ['$price', '$discount'] }\n</code></pre> <p>Gi\u1edbi h\u1ea1n N ph\u1ea7n t\u1eed l\u1edbn nh\u1ea5t:</p> <pre><code>Max.maxOf('score').limit(3).toDocument(context);\n// =&gt; { $maxN: { input: '$score', n: 3 } }\n\nMax.maxOf('score').and('bonus').limit(5).toDocument(context);\n// =&gt; { $maxN: { input: ['$score', '$bonus'], n: 5 } }\n</code></pre>"},{"location":"documentation/operators/accumulatorOperators.html#luu-y-su-dung","title":"L\u01b0u \u00fd s\u1eed d\u1ee5ng","text":"<ul> <li>Factory ch\u1ec9 nh\u1eadn field reference ho\u1eb7c <code>AggregationExpression</code>. Gi\u00e1 tr\u1ecb kh\u00f4ng h\u1ee3p l\u1ec7 s\u1ebd b\u1ecb t\u1eeb ch\u1ed1i.</li> <li><code>Sum.and(...)</code> cho ph\u00e9p literal s\u1ed1; <code>Avg</code>/<code>Min</code>/<code>Max</code> ch\u1ea5p nh\u1eadn field ho\u1eb7c expression.</li> <li>G\u1ecdi <code>limit(n)</code> tr\u00ean <code>Min</code>/<code>Max</code> s\u1ebd chuy\u1ec3n sang <code>$minN</code>/<code>$maxN</code>. N\u1ebfu ch\u1ec9 c\u1ea7n m\u1ed9t gi\u00e1 tr\u1ecb nh\u1ecf/l\u1edbn nh\u1ea5t, kh\u00f4ng g\u1ecdi <code>limit</code>.</li> </ul>"},{"location":"documentation/operators/arithmeticOperators.html","title":"Arithmetic Operators","text":"<p><code>ArithmeticOperators</code> \u0111\u1ea1i di\u1ec7n cho nh\u00f3m to\u00e1n t\u1eed s\u1ed1 h\u1ecdc c\u1ee7a MongoDB. N\u00f3 cung c\u1ea5p c\u00e1c static method v\u00e0 builder \u0111\u1ec3 t\u1ea1o bi\u1ec3u th\u1ee9c t\u1eeb <code>AggregationExpression</code>, <code>field</code> ho\u1eb7c literal, tr\u1ea3 v\u1ec1 instance to\u00e1n t\u1eed t\u01b0\u01a1ng \u1ee9ng m\u00e0 kh\u00f4ng c\u1ea7n t\u1ef1 vi\u1ebft BSON th\u1ee7 c\u00f4ng.</p> <pre><code>import { ArithmeticOperators } from 'red-aggregation/operator/arithmeticOperators/arithmeticOperators';\n</code></pre>"},{"location":"documentation/operators/arithmeticOperators.html#phuong-thuc","title":"Ph\u01b0\u01a1ng th\u1ee9c","text":"<ul> <li>ArithmeticOperators.abs()</li> <li>ArithmeticOperators.add()</li> <li>ArithmeticOperators.divide()</li> <li>ArithmeticOperators.ceil()</li> <li>ArithmeticOperators.floor()</li> <li>ArithmeticOperators.exp()</li> <li>ArithmeticOperators.log() / log10() / ln()</li> <li>ArithmeticOperators.mod()</li> <li>ArithmeticOperators.multiply()</li> <li>ArithmeticOperators.pow()</li> <li>ArithmeticOperators.round()</li> <li>ArithmeticOperators.sqrt()</li> <li>ArithmeticOperators.subtract()</li> <li>ArithmeticOperators.trunc()</li> </ul>"},{"location":"documentation/operators/arithmeticOperators.html#arithmeticoperatorsabs","title":"ArithmeticOperators.abs()","text":"<pre><code>ArithmeticOperators.abs('price').toDocument(context);\n// =&gt; { $abs: '$price' }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>ArithmeticOperators.abs(-10).toDocument(context);\n// =&gt; { $abs: -10 }\n</code></pre>"},{"location":"documentation/operators/arithmeticOperators.html#arithmeticoperatorsadd","title":"ArithmeticOperators.add()","text":"<pre><code>ArithmeticOperators.add('price')\n.add(5)\n.add('discount')\n.toDocument(context);\n// =&gt; { $add: ['$price', 5, '$discount'] }\n</code></pre>"},{"location":"documentation/operators/arithmeticOperators.html#arithmeticoperatorsdivide","title":"ArithmeticOperators.divide()","text":"<pre><code>ArithmeticOperators.divide('total')\n.divideBy(10)\n.divideBy('count')\n.toDocument(context);\n// =&gt; { $divide: ['$total', 10, '$count'] }\n</code></pre>"},{"location":"documentation/operators/arithmeticOperators.html#arithmeticoperatorsceil-floor","title":"ArithmeticOperators.ceil() / floor()","text":"<pre><code>ArithmeticOperators.ceil({ $divide: ['$total', '$count'] }).toDocument(context);\n// =&gt; { $ceil: { $divide: ['$total', '$count'] } }\n\nArithmeticOperators.floor('price').toDocument(context);\n// =&gt; { $floor: '$price' }\n</code></pre>"},{"location":"documentation/operators/arithmeticOperators.html#arithmeticoperatorsexp","title":"ArithmeticOperators.exp()","text":"<pre><code>ArithmeticOperators.exp({ $add: [1, 2] }).toDocument(context);\n// =&gt; { $exp: { $add: [1, 2] } }\n</code></pre>"},{"location":"documentation/operators/arithmeticOperators.html#arithmeticoperatorslog-log10-ln","title":"ArithmeticOperators.log() / log10() / ln()","text":"<pre><code>ArithmeticOperators.log('value').log(2);\n// =&gt; { $log: ['$value', 2] }\n\nArithmeticOperators.log10(100);\n// =&gt; { $log10: 100 }\n\nArithmeticOperators.ln('$value');\n// =&gt; { $ln: '$value' }\n</code></pre>"},{"location":"documentation/operators/arithmeticOperators.html#arithmeticoperatorsmod","title":"ArithmeticOperators.mod()","text":"<pre><code>ArithmeticOperators.mod('amount').mod(3);\n// =&gt; { $mod: ['$amount', 3] }\n</code></pre>"},{"location":"documentation/operators/arithmeticOperators.html#arithmeticoperatorsmultiply","title":"ArithmeticOperators.multiply()","text":"<pre><code>ArithmeticOperators.multiply('price')\n.multiplyBy(2)\n.multiplyBy('$tax')\n.toDocument(context);\n// =&gt; { $multiply: ['$price', 2, '$tax'] }\n</code></pre>"},{"location":"documentation/operators/arithmeticOperators.html#arithmeticoperatorspow","title":"ArithmeticOperators.pow()","text":"<pre><code>ArithmeticOperators.pow('$value').pow(3);\n// =&gt; { $pow: ['$value', 3] }\n</code></pre>"},{"location":"documentation/operators/arithmeticOperators.html#arithmeticoperatorsround","title":"ArithmeticOperators.round()","text":"<pre><code>ArithmeticOperators.round('price').place(2).toDocument(context);\n// =&gt; { $round: ['$price', 2] }\n</code></pre>"},{"location":"documentation/operators/arithmeticOperators.html#arithmeticoperatorssqrt","title":"ArithmeticOperators.sqrt()","text":"<pre><code>ArithmeticOperators.sqrt('$variance');\n// =&gt; { $sqrt: '$variance' }\n</code></pre>"},{"location":"documentation/operators/arithmeticOperators.html#arithmeticoperatorssubtract","title":"ArithmeticOperators.subtract()","text":"<pre><code>ArithmeticOperators.subtract('total')\n.subtract('$discount')\n.subtract(5)\n.toDocument(context);\n// =&gt; { $subtract: ['$total', '$discount', 5] }\n</code></pre>"},{"location":"documentation/operators/arithmeticOperators.html#arithmeticoperatorstrunc","title":"ArithmeticOperators.trunc()","text":"<pre><code>ArithmeticOperators.trunc('$value');\n// =&gt; { $trunc: '$value' }\n</code></pre>"},{"location":"documentation/operators/arithmeticOperators.html#luu-y-su-dung","title":"L\u01b0u \u00fd s\u1eed d\u1ee5ng","text":"<ul> <li>C\u00e1c builder h\u1ed7 tr\u1ee3 chain nhi\u1ec1u to\u00e1n h\u1ea1ng theo th\u1ee9 t\u1ef1 g\u1ecdi (<code>.add()</code>, <code>.divideBy()</code>, <code>.multiplyBy()</code>, <code>.subtract()</code>\u2026).</li> <li><code>round().place(n)</code> ch\u1ec9 \u0111\u1ecbnh s\u1ed1 ch\u1eef s\u1ed1 th\u1eadp ph\u00e2n; n\u1ebfu kh\u00f4ng g\u1ecdi, MongoDB m\u1eb7c \u0111\u1ecbnh 0.</li> <li>Khi c\u1ea7n x\u00e2y d\u1ef1ng nhi\u1ec1u ph\u00e9p to\u00e1n d\u1ef1a tr\u00ean c\u00f9ng m\u1ed9t input, n\u00ean t\u00e1i s\u1eed d\u1ee5ng c\u00f9ng m\u1ed9t builder \u0111\u01b0\u1ee3c kh\u1edfi t\u1ea1o t\u1eeb <code>ArithmeticOperators.*(...)</code> thay v\u00ec l\u1eb7p l\u1ea1i chu\u1ea9n h\u00f3a \u0111\u1ea7u v\u00e0o.</li> </ul>"},{"location":"documentation/operators/arrayOperators.html","title":"Array Operators","text":"<p><code>ArrayOperator</code> \u0111\u1ea1i di\u1ec7n cho nh\u00f3m to\u00e1n t\u1eed thao t\u00e1c m\u1ea3ng c\u1ee7a MongoDB. N\u00f3 cung c\u1ea5p c\u00e1c static method v\u00e0 builder \u0111\u1ec3 t\u1ea1o bi\u1ec3u th\u1ee9c t\u1eeb <code>AggregationExpression</code>, <code>field</code>, ho\u1eb7c literal array v\u00e0 tr\u1ea3 v\u1ec1 instance to\u00e1n t\u1eed, gi\u00fap b\u1ea1n kh\u00f4ng ph\u1ea3i t\u1ef1 vi\u1ebft BSON th\u1ee7 c\u00f4ng.</p> <pre><code>import { ArrayOperator } from 'red-aggregation/operator/arrayOperators/arrayOperator';\n</code></pre>"},{"location":"documentation/operators/arrayOperators.html#phuong-thuc","title":"Ph\u01b0\u01a1ng th\u1ee9c","text":"<ul> <li>ArrayOperator.arrayOf()</li> <li>first() / last()</li> <li>elementAt()</li> <li>indexOf().within()</li> <li>slice().offset().itemCount()</li> <li>size() / isArray() / reverse()</li> <li>filter().as().by()</li> <li>reduce(...).startingWith()</li> <li>concat()</li> <li>ArrayToObject</li> <li>In</li> </ul>"},{"location":"documentation/operators/arrayOperators.html#arrayoperatorarrayof","title":"ArrayOperator.arrayOf()","text":"<p>Chu\u1ea9n h\u00f3a field, <code>AggregationExpression</code> ho\u1eb7c literal array \u0111\u1ec3 kh\u1edfi t\u1ea1o m\u1ed9t factory.</p> <pre><code>const factoryFromField = ArrayOperator.arrayOf('items');               // '$items'\nconst factoryFromExpr  = ArrayOperator.arrayOf({ $split: ['$t', ','] });\nconst factoryFromArray = ArrayOperator.arrayOf([1, 2, 3]);\n</code></pre>"},{"location":"documentation/operators/arrayOperators.html#first-last","title":"first() / last()","text":"<pre><code>ArrayOperator.arrayOf('price').first().toDocument(context);\n// =&gt; { $first: '$price' }\n\nArrayOperator.arrayOf([1, 2, 3]).last().toDocument(context);\n// =&gt; { $last: [1, 2, 3] }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>ArrayOperator.arrayOf({ $map: { input: '$items', in: '$$this.price' } })\n.last()\n.toDocument(context);\n// =&gt; { $last: { $map: ... } }\n</code></pre>"},{"location":"documentation/operators/arrayOperators.html#elementat","title":"elementAt()","text":"<pre><code>ArrayOperator.arrayOf('values').elementAt(5)\n// =&gt; { $arrayElemAt: ['$values', 5] }\n\nArrayOperator.arrayOf('values').elementAt('indexField')\n// =&gt; { $arrayElemAt: ['$values', '$indexField'] }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>ArrayOperator.arrayOf('values').elementAt({ $add: ['$idx', 1] })\n// =&gt; { $arrayElemAt: ['$values', { $add: ['$idx', 1] }] }\n\nArrayOperator.arrayOf({ $split: ['$tags', ','] }).elementAt(1)\n// =&gt; { $arrayElemAt: [{ $split: ['$tags', ','] }, 1] }\n</code></pre>"},{"location":"documentation/operators/arrayOperators.html#indexofvaluewithin","title":"indexOf(value).within(...)","text":"<pre><code>ArrayOperator.arrayOf('tags').indexOf('sale')\n// =&gt; { $indexOfArray: ['$tags', 'sale'] }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>ArrayOperator.arrayOf({ $map: { input: '$items', as: 'i', in: '$$i.price' } }).indexOf(100)\n// =&gt; { $indexOfArray: [{ $map: ... }, 100] }\n\nArrayOperator.arrayOf(['a', 'b', 'c']).indexOf('b').within(1, 2)\n// =&gt; { $indexOfArray: [['a', 'b', 'c'], 'b', 1, 2] }\n</code></pre>"},{"location":"documentation/operators/arrayOperators.html#sliceoffsetitemcount","title":"slice().offset().itemCount()","text":"<pre><code>ArrayOperator.arrayOf('items').slice().itemCount(3)\n// =&gt; { $slice: ['$items', 3] }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>ArrayOperator.arrayOf([1, 2, 3, 4]).slice().offset(1).itemCount(2)\n// =&gt; { $slice: [[1, 2, 3, 4], 1, 2] }\n</code></pre> <p>Th\u00eam v\u00ed d\u1ee5:</p> <pre><code>ArrayOperator.arrayOf([10, 20, 30]).slice().offset({ $add: ['$skip', 1] }).itemCount(1)\n// =&gt; { $slice: [[10, 20, 30], { $add: ['$skip', 1] }, 1] }\n</code></pre>"},{"location":"documentation/operators/arrayOperators.html#size-isarray-reverse","title":"size() / isArray() / reverse()","text":"<pre><code>ArrayOperator.arrayOf('items').size()\n// =&gt; { $size: '$items' }\n\nArrayOperator.arrayOf('$payload').isArray()\n// =&gt; { $isArray: '$payload' }\n\nArrayOperator.arrayOf([1, 2, 3]).reverse()\n// =&gt; { $reverseArray: [1, 2, 3] }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>ArrayOperator.arrayOf({ $filter: { input: '$items', as: 'i', cond: { $gt: ['$$i', 0] } } })\n.size()\n// =&gt; { $size: { $filter: ... } }\n</code></pre>"},{"location":"documentation/operators/arrayOperators.html#filterasby","title":"filter().as().by(...)","text":"<pre><code>const filterDoc = ArrayOperator.arrayOf('prices')\n.filter()\n.as('p')\n.by({ $gt: ['$$p', 5] })\n.toDocument(context);\n// {\n//   $filter: { input: '$prices', as: 'p', cond: { $gt: ['$$p', 5] } }\n// }\n</code></pre>"},{"location":"documentation/operators/arrayOperators.html#reducestartingwithinitial","title":"reduce(...).startingWith(initial)","text":"<pre><code>const reduceDoc = ArrayOperator.arrayOf('scores')\n.reduce({ $add: ['$$value', '$$this'] })\n.startingWith(0)\n.toDocument(context);\n// {\n//   $reduce: { input: '$scores', initialValue: 0, in: { $add: ['$$value', '$$this'] } }\n// }\n</code></pre>"},{"location":"documentation/operators/arrayOperators.html#concat","title":"concat()","text":"<pre><code>ArrayOperator.arrayOf('arrA')\n.concat('arrB')\n.concat({ $range: [0, 5] })\n// =&gt; { $concatArrays: ['$arrA', '$arrB', { $range: [0, 5] }] }\n</code></pre>"},{"location":"documentation/operators/arrayOperators.html#arraytoobject","title":"ArrayToObject","text":"<pre><code>ArrayToObject.arrayValueOfToObject('pairs')\n// =&gt; { $arrayToObject: '$pairs' }\n\nArrayToObject.arrayToObject([{ k: 'name', v: 'Alice' }])\n// =&gt; { $arrayToObject: [[{ k: 'name', v: 'Alice' }]] }\n</code></pre>"},{"location":"documentation/operators/arrayOperators.html#in","title":"In","text":"<pre><code>In.arrayOf('categories').containsValue('Electronics')\n// =&gt; { $in: ['Electronics', '$categories'] }\n\nIn.arrayOf([1, 2, 3]).containsValue(0)\n// =&gt; { $in: [0, [1, 2, 3]] }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>In.arrayOf({ $size: '$tags' }).containsValue(5)\n// =&gt; { $in: [5, { $size: '$tags' }] }\n</code></pre>"},{"location":"documentation/operators/arrayOperators.html#luu-y-su-dung","title":"L\u01b0u \u00fd s\u1eed d\u1ee5ng","text":"<ul> <li><code>ArrayOperator.arrayOf(...)</code>, <code>ArrayElemAt.arrayOf(...)</code>, <code>ConcatArrays.arrayOf(...)</code>, <code>In.arrayOf(...)</code>\u2026 n\u00e9m l\u1ed7i khi truy\u1ec1n <code>null</code>.</li> <li><code>ArrayOperatorFactory.isArray()</code> ch\u1ec9 cho ph\u00e9p field reference ho\u1eb7c bi\u1ec3u th\u1ee9c; kh\u1edfi t\u1ea1o t\u1eeb literal array s\u1ebd n\u00e9m l\u1ed7i.</li> <li>Khi \u00e1p d\u1ee5ng nhi\u1ec1u to\u00e1n t\u1eed cho c\u00f9ng m\u1ed9t input, n\u00ean kh\u1edfi t\u1ea1o m\u1ed9t factory t\u1eeb <code>ArrayOperator.arrayOf(input)</code> \u0111\u1ec3 t\u00e1i s\u1eed d\u1ee5ng chu\u1ea9n h\u00f3a \u0111\u1ea7u v\u00e0o.</li> </ul>"},{"location":"documentation/operators/booleanOperators.html","title":"Boolean Operators","text":"<p>\u0110\u1ed1i t\u01b0\u1ee3ng <code>BooleanOperators</code> \u0111\u1ea1i di\u1ec7n cho nh\u00f3m to\u00e1n t\u1eed boolean trong MongoDB Aggregation gi\u00fap k\u1ebft h\u1ee3p/\u0111\u1ea3o \u0111i\u1ec1u ki\u1ec7n: <code>$and</code>, <code>$or</code>, <code>$not</code>. N\u00f3 cung c\u1ea5p c\u00e1c static method v\u00e0 builder \u0111\u1ec3 t\u1ea1o bi\u1ec3u th\u1ee9c t\u1eeb <code>AggregationExpression</code>, <code>field</code>, <code>literal</code> v\u00e0 tr\u1ea3 v\u1ec1 instance to\u00e1n t\u1eed, tr\u00e1nh ph\u1ea3i vi\u1ebft BSON th\u1ee7 c\u00f4ng.</p> <pre><code>import { BooleanOperators } from 'red-aggregation/operator/booleanOperators/booleanOperators';\n</code></pre>"},{"location":"documentation/operators/booleanOperators.html#phuong-thuc","title":"Ph\u01b0\u01a1ng th\u1ee9c","text":"<ul> <li>BooleanOperators.valueOf()</li> <li>BooleanOperators.and()</li> <li>BooleanOperators.or()</li> <li>BooleanOperators.not()</li> </ul>"},{"location":"documentation/operators/booleanOperators.html#booleanoperatorsvalueof","title":"BooleanOperators.valueOf()","text":"<p>Chu\u1ea9n h\u00f3a field ho\u1eb7c <code>AggregationExpression</code> \u0111\u1ec3 kh\u1edfi t\u1ea1o m\u1ed9t factory, sau \u0111\u00f3 chain c\u00e1c to\u00e1n t\u1eed boolean t\u01b0\u01a1ng \u1ee9ng.</p> <pre><code>const factoryFromField = BooleanOperators.valueOf('isActive'); // field reference\nconst factoryFromExpr  = BooleanOperators.valueOf(\n{ $gt: ['$score', 80] }                                      // AggregationExpression\n);\n</code></pre>"},{"location":"documentation/operators/booleanOperators.html#booleanoperatorsand","title":"BooleanOperators.and()","text":"<p>T\u1ea1o builder <code>$and</code> t\u1eeb field, literal ho\u1eb7c expression.</p> <pre><code>const andDoc = BooleanOperators.valueOf('isActive')\n.and('isVerified')                   // field reference\n.and(true)                           // literal\n.and({ $gt: ['$score', 50] })        // expression\n.toDocument(context);\n// =&gt; { $and: ['$isActive', '$isVerified', true, { $gt: ['$score', 50] }] }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>BooleanOperators.and(true, false).toDocument(context);\n// =&gt; { $and: [true, false] }\n</code></pre>"},{"location":"documentation/operators/booleanOperators.html#booleanoperatorsor","title":"BooleanOperators.or()","text":"<pre><code>const orDoc = BooleanOperators.valueOf('isTrial')\n.or('isSubscribed')\n.or(false)\n.or({ $eq: ['$region', 'APAC'] })\n.toDocument(context);\n// =&gt; { $or: ['$isTrial', '$isSubscribed', false, { $eq: ['$region', 'APAC'] }] }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>BooleanOperators.or(true).orValue(false).orField('isDeleted').toDocument(context);\n// =&gt; { $or: [true, false, '$isDeleted'] }\n</code></pre>"},{"location":"documentation/operators/booleanOperators.html#booleanoperatorsnot","title":"BooleanOperators.not()","text":"<pre><code>const notDoc = BooleanOperators.valueOf('isSuspended')\n.not('isDeleted')\n.not(true)\n.not({ $eq: ['$status', 'archived'] })\n.toDocument(context);\n// =&gt; { $not: ['$isSuspended', '$isDeleted', true, { $eq: ['$status', 'archived'] }] }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>BooleanOperators.not(true).notValue(false).notField('isArchived').toDocument(context);\n// =&gt; { $not: [true, false, '$isArchived'] }\n</code></pre>"},{"location":"documentation/operators/booleanOperators.html#luu-y-su-dung","title":"L\u01b0u \u00fd s\u1eed d\u1ee5ng","text":"<ul> <li><code>BooleanOperators.valueOf</code> nh\u1eadn field reference (c\u00f3/kh\u00f4ng <code>$</code>) v\u00e0 <code>AggregationExpression</code>; literal c\u00f3 th\u1ec3 truy\u1ec1n tr\u1ef1c ti\u1ebfp v\u00e0o builder <code>.and()/.or()/.not()</code> ho\u1eb7c qua ph\u01b0\u01a1ng th\u1ee9c <code>...Value</code>.</li> <li>C\u00e1c builder (<code>And</code>, <code>Or</code>, <code>Not</code>) duy tr\u00ec m\u1ed9t m\u1ea3ng to\u00e1n h\u1ea1ng; m\u1ed7i l\u1ea7n g\u1ecdi <code>.and()/ .or()/ .not()</code> ho\u1eb7c bi\u1ebfn th\u1ec3 <code>...Field/ ...Value/ ...Expression</code> s\u1ebd b\u1ed5 sung ph\u1ea7n t\u1eed theo th\u1ee9 t\u1ef1 chain.</li> <li>Khi c\u1ea7n k\u1ebft h\u1ee3p nhi\u1ec1u \u0111i\u1ec1u ki\u1ec7n xoay quanh c\u00f9ng m\u1ed9t ngu\u1ed3n d\u1eef li\u1ec7u, kh\u1edfi t\u1ea1o m\u1ed9t factory t\u1eeb <code>BooleanOperators.valueOf(...)</code> \u0111\u1ec3 t\u00e1i s\u1eed d\u1ee5ng chu\u1ea9n h\u00f3a \u0111\u1ea7u v\u00e0o.</li> </ul>"},{"location":"documentation/operators/compareOperators.html","title":"Compare Operators","text":"<p>\u0110\u1ed1i t\u01b0\u1ee3ng <code>ComparisonOperation</code> \u0111\u1ea1i di\u1ec7n cho nh\u00f3m to\u00e1n t\u1eed so s\u00e1nh c\u1ee7a MongoDB (<code>$eq</code>, <code>$ne</code>, <code>$gt</code>, <code>$gte</code>, <code>$lt</code>, <code>$lte</code>, <code>$cmp</code>). N\u00f3 cung c\u1ea5p c\u00e1c static method v\u00e0 builder gi\u00fap b\u1ea1n t\u1ea1o bi\u1ec3u th\u1ee9c so s\u00e1nh t\u1eeb <code>AggregationExpression</code>, <code>field</code>, <code>literal</code> v\u00e0 tr\u1ea3 v\u1ec1 instance to\u00e1n t\u1eed c\u00f3 th\u1ec3 s\u1eed d\u1ee5ng trong c\u00e1c stage nh\u01b0 <code>$match</code>, <code>$project</code>, <code>$addFields</code> m\u00e0 kh\u00f4ng c\u1ea7n t\u1ef1 vi\u1ebft BSON th\u1ee7 c\u00f4ng.</p> <pre><code>import { ComparisonOperation } from 'red-aggregation/operator/compareOperators/comparisonOperators';\n</code></pre>"},{"location":"documentation/operators/compareOperators.html#phuong-thuc","title":"Ph\u01b0\u01a1ng th\u1ee9c","text":"<ul> <li>ComparisonOperation.valueOf()</li> <li>ComparisonOperation.eq()</li> <li>ComparisonOperation.ne()</li> <li>ComparisonOperation.gt()</li> <li>ComparisonOperation.gte()</li> <li>ComparisonOperation.lt()</li> <li>ComparisonOperation.lte()</li> <li>factory.compareTo()</li> </ul>"},{"location":"documentation/operators/compareOperators.html#comparisonoperationvalueof","title":"ComparisonOperation.valueOf()","text":"<p>Chu\u1ea9n h\u00f3a field ho\u1eb7c <code>AggregationExpression</code> \u0111\u1ec3 kh\u1edfi t\u1ea1o m\u1ed9t factory, sau \u0111\u00f3 chain c\u00e1c ph\u00e9p so s\u00e1nh t\u01b0\u01a1ng \u1ee9ng.</p> <pre><code>const factoryFromField = ComparisonOperation.valueOf('price');              // field reference\nconst factoryFromExpr = ComparisonOperation.valueOf({ $add: ['$a', '$b'] });// AggregationExpression\n</code></pre>"},{"location":"documentation/operators/compareOperators.html#comparisonoperationeq","title":"ComparisonOperation.eq()","text":"<p>T\u1ea1o builder <code>$eq</code> t\u1eeb field, literal ho\u1eb7c expression.</p> <pre><code>// Field + literal\nconst eqDoc = ComparisonOperation.eq('price')\n.equalTo('discount')\n.equalToValue(100)\n.toDocument(context);\n// =&gt; { $eq: ['$price', '$discount', 100] }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>// Expression\nComparisonOperation.eq({ $abs: '$amount' })\n.equalTo({ $add: ['$fee', '$tax'] })\n.toDocument(context);\n// =&gt; { $eq: [{ $abs: '$amount' }, { $add: ['$fee', '$tax'] }] }\n</code></pre>"},{"location":"documentation/operators/compareOperators.html#comparisonoperationgt","title":"ComparisonOperation.gt()","text":"<p>T\u1ea1o builder <code>$gt</code> \u0111\u1ec3 so s\u00e1nh l\u1edbn h\u01a1n.</p> <pre><code>const gtDoc = ComparisonOperation.gt('price')\n.greaterThan('cost')\n.greaterThanValue(50)\n.toDocument(context);\n// =&gt; { $gt: ['$price', '$cost', 50] }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>ComparisonOperation.gt({ $sum: '$scores' })\n.greaterThan({ $avg: '$scores' })\n.toDocument(context);\n// =&gt; { $gt: [{ $sum: '$scores' }, { $avg: '$scores' }] }\n</code></pre>"},{"location":"documentation/operators/compareOperators.html#comparisonoperationgte","title":"ComparisonOperation.gte()","text":"<pre><code>ComparisonOperation.gte('price')\n.greaterThanEqualTo('floorPrice')\n.greaterThanEqualToValue(100)\n.toDocument(context);\n// =&gt; { $gte: ['$price', '$floorPrice', 100] }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>ComparisonOperation.gte({ $sum: ['$a', '$b'] })\n.greaterThanEqualTo({ $multiply: ['$baseline', 2] })\n.toDocument(context);\n// =&gt; { $gte: [{ $sum: ['$a', '$b'] }, { $multiply: ['$baseline', 2] }] }\n</code></pre>"},{"location":"documentation/operators/compareOperators.html#comparisonoperationlt","title":"ComparisonOperation.lt()","text":"<pre><code>ComparisonOperation.lt('discount')\n.lessThanTo('ceiling')\n.lessThanToValue(10)\n.toDocument(context);\n// =&gt; { $lt: ['$discount', '$ceiling', 10] }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>ComparisonOperation.lt({ $abs: '$variance' })\n.lessThanTo({ $add: ['$threshold', 5] })\n.toDocument(context);\n// =&gt; { $lt: [{ $abs: '$variance' }, { $add: ['$threshold', 5] }] }\n</code></pre>"},{"location":"documentation/operators/compareOperators.html#comparisonoperationlte","title":"ComparisonOperation.lte()","text":"<pre><code>ComparisonOperation.lte('discount')\n.lessThanEqualTo('limit')\n.lessThanEqualToValue(5)\n.toDocument(context);\n// =&gt; { $lte: ['$discount', '$limit', 5] }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>ComparisonOperation.lte({ $ceil: '$score' })\n.lessThanEqualTo({ $multiply: ['$cap', 2] })\n.toDocument(context);\n// =&gt; { $lte: [{ $ceil: '$score' }, { $multiply: ['$cap', 2] }] }\n</code></pre>"},{"location":"documentation/operators/compareOperators.html#comparisonoperationne","title":"ComparisonOperation.ne()","text":"<pre><code>ComparisonOperation.ne('status')\n.notEqualTo('previousStatus')\n.notEqualToValue('ARCHIVED')\n.toDocument(context);\n// =&gt; { $ne: ['$status', '$previousStatus', 'ARCHIVED'] }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>ComparisonOperation.ne({ $substr: ['$code', 0, 3] })\n.notEqualTo({ $literal: 'ERR' })\n.toDocument(context);\n// =&gt; { $ne: [{ $substr: ['$code', 0, 3] }, { $literal: 'ERR' }] }\n</code></pre>"},{"location":"documentation/operators/compareOperators.html#factorycompareto","title":"factory.compareTo()","text":"<p>Sinh <code>$cmp</code> \u0111\u1ec3 so s\u00e1nh hai to\u00e1n h\u1ea1ng.</p> <pre><code>const cmpField = ComparisonOperation.valueOf('price')\n.compareTo('discount')\n.compareToValue(50)\n.toDocument(context);\n// =&gt; { $cmp: ['$price', '$discount', 50] }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>const cmpExpr = ComparisonOperation.valueOf({ $sum: ['$qty', '$bonus'] })\n.compareTo({ $abs: '$discount' })\n.toDocument(context);\n// =&gt; { $cmp: [{ $sum: ['$qty', '$bonus'] }, { $abs: '$discount' }] }\n</code></pre>"},{"location":"documentation/operators/compareOperators.html#luu-y-su-dung","title":"L\u01b0u \u00fd s\u1eed d\u1ee5ng","text":"<ul> <li><code>ComparisonOperation.valueOf</code> nh\u1eadn field reference (c\u00f3/kh\u00f4ng <code>$</code>) v\u00e0 <code>AggregationExpression</code>; literal n\u00ean truy\u1ec1n qua c\u00e1c ph\u01b0\u01a1ng th\u1ee9c <code>...Value</code>.</li> <li>C\u00e1c builder (<code>Eq</code>, <code>Gt</code>, <code>Lt</code>, <code>Lte</code>, <code>Gte</code>, <code>Ne</code>, <code>Cmp</code>) duy tr\u00ec m\u1ed9t m\u1ea3ng to\u00e1n h\u1ea1ng; m\u1ed7i l\u1ea7n g\u1ecdi <code>.equalTo()</code>, <code>.greaterThan()</code>\u2026 s\u1ebd b\u1ed5 sung ph\u1ea7n t\u1eed theo \u0111\u00fang th\u1ee9 t\u1ef1 chain.</li> <li>Khi c\u1ea7n so s\u00e1nh nhi\u1ec1u bi\u1ebfn th\u1ec3 tr\u00ean c\u00f9ng m\u1ed9t ngu\u1ed3n d\u1eef li\u1ec7u, \u01b0u ti\u00ean kh\u1edfi t\u1ea1o m\u1ed9t factory t\u1eeb <code>ComparisonOperation.valueOf(...)</code> \u0111\u1ec3 t\u00e1i s\u1eed d\u1ee5ng chu\u1ea9n h\u00f3a \u0111\u1ea7u v\u00e0o.</li> </ul>"},{"location":"documentation/operators/conditionalOperators.html","title":"Conditional Operators","text":"<p>\u0110\u1ed1i t\u01b0\u1ee3ng <code>ConditionOperator</code> \u0111\u1ea1i di\u1ec7n cho nh\u00f3m to\u00e1n t\u1eed \u0111i\u1ec1u ki\u1ec7n, gi\u00fap b\u1ea1n r\u1ebd nh\u00e1nh d\u1eef li\u1ec7u trong MongoDB Aggregation. N\u00f3 c\u00f3 c\u00e1c static method gi\u00fap b\u1ea1n kh\u1edfi t\u1ea1o to\u00e1n t\u1eed \u0111i\u1ec1u ki\u1ec7n nh\u01b0: <code>$cond</code>, <code>$ifNull</code>, <code>$switch</code> thay v\u00ec vi\u1ebft BSON th\u1ee7 c\u00f4ng. C\u00e1c to\u00e1n t\u1eed n\u00e0y s\u1ebd nh\u1eadn v\u00e0o d\u1eef li\u1ec7u thu\u1ed9c <code>AggregationExpression</code>, <code>field</code>, <code>literal</code> v\u00e0 s\u1ebd tr\u1ea3 ra instance c\u1ee7a to\u00e1n t\u1eed. C\u00e1c instance n\u00e0y l\u00e0 m\u1ed9t ph\u1ea7n \u0111\u1ec3 c\u00f3 th\u1ec3 t\u1ea1o d\u1ef1ng \u0111\u01b0\u1ee3c stage trong MongoDB Aggregation.</p> <pre><code>import { ConditionOperator } from 'red-aggregation/operator/conditionalOperators/conditionOperators';\n...\n</code></pre>"},{"location":"documentation/operators/conditionalOperators.html#phuong-thuc","title":"Ph\u01b0\u01a1ng th\u1ee9c","text":"<ul> <li>ConditionOperator.when()</li> <li>ConditionOperator.switchCases()</li> <li>ConditionOperator.ifNull()</li> </ul>"},{"location":"documentation/operators/conditionalOperators.html#conditionoperatorwhen","title":"ConditionOperator.when()","text":"<p>Kh\u1edfi t\u1ea1o builder <code>$cond</code> t\u1eeb field, literal ho\u1eb7c expression. To\u00e1n t\u1eed <code>$cond</code> \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng \u0111\u1ec3 \u0111\u00e1nh gi\u00e1 m\u1ed9t bi\u1ec3u th\u1ee9c boolean \u0111\u1ec3 tr\u1ea3 v\u1ec1 m\u1ed9t trong hai bi\u1ec3u th\u1ee9c tr\u1ea3 v\u1ec1 \u0111\u00e3 ch\u1ec9 \u0111\u1ecbnh.</p> <pre><code>// Literal boolean\nconst conditionOperator = ConditionOperator.when('isActive')\n.then(true)\n.otherwise(false)\n.toDocument(context);\n// =&gt; { $cond: { if: '$isActive', then: true, else: false } }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>// Field reference\nconst condField = ConditionOperator.when('score')\n.thenValueOf('maxScore')                   // field reference\n.otherwise(Fields.field('minScore'))       // Field object\n.toDocument(context);\n// =&gt; { $cond: { if: '$score', then: '$maxScore', else: '$minScore' } }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>// Expression\nconst condExpr = ConditionOperator.when({ $gte: ['$age', 18] }) // AggregationExpression\n.thenValueOf({ $multiply: ['$salary', 1.1] })                 // expression as value\n.otherwise({ $multiply: ['$salary', 0.8] })\n.toDocument(context);\n// =&gt; { $cond: { \n//      if: { $gte: ['$age', 18] },\n//      then: { $multiply: ... },\n//      else: { $multiply: ... } \n//    }}\n</code></pre>"},{"location":"documentation/operators/conditionalOperators.html#conditionoperatorswitchcases","title":"ConditionOperator.switchCases()","text":"<p>T\u1ea1o <code>$switch</code> t\u1eeb danh s\u00e1ch case. To\u00e1n t\u1eed <code>$switch</code> \u0111\u01b0\u1ee3c s\u1eed \u0111\u1ee5ng \u0111\u1ec3 \u0111\u00e1nh gi\u00e1 m\u1ed9t lo\u1ea1t c\u00e1c bi\u1ec3u th\u1ee9c tr\u01b0\u1eddng h\u1ee3p. Khi t\u00ecm th\u1ea5y m\u1ed9t bi\u1ec3u th\u1ee9c \u0111\u01b0\u1ee3c \u0111\u00e1nh gi\u00e1 l\u00e0 \u0111\u00fang, <code>$switch</code> s\u1ebd th\u1ef1c thi m\u1ed9t bi\u1ec3u th\u1ee9c \u0111\u00e3 ch\u1ec9 \u0111\u1ecbnh v\u00e0 tho\u00e1t ra kh\u1ecfi lu\u1ed3ng \u0111i\u1ec1u khi\u1ec3n.</p> <p>C\u00e1c \u0111\u1ed1i t\u01b0\u1ee3ng trong <code>branches</code> ch\u1ec9 \u0111\u01b0\u1ee3c ch\u1ee9a m\u1ed9t tr\u01b0\u1eddng <code>case</code> v\u00e0 m\u1ed9t tr\u01b0\u1eddng <code>then</code>.</p> <pre><code>import { CaseOperator } from 'red-aggregation/switch';\nconst caseA = CaseOperator.thenBuilder(ComparisonOperation.eq('$type').equalToValue('A'))\n.then('Tier A');\nconst caseB = CaseOperator.thenBuilder({ $gte: ['$score', 80] }).then('Tier B');\n\nconst switch = ConditionOperator.switchCases(caseA, caseB)\n.defaultTo('Tier C')\n.toDocument(context);\n// =&gt; {\n//   $switch: {\n//     branches: [\n//       { case: { $eq: ['$type', 'A'] }, then: 'Tier A' },\n//       { case: { $gte: ['$score', 80] }, then: 'Tier B' }\n//     ],\n//     default: 'Tier C'\n//   }\n// }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>import { CaseOperator } from 'red-aggregation/switch';\nconst caseA = CaseOperator.thenBuilder(ComparisonOperation.eq('$type').equalToValue('A'))\n.then('Tier A');\nconst caseB = CaseOperator.thenBuilder({ $gte: ['$score', 80] }).then('Tier B');\n\nconst switch = ConditionOperator.switchCases([caseA, caseB])\n.defaultTo('Tier C')\n.toDocument(context);\n// =&gt; {\n//   $switch: {\n//     branches: [\n//       { case: { $eq: ['$type', 'A'] }, then: 'Tier A' },\n//       { case: { $gte: ['$score', 80] }, then: 'Tier B' }\n//     ],\n//     default: 'Tier C'\n//   }\n// }\n</code></pre>"},{"location":"documentation/operators/conditionalOperators.html#conditionoperatorifnull","title":"ConditionOperator.ifNull()","text":"<p>T\u1ea1o builder <code>$ifNull</code>. To\u00e1n t\u1eed <code>$ifNull</code> \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng \u0111\u1ec3 \u0111\u00e1nh gi\u00e1 c\u00e1c bi\u1ec3u th\u1ee9c \u0111\u1ea7u v\u00e0o cho c\u00e1c gi\u00e1 tr\u1ecb null v\u00e0 tr\u1ea3 v\u1ec1:</p> <ul> <li>\u0110\u00e3 t\u00ecm th\u1ea5y gi\u00e1 tr\u1ecb bi\u1ec3u th\u1ee9c \u0111\u1ea7u v\u00e0o kh\u00f4ng null \u0111\u1ea7u ti\u00ean.</li> <li>Gi\u00e1 tr\u1ecb bi\u1ec3u th\u1ee9c thay th\u1ebf n\u1ebfu t\u1ea5t c\u1ea3 bi\u1ec3u th\u1ee9c \u0111\u1ea7u v\u00e0o c\u00f3 gi\u00e1 tr\u1ecb r\u1ed7ng.</li> </ul> <p><code>$ifNull</code> coi c\u00e1c gi\u00e1 tr\u1ecb kh\u00f4ng x\u00e1c \u0111\u1ecbnh v\u00e0 c\u00e1c tr\u01b0\u1eddng b\u1ecb thi\u1ebfu l\u00e0 null.</p> <pre><code>const ifNull = ConditionOperator.ifNull('nickname')\n.then('N/A')\n.toDocument(context);\n// =&gt; { $ifNull: ['$nickname', 'N/A'] }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>const ifNullWithExpr = ConditionOperator.ifNUll({ $toString: '$age' })\n.thenValueOf({ $multiply: ['$weight', 10] })\n.toDocument(context);\n// =&gt; { $ifNull: [{ $toString: '$age' }, { $multiply: ['$weight', 10] }] }\n</code></pre> <p>Ho\u1eb7c:</p> <pre><code>const ifNullChained = ConditionOperator.ifNUll('primaryEmail') // first condition\n.orIfNull('secondaryEmail')                                  // additional condition\n.thenValueOf('backupEmail')\n.toDocument(context);\n// =&gt; { $ifNull: ['$primaryEmail', '$secondaryEmail', '$backupEmail'] }\n</code></pre>"},{"location":"documentation/operators/conditionalOperators.html#luu-y-su-dung","title":"L\u01b0u \u00fd s\u1eed d\u1ee5ng","text":""},{"location":"documentation/operators/objectOperators.html","title":"Object Operators","text":"<p><code>ObjectOperators</code> \u0111\u1ea1i di\u1ec7n cho nh\u00f3m to\u00e1n t\u1eed thao t\u00e1c object trong MongoDB: <code>$getField</code>, <code>$setField</code>, <code>$mergeObjects</code>, <code>$objectToArray</code>. N\u00f3 cung c\u1ea5p c\u00e1c static method v\u00e0 builder gi\u00fap b\u1ea1n t\u1ea1o bi\u1ec3u th\u1ee9c t\u1eeb <code>field</code>, <code>AggregationExpression</code> ho\u1eb7c system variables (v\u00ed d\u1ee5: <code>$$CURRENT</code>), tr\u00e1nh ph\u1ea3i vi\u1ebft BSON th\u1ee7 c\u00f4ng.</p> <pre><code>import { ObjectOperators } from 'red-aggregation/operator/objectOperators/objectOperators';\n</code></pre>"},{"location":"documentation/operators/objectOperators.html#phuong-thuc","title":"Ph\u01b0\u01a1ng th\u1ee9c","text":"<ul> <li>ObjectOperators.valueOf()</li> <li>ObjectOperators.setValueTo()</li> <li>ObjectOperators.mergeObject()</li> <li>ObjectOperators.mergeValueOf()</li> <li>factory.merge()</li> <li>factory.mergeWith()</li> <li>factory.mergeWithValuesOf()</li> <li>factory.toArray()</li> <li>factory.getField()</li> <li>factory.setField()/removeField()</li> </ul>"},{"location":"documentation/operators/objectOperators.html#objectoperatorsvalueof","title":"ObjectOperators.valueOf()","text":"<p>Kh\u1edfi t\u1ea1o factory t\u1eeb field reference ho\u1eb7c system variable (v\u00ed d\u1ee5 <code>$$CURRENT</code>), sau \u0111\u00f3 chain t\u1edbi to\u00e1n t\u1eed mong mu\u1ed1n.</p> <pre><code>// Field reference\nObjectOperators.valueOf('profile')\n.getField('name')\n.of('profile')\n.toDocument(context);\n// =&gt; { $getField: { field: 'name', input: '$profile' } }\n</code></pre> <p>Ho\u1eb7c (system variable):</p> <pre><code>ObjectOperators.valueOf('$$CURRENT')\n.setField('status')\n.toValue('active')\n.toDocument(context);\n// =&gt; { $setField: { field: 'status', input: '$$CURRENT', value: 'active' } }\n</code></pre>"},{"location":"documentation/operators/objectOperators.html#objectoperatorssetvalueto","title":"ObjectOperators.setValueTo()","text":"<p>Shortcut \u0111\u1ec3 set m\u1ed9t field v\u00e0o <code>$$CURRENT</code>.</p> <pre><code>ObjectOperators.setValueTo('flag', true).toDocument(context);\n// =&gt; { $setField: { field: 'flag', input: '$$CURRENT', value: true } }\n</code></pre>"},{"location":"documentation/operators/objectOperators.html#objectoperatorsmergeobject","title":"ObjectOperators.mergeObject()","text":"<p>T\u1ea1o <code>$mergeObjects</code> t\u1eeb literal/object/expression.</p> <pre><code>ObjectOperators.mergeObject({ a: 1 }).mergeWith({ b: 2 }).toDocument(context);\n// =&gt; { $mergeObjects: [{ a: 1 }, { b: 2 }] }\n</code></pre>"},{"location":"documentation/operators/objectOperators.html#objectoperatorsmergevalueof","title":"ObjectOperators.mergeValueOf()","text":"<p>Gh\u00e9p nhi\u1ec1u field ho\u1eb7c expression v\u00e0o <code>$mergeObjects</code>.</p> <pre><code>ObjectOperators.mergeValueOf('a', 'b').toDocument(context);\n// =&gt; { $mergeObjects: ['$a', '$b'] }\n\nObjectOperators.mergeValueOf({ $toObjectId: '$id' }).toDocument(context);\n// =&gt; { $mergeObjects: [{ $toObjectId: '$id' }] }\n</code></pre>"},{"location":"documentation/operators/objectOperators.html#factorymerge","title":"factory.merge()","text":"<pre><code>ObjectOperators.valueOf('base').merge().mergeWith({ extra: true }).toDocument(context);\n// =&gt; { $mergeObjects: ['$base', { extra: true }] }\n</code></pre>"},{"location":"documentation/operators/objectOperators.html#factorymergewith-mergewithvaluesof","title":"factory.mergeWith() / mergeWithValuesOf()","text":"<pre><code>ObjectOperators.valueOf('base')\n.mergeWith({ a: 1 })\n.mergeWith({ b: 2 })\n.toDocument(context);\n// =&gt; { $mergeObjects: ['$base', { a: 1 }, { b: 2 }] }\n\nObjectOperators.valueOf('base')\n.mergeWithValuesOf('a', 'b')\n.toDocument(context);\n// =&gt; { $mergeObjects: ['$base', '$a', '$b'] }\n</code></pre>"},{"location":"documentation/operators/objectOperators.html#factorytoarray","title":"factory.toArray()","text":"<p>Chuy\u1ec3n object th\u00e0nh m\u1ea3ng key/value (<code>$objectToArray</code>).</p> <pre><code>ObjectOperators.valueOf('doc').toArray().toDocument(context);\n// =&gt; { $objectToArray: '$doc' }\n</code></pre>"},{"location":"documentation/operators/objectOperators.html#factorygetfield","title":"factory.getField()","text":"<p>D\u1ef1ng <code>$getField</code> r\u1ed3i ch\u1ec9 \u0111\u1ecbnh input b\u1eb1ng <code>.of(...)</code>.</p> <pre><code>ObjectOperators.valueOf('doc')\n.getField('name')\n.of('doc')\n.toDocument(context);\n// =&gt; { $getField: { field: 'name', input: '$doc' } }\n</code></pre>"},{"location":"documentation/operators/objectOperators.html#factorysetfield-removefield","title":"factory.setField() / removeField()","text":"<p>Th\u00eam ho\u1eb7c x\u00f3a field b\u1eb1ng <code>$setField</code> (x\u00f3a d\u00f9ng <code>$$REMOVE</code>).</p> <pre><code>// Set\nObjectOperators.valueOf('doc')\n.setField('age')\n.toValue(30)\n.toDocument(context);\n// =&gt; { $setField: { field: 'age', input: '$doc', value: 30 } }\n\n// Remove\nObjectOperators.valueOf('doc')\n.removeField('age')\n.toDocument(context);\n// =&gt; { $setField: { field: 'age', input: '$doc', value: '$$REMOVE' } }\n</code></pre>"},{"location":"documentation/operators/objectOperators.html#luu-y-su-dung","title":"L\u01b0u \u00fd s\u1eed d\u1ee5ng","text":"<ul> <li><code>ObjectOperators.valueOf(...)</code> ch\u1ea5p nh\u1eadn field reference ho\u1eb7c system variable h\u1ee3p l\u1ec7 (v\u00ed d\u1ee5 <code>$$CURRENT</code>).</li> <li><code>removeField(name)</code> s\u1eed d\u1ee5ng gi\u00e1 tr\u1ecb \u0111\u1eb7c bi\u1ec7t <code>$$REMOVE</code> \u0111\u1ec3 x\u00f3a field trong <code>$setField</code>.</li> <li><code>ObjectToArray.valueOfToArray(...)</code>/<code>ObjectOperatorFactory.toArray()</code> n\u00e9m l\u1ed7i khi input null (theo ki\u1ec3m tra <code>Assert.notNull</code>).</li> <li><code>mergeValueOf()</code> v\u00e0 <code>mergeWithValuesOf()</code> cho ph\u00e9p tr\u1ed9n field reference v\u00e0 expression; n\u1ebfu c\u00f3 string, ch\u00fang \u0111\u01b0\u1ee3c chu\u1ea9n h\u00f3a sang field reference tr\u01b0\u1edbc khi merge.</li> </ul>"},{"location":"documentation/operators/setOperators.html","title":"Set Operators","text":"<p><code>SetOperators</code> \u0111\u1ea1i di\u1ec7n cho c\u00e1c to\u00e1n t\u1eed t\u1eadp h\u1ee3p c\u1ee7a MongoDB cho m\u1ea3ng: <code>$setEquals</code>, <code>$setUnion</code>, <code>$setIsSubset</code>. B\u1eaft \u0111\u1ea7u t\u1eeb m\u1ed9t m\u1ea3ng (field ho\u1eb7c expression), b\u1ea1n kh\u1edfi t\u1ea1o factory v\u00e0 chain c\u00e1c ph\u00e9p so s\u00e1nh/t\u1ed5 h\u1ee3p gi\u1eefa nhi\u1ec1u t\u1eadp.</p> <pre><code>import { SetOperators } from 'red-aggregation/operator/setOperators';\n</code></pre>"},{"location":"documentation/operators/setOperators.html#phuong-thuc","title":"Ph\u01b0\u01a1ng th\u1ee9c","text":"<ul> <li>SetOperators.arrayAsSet()</li> <li>factory.isEqualTo()</li> <li>factory.union()</li> <li>factory.isSubsetOf()</li> </ul>"},{"location":"documentation/operators/setOperators.html#setoperatorsarrayasset","title":"SetOperators.arrayAsSet()","text":"<p>Kh\u1edfi t\u1ea1o factory t\u1eeb field reference ho\u1eb7c <code>AggregationExpression</code> \u0111\u1ea1i di\u1ec7n cho m\u1ed9t m\u1ea3ng.</p> <pre><code>const fromField = SetOperators.arrayAsSet('tags');      // '$tags'\nconst fromExpr  = SetOperators.arrayAsSet({ $split: ['$raw', ','] });\n</code></pre>"},{"location":"documentation/operators/setOperators.html#factoryisequalto","title":"factory.isEqualTo()","text":"<p>Sinh <code>$setEquals</code> \u0111\u1ec3 ki\u1ec3m tra hai hay nhi\u1ec1u t\u1eadp h\u1ee3p b\u1eb1ng nhau (kh\u00f4ng x\u00e9t th\u1ee9 t\u1ef1, b\u1ecf tr\u00f9ng l\u1eb7p).</p> <pre><code>SetOperators.arrayAsSet('a')\n.isEqualTo('b')\n.toDocument(context);\n// =&gt; { $setEquals: ['$a', '$b'] }\n\nSetOperators.arrayAsSet({ $map: { input: '$items', as: 'i', in: '$$i.id' } })\n.isEqualTo({ $range: [0, 10] })\n.toDocument(context);\n// =&gt; { $setEquals: [{ $map: ... }, { $range: [0, 10] }] }\n</code></pre>"},{"location":"documentation/operators/setOperators.html#factoryunion","title":"factory.union()","text":"<p>H\u1ee3p nh\u1ea5t nhi\u1ec1u t\u1eadp th\u00f4ng qua <code>$setUnion</code>.</p> <pre><code>SetOperators.arrayAsSet('roles')\n.union('defaultRoles', ['guest'])\n.toDocument(context);\n// =&gt; { $setUnion: ['$roles', '$defaultRoles', ['guest']] }\n</code></pre>"},{"location":"documentation/operators/setOperators.html#factoryissubsetof","title":"factory.isSubsetOf()","text":"<p>Ki\u1ec3m tra t\u1eadp kh\u1edfi t\u1ea1o l\u00e0 t\u1eadp con c\u1ee7a c\u00e1c t\u1eadp c\u00f2n l\u1ea1i b\u1eb1ng <code>$setIsSubset</code>.</p> <pre><code>SetOperators.arrayAsSet('selected')\n.isSubsetOf('allowed')\n.toDocument(context);\n// =&gt; { $setIsSubset: ['$selected', '$allowed'] }\n\nSetOperators.arrayAsSet({ $setUnion: ['$a', '$b'] })\n.isSubsetOf({ $range: [0, 100] })\n.toDocument(context);\n// =&gt; { $setIsSubset: [{ $setUnion: ['$a', '$b'] }, { $range: [0, 100] }] }\n</code></pre>"},{"location":"documentation/operators/setOperators.html#luu-y-su-dung","title":"L\u01b0u \u00fd s\u1eed d\u1ee5ng","text":"<ul> <li><code>arrayAsSet(...)</code> v\u00e0 c\u00e1c ph\u01b0\u01a1ng th\u1ee9c factory n\u00e9m l\u1ed7i khi input <code>null</code> (ki\u1ec3m tra <code>Assert.notNull</code>).</li> <li>M\u1ecdi tham s\u1ed1 c\u00f3 th\u1ec3 l\u00e0 field reference, <code>AggregationExpression</code> ho\u1eb7c literal m\u1ea3ng (khi ph\u00f9 h\u1ee3p). Khi truy\u1ec1n string, th\u01b0 vi\u1ec7n t\u1ef1 chu\u1ea9n h\u00f3a th\u00e0nh field reference (th\u00eam <code>$</code>).</li> <li><code>$setEquals</code>, <code>$setUnion</code>, <code>$setIsSubset</code> ho\u1ea1t \u0111\u1ed9ng tr\u00ean t\u1eadp h\u1ee3p (lo\u1ea1i b\u1ecf ph\u1ea7n t\u1eed tr\u00f9ng, kh\u00f4ng x\u00e9t th\u1ee9 t\u1ef1).</li> </ul>"},{"location":"documentation/operators/stringOperators.html","title":"String Operators","text":"<p><code>StringOperators</code> gom nh\u00f3m c\u00e1c to\u00e1n t\u1eed chu\u1ed7i c\u1ee7a MongoDB: n\u1ed1i chu\u1ed7i, c\u1eaft/k\u00fd t\u1ef1 \u0111\u1ea7u-cu\u1ed1i, chuy\u1ec3n hoa/th\u01b0\u1eddng, t\u00e1ch chu\u1ed7i v\u00e0 c\u00e1c ph\u00e9p regex. B\u1eaft \u0111\u1ea7u t\u1eeb m\u1ed9t field ho\u1eb7c <code>AggregationExpression</code>, b\u1ea1n d\u00f9ng factory \u0111\u1ec3 d\u1ef1ng bi\u1ec3u th\u1ee9c thay v\u00ec vi\u1ebft BSON th\u1ee7 c\u00f4ng.</p> <pre><code>import { StringOperators } from 'red-aggregation/operator/stringOperators/stringOperator';\n</code></pre>"},{"location":"documentation/operators/stringOperators.html#phuong-thuc","title":"Ph\u01b0\u01a1ng th\u1ee9c","text":"<ul> <li>StringOperators.valueOf()</li> <li>factory.concat()/concatValueOf()</li> <li>factory.toUpper()/toLower()</li> <li>factory.trim()/ltrim()/rtrim()</li> <li>factory.split()</li> <li>factory.replaceOne()/replaceAll()</li> <li>factory.regexMatch()/regexFind()/regexFindAll()</li> <li>IndexOfBytes.valueOf().indexOf()</li> </ul>"},{"location":"documentation/operators/stringOperators.html#stringoperatorsvalueof","title":"StringOperators.valueOf()","text":"<p>Kh\u1edfi t\u1ea1o factory t\u1eeb field ho\u1eb7c bi\u1ec3u th\u1ee9c chu\u1ed7i.</p> <pre><code>const fromField = StringOperators.valueOf('name');\nconst fromExpr  = StringOperators.valueOf({ $toString: '$age' });\n</code></pre>"},{"location":"documentation/operators/stringOperators.html#factoryconcat-concatvalueof","title":"factory.concat() / concatValueOf()","text":"<pre><code>// N\u1ed1i literal\nfromField.concat(' (VIP)').toDocument(context);\n// =&gt; { $concat: ['$name', ' (VIP)'] }\n\n// N\u1ed1i gi\u00e1 tr\u1ecb t\u1eeb field/expression kh\u00e1c\nfromField.concatValueOf('suffix').toDocument(context);\n// =&gt; { $concat: ['$name', '$suffix'] }\n</code></pre>"},{"location":"documentation/operators/stringOperators.html#factorytoupper-tolower","title":"factory.toUpper() / toLower()","text":"<pre><code>StringOperators.valueOf('code').toUpper().toDocument(context);\n// =&gt; { $toUpper: '$code' }\n\nStringOperators.valueOf({ $substr: ['$sku', 0, 3] }).toLower().toDocument(context);\n// =&gt; { $toLower: { $substr: ['$sku', 0, 3] } }\n</code></pre>"},{"location":"documentation/operators/stringOperators.html#factorytrim-ltrim-rtrim","title":"factory.trim() / ltrim() / rtrim()","text":"<pre><code>// Trim m\u1eb7c \u0111\u1ecbnh (kho\u1ea3ng tr\u1eafng)\nStringOperators.valueOf('title').trim().toDocument(context);\n// =&gt; { $trim: { input: '$title' } }\n\n// Trim k\u00fd t\u1ef1 tu\u1ef3 ch\u1ecdn\nStringOperators.valueOf('title').trim(':').toDocument(context);\n// =&gt; { $trim: { input: '$title', chars: ':' } }\n\n// Left/Right trim\nStringOperators.valueOf('path').ltrim('/').toDocument(context);\n// =&gt; { $ltrim: { input: '$path', chars: '/' } }\n\nStringOperators.valueOf('path').rtrim('/').toDocument(context);\n// =&gt; { $rtrim: { input: '$path', chars: '/' } }\n</code></pre>"},{"location":"documentation/operators/stringOperators.html#factorysplit","title":"factory.split()","text":"<pre><code>StringOperators.valueOf('tags').split(',').toDocument(context);\n// =&gt; { $split: ['$tags', ','] }\n\nStringOperators.valueOf({ $toString: '$payload' }).split('-').toDocument(context);\n// =&gt; { $split: [{ $toString: '$payload' }, '-'] }\n</code></pre>"},{"location":"documentation/operators/stringOperators.html#factoryreplaceone-replaceall","title":"factory.replaceOne() / replaceAll()","text":"<pre><code>StringOperators.valueOf('text').replaceOne('foo', 'bar').toDocument(context);\n// =&gt; { $replaceOne: { input: '$text', find: 'foo', replacement: 'bar' } }\n\nStringOperators.valueOf('text').replaceAll(' ', '_').toDocument(context);\n// =&gt; { $replaceAll: { input: '$text', find: ' ', replacement: '_' } }\n</code></pre>"},{"location":"documentation/operators/stringOperators.html#factoryregexmatch-regexfind-regexfindall","title":"factory.regexMatch() / regexFind() / regexFindAll()","text":"<pre><code>// regexMatch: tr\u1ea3 boolean\nStringOperators.valueOf('email')\n.regexMatch('^.+@example\\\\.com$')\n.options('i')\n.toDocument(context);\n// =&gt; { $regexMatch: { input: '$email', regex: '^.+@example\\\\.com$', options: 'i' } }\n\n// regexFind: tr\u1ea3 k\u1ebft qu\u1ea3 kh\u1edbp \u0111\u1ea7u ti\u00ean\nStringOperators.valueOf('text')\n.regexFind('foo', 'i')\n.toDocument(context);\n// =&gt; { $regexFind: { input: '$text', regex: 'foo', options: 'i' } }\n\n// regexFindAll: tr\u1ea3 t\u1ea5t c\u1ea3 k\u1ebft qu\u1ea3 kh\u1edbp\nStringOperators.valueOf('text')\n.regexFindAll('foo', 'g')\n.toDocument(context);\n// =&gt; { $regexFindAll: { input: '$text', regex: 'foo', options: 'g' } }\n</code></pre>"},{"location":"documentation/operators/stringOperators.html#indexofbytes","title":"IndexOfBytes","text":"<pre><code>import { IndexOfBytes } from 'red-aggregation/operator/stringOperators/indexOfBytesOperator';\n\nIndexOfBytes.valueOf('text').indexOf('sub').toDocument(context);\n// =&gt; { $indexOfBytes: ['$text', 'sub'] }\n</code></pre>"},{"location":"documentation/operators/stringOperators.html#luu-y-su-dung","title":"L\u01b0u \u00fd s\u1eed d\u1ee5ng","text":"<ul> <li>Factory v\u00e0 builders n\u00e9m l\u1ed7i khi input/null kh\u00f4ng h\u1ee3p l\u1ec7 (<code>Assert.notNull</code>).</li> <li>V\u1edbi tham s\u1ed1 string \u0111\u1ea1i di\u1ec7n field, th\u01b0 vi\u1ec7n s\u1ebd chu\u1ea9n h\u00f3a th\u00e0nh field reference (<code>'$field'</code>).</li> <li><code>trim/ltrim/rtrim</code> cho ph\u00e9p truy\u1ec1n <code>chars</code> d\u1ea1ng literal ho\u1eb7c expression (<code>.charsOf(...)</code>).</li> <li>Regex APIs ch\u1ea5p nh\u1eadn pattern d\u1ea1ng literal string, <code>RegExp</code>, ho\u1eb7c bi\u1ec3u th\u1ee9c; c\u00f3 th\u1ec3 ch\u1ec9 \u0111\u1ecbnh <code>options</code> qua literal ho\u1eb7c <code>.optionsOf(...)</code>.</li> </ul>"},{"location":"documentation/operators/variableOperators.html","title":"Variable Operators","text":"<p><code>VariableOperators</code> h\u1ed7 tr\u1ee3 t\u1ea1o bi\u1ebfn c\u1ee5c b\u1ed9 trong bi\u1ec3u th\u1ee9c MongoDB b\u1eb1ng <code>$let</code>. B\u1ea1n \u0111\u1ecbnh ngh\u0129a danh s\u00e1ch bi\u1ebfn t\u1eeb <code>field</code> ho\u1eb7c <code>AggregationExpression</code> r\u1ed3i \u00e1p d\u1ee5ng v\u00e0o m\u1ed9t bi\u1ec3u th\u1ee9c \"in\" m\u00e0 kh\u00f4ng c\u1ea7n t\u1ef1 vi\u1ebft BSON th\u1ee7 c\u00f4ng.</p> <pre><code>import { VariableOperators } from 'red-aggregation/operator/variableOperators';\nimport { ExpressionVariable } from 'red-aggregation/operator/variableOperators/let';\n</code></pre>"},{"location":"documentation/operators/variableOperators.html#phuong-thuc","title":"Ph\u01b0\u01a1ng th\u1ee9c","text":"<ul> <li>VariableOperators.define()</li> <li>ExpressionVariable.newVariable().forField()/forExpression()</li> </ul>"},{"location":"documentation/operators/variableOperators.html#variableoperatorsdefine","title":"VariableOperators.define()","text":"<p>Nh\u1eadn m\u1ed9t ho\u1eb7c nhi\u1ec1u <code>ExpressionVariable</code>, tr\u1ea3 v\u1ec1 builder \u0111\u1ec3 ch\u1ec9 \u0111\u1ecbnh bi\u1ec3u th\u1ee9c \u00e1p d\u1ee5ng qua <code>.andApply(...)</code>.</p> <pre><code>const vars = [\nExpressionVariable.newVariable('x').forField('price'),\nExpressionVariable.newVariable('y').forExpression({ $multiply: ['$qty', '$unit'] })\n];\n\nVariableOperators.define(vars)\n.andApply({ $add: ['$$x', '$$y'] })\n.toDocument(context);\n// =&gt; { $let: { vars: { x: '$price', y: { $multiply: ['$qty', '$unit'] } }, in: { $add: ['$$x', '$$y'] } } }\n</code></pre> <p>Ho\u1eb7c truy\u1ec1n bi\u1ebfn r\u1ea3i r\u00e1c (kh\u00f4ng c\u1ea7n g\u00f3i m\u1ea3ng):</p> <pre><code>VariableOperators.define(\nExpressionVariable.newVariable('first').forField('a'),\nExpressionVariable.newVariable('second').forExpression({ $toString: '$b' })\n).andApply({ $concat: ['$$first', '$$second'] }).toDocument(context);\n// =&gt; { $let: { vars: { first: '$a', second: { $toString: '$b' } }, in: { $concat: ['$$first', '$$second'] } } }\n</code></pre>"},{"location":"documentation/operators/variableOperators.html#expressionvariablenewvariable","title":"ExpressionVariable.newVariable()","text":"<p>T\u1ea1o bi\u1ebfn v\u00e0 g\u00e1n ngu\u1ed3n gi\u00e1 tr\u1ecb cho bi\u1ebfn \u0111\u00f3.</p> <pre><code>const v1 = ExpressionVariable.newVariable('total').forExpression({ $add: ['$a', '$b'] });\nconst v2 = ExpressionVariable.newVariable('lower').forField('title');\n\nVariableOperators.define(v1, v2)\n.andApply({ $toLower: '$$lower' })\n.toDocument(context);\n// =&gt; { $let: { vars: { total: { $add: ['$a', '$b'] }, lower: '$title' }, in: { $toLower: '$$lower' } } }\n</code></pre>"},{"location":"documentation/operators/variableOperators.html#luu-y-su-dung","title":"L\u01b0u \u00fd s\u1eed d\u1ee5ng","text":"<ul> <li>T\u00ean bi\u1ebfn ph\u1ea3i kh\u00f4ng null; truy\u1ec1n null cho bi\u1ebfn ho\u1eb7c bi\u1ec3u th\u1ee9c s\u1ebd n\u00e9m l\u1ed7i (<code>Assert.notNull</code>).</li> <li>Trong ph\u1ea7n <code>in</code>, tham chi\u1ebfu bi\u1ebfn d\u00f9ng c\u00fa ph\u00e1p <code>$$varName</code> v\u00e0 context th\u1ef1c thi s\u1ebd \u0111\u01b0\u1ee3c m\u1edf r\u1ed9ng \u0111\u1ec3 nh\u00ecn th\u1ea5y c\u00e1c bi\u1ebfn \u0111\u00e3 \u0111\u1ecbnh ngh\u0129a.</li> <li><code>forField('name')</code> t\u1ef1 chu\u1ea9n h\u00f3a th\u00e0nh field reference (<code>'$name'</code>); <code>forExpression(...)</code> nh\u1eadn <code>AggregationExpression</code> ho\u1eb7c BSON expression.</li> </ul>"}]}